(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.videojsContribHls=f()}})(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i['return'])_i['return']();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError('Invalid attempt to destructure non-iterable instance');}};})();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var findAdCue=function findAdCue(track,mediaTime){var cues=track.cues;for(var i=0;i<cues.length;i++){var cue=cues[i];if(mediaTime>=cue.adStartTime&&mediaTime<=cue.adEndTime){return cue;}}
return null;};var updateAdCues=function updateAdCues(media,track){var offset=arguments.length<=2||arguments[2]===undefined?0:arguments[2];if(!media.segments){return;}
var mediaTime=offset;var cue=undefined;for(var i=0;i<media.segments.length;i++){var segment=media.segments[i];if(!cue){cue=findAdCue(track,mediaTime+segment.duration/2);}
if(cue){if('cueIn'in segment){cue.endTime=mediaTime;cue.adEndTime=mediaTime;mediaTime+=segment.duration;cue=null;continue;}
if(mediaTime<cue.endTime){mediaTime+=segment.duration;continue;}
cue.endTime+=segment.duration;}else{if('cueOut'in segment){cue=new _globalWindow2['default'].VTTCue(mediaTime,mediaTime+segment.duration,segment.cueOut);cue.adStartTime=mediaTime;cue.adEndTime=mediaTime+parseFloat(segment.cueOut);track.addCue(cue);}
if('cueOutCont'in segment){var adOffset=undefined;var adTotal=undefined;var _segment$cueOutCont$split$map=segment.cueOutCont.split('/').map(parseFloat);var _segment$cueOutCont$split$map2=_slicedToArray(_segment$cueOutCont$split$map,2);adOffset=_segment$cueOutCont$split$map2[0];adTotal=_segment$cueOutCont$split$map2[1];cue=new _globalWindow2['default'].VTTCue(mediaTime,mediaTime+segment.duration,'');cue.adStartTime=mediaTime-adOffset;cue.adEndTime=cue.adStartTime+adTotal;track.addCue(cue);}}
mediaTime+=segment.duration;}};exports['default']={updateAdCues:updateAdCues,findAdCue:findAdCue};module.exports=exports['default'];},{"global/window":26}],2:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var textRange=function textRange(range,i){return range.start(i)+'-'+range.end(i);};var formatHexString=function formatHexString(e,i){var value=e.toString(16);return '00'.substring(0,2-value.length)+value+(i%2?' ':'');};var formatAsciiString=function formatAsciiString(e){if(e>=0x20&&e<0x7e){return String.fromCharCode(e);}
return '.';};var utils={hexDump:function hexDump(data){var bytes=Array.prototype.slice.call(data);var step=16;var result='';var hex=undefined;var ascii=undefined;for(var j=0;j<bytes.length/step;j++){hex=bytes.slice(j*step,j*step+step).map(formatHexString).join('');ascii=bytes.slice(j*step,j*step+step).map(formatAsciiString).join('');result+=hex+' '+ascii+'\n';}
return result;},tagDump:function tagDump(tag){return utils.hexDump(tag.bytes);},textRanges:function textRanges(ranges){var result='';var i=undefined;for(i=0;i<ranges.length;i++){result+=textRange(ranges,i)+' ';}
return result;}};exports['default']=utils;module.exports=exports['default'];},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]={GOAL_BUFFER_LENGTH:30};module.exports=exports["default"];},{}],4:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x3,_x4,_x5){var _again=true;_function:while(_again){var object=_x3,property=_x4,receiver=_x5;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x3=parent;_x4=property;_x5=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _playlistLoader=require('./playlist-loader');var _playlistLoader2=_interopRequireDefault(_playlistLoader);var _segmentLoader=require('./segment-loader');var _segmentLoader2=_interopRequireDefault(_segmentLoader);var _ranges=require('./ranges');var _ranges2=_interopRequireDefault(_ranges);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _adCueTags=require('./ad-cue-tags');var _adCueTags2=_interopRequireDefault(_adCueTags);var BLACKLIST_DURATION=5*60*1000;var Hls=undefined;var objectChanged=function objectChanged(a,b){if(typeof a!==typeof b){return true;}
if(Object.keys(a).length!==Object.keys(b).length){return true;}
for(var prop in a){if(a[prop]!==b[prop]){return true;}}
return false;};var parseCodecs=function parseCodecs(codecs){var result={codecCount:0,videoCodec:null,videoObjectTypeIndicator:null,audioProfile:null};var parsed=undefined;result.codecCount=codecs.split(',').length;result.codecCount=result.codecCount||2;parsed=/(^|\s|,)+(avc1)([^ ,]*)/i.exec(codecs);if(parsed){result.videoCodec=parsed[2];result.videoObjectTypeIndicator=parsed[3];}
result.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(codecs);result.audioProfile=result.audioProfile&&result.audioProfile[2];return result;};var mimeTypesForPlaylist_=function mimeTypesForPlaylist_(master,media){var container='mp2t';var codecs={videoCodec:'avc1',videoObjectTypeIndicator:'.4d400d',audioProfile:'2'};var audioGroup=[];var mediaAttributes=undefined;var previousGroup=null;if(!media){return[];}
if(media.segments&&media.segments.length&&media.segments[0].map){container='mp4';}
mediaAttributes=media.attributes||{};if(mediaAttributes.CODECS){(function(){var parsedCodecs=parseCodecs(mediaAttributes.CODECS);Object.keys(parsedCodecs).forEach(function(key){codecs[key]=parsedCodecs[key]||codecs[key];});})();}
if(master.mediaGroups.AUDIO){audioGroup=master.mediaGroups.AUDIO[mediaAttributes.AUDIO];}
for(var groupId in audioGroup){if(previousGroup&&!!audioGroup[groupId].uri!==!!previousGroup.uri){return['video/'+container+'; codecs="'+codecs.videoCodec+codecs.videoObjectTypeIndicator+', mp4a.40.'+codecs.audioProfile+'"','audio/'+container+'; codecs="mp4a.40.'+codecs.audioProfile+'"'];}
previousGroup=audioGroup[groupId];}
if(previousGroup&&previousGroup.uri){return['video/'+container+'; codecs="'+codecs.videoCodec+codecs.videoObjectTypeIndicator+'"','audio/'+container+'; codecs="mp4a.40.'+codecs.audioProfile+'"'];}
return['video/'+container+'; codecs="'+codecs.videoCodec+codecs.videoObjectTypeIndicator+', mp4a.40.'+codecs.audioProfile+'"'];};exports.mimeTypesForPlaylist_=mimeTypesForPlaylist_;var MasterPlaylistController=(function(_videojs$EventTarget){_inherits(MasterPlaylistController,_videojs$EventTarget);function MasterPlaylistController(options){var _this=this;_classCallCheck(this,MasterPlaylistController);_get(Object.getPrototypeOf(MasterPlaylistController.prototype),'constructor',this).call(this);var url=options.url;var withCredentials=options.withCredentials;var mode=options.mode;var tech=options.tech;var bandwidth=options.bandwidth;var externHls=options.externHls;var useCueTags=options.useCueTags;if(!url){throw new Error('A non-empty playlist URL is required');}
Hls=externHls;this.withCredentials=withCredentials;this.tech_=tech;this.hls_=tech.hls;this.mode_=mode;this.useCueTags_=useCueTags;if(this.useCueTags_){this.cueTagsTrack_=this.tech_.addTextTrack('metadata','ad-cues');this.cueTagsTrack_.inBandMetadataTrackDispatchType='';this.tech_.textTracks().addTrack_(this.cueTagsTrack_);}
this.audioTracks_=[];this.requestOptions_={withCredentials:this.withCredentials,timeout:null};this.audioGroups_={};this.mediaSource=new _videoJs2['default'].MediaSource({mode:mode});this.audioinfo_=null;this.mediaSource.on('audioinfo',this.handleAudioinfoUpdate_.bind(this));this.mediaSource.addEventListener('sourceopen',this.handleSourceOpen_.bind(this));var segmentLoaderOptions={hls:this.hls_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:function seekable(){return _this.seekable();},seeking:function seeking(){return _this.tech_.seeking();},setCurrentTime:function setCurrentTime(a){return _this.tech_.setCurrentTime(a);},hasPlayed:function hasPlayed(){return _this.tech_.played().length!==0;},bandwidth:bandwidth};this.masterPlaylistLoader_=new _playlistLoader2['default'](url,this.hls_,this.withCredentials);this.setupMasterPlaylistLoaderListeners_();this.audioPlaylistLoader_=null;this.mainSegmentLoader_=new _segmentLoader2['default'](segmentLoaderOptions);this.audioSegmentLoader_=new _segmentLoader2['default'](segmentLoaderOptions);this.setupSegmentLoaderListeners_();this.masterPlaylistLoader_.start();}
_createClass(MasterPlaylistController,[{key:'setupMasterPlaylistLoaderListeners_',value:function setupMasterPlaylistLoaderListeners_(){var _this2=this;this.masterPlaylistLoader_.on('loadedmetadata',function(){var media=_this2.masterPlaylistLoader_.media();var requestTimeout=_this2.masterPlaylistLoader_.targetDuration*1.5*1000;_this2.requestOptions_.timeout=requestTimeout;if(media.endList&&_this2.tech_.preload()!=='none'){_this2.mainSegmentLoader_.playlist(media,_this2.requestOptions_);_this2.mainSegmentLoader_.expired(_this2.masterPlaylistLoader_.expired_);_this2.mainSegmentLoader_.load();}
try{_this2.setupSourceBuffers_();}catch(e){_videoJs2['default'].log.warn('Failed to create SourceBuffers',e);return _this2.mediaSource.endOfStream('decode');}
_this2.setupFirstPlay();_this2.fillAudioTracks_();_this2.setupAudio();_this2.trigger('audioupdate');_this2.trigger('selectedinitialmedia');});this.masterPlaylistLoader_.on('loadedplaylist',function(){var updatedPlaylist=_this2.masterPlaylistLoader_.media();var seekable=undefined;if(!updatedPlaylist){_this2.initialMedia_=_this2.selectPlaylist();_this2.masterPlaylistLoader_.media(_this2.initialMedia_);return;}
if(_this2.useCueTags_){_this2.updateAdCues_(updatedPlaylist,_this2.masterPlaylistLoader_.expired_);}
_this2.mainSegmentLoader_.playlist(updatedPlaylist,_this2.requestOptions_);_this2.mainSegmentLoader_.expired(_this2.masterPlaylistLoader_.expired_);_this2.updateDuration();seekable=_this2.seekable();if(!updatedPlaylist.endList&&seekable.length!==0){_this2.mediaSource.addSeekableRange_(seekable.start(0),seekable.end(0));}});this.masterPlaylistLoader_.on('error',function(){_this2.blacklistCurrentPlaylist(_this2.masterPlaylistLoader_.error);});this.masterPlaylistLoader_.on('mediachanging',function(){_this2.mainSegmentLoader_.abort();_this2.mainSegmentLoader_.pause();});this.masterPlaylistLoader_.on('mediachange',function(){var media=_this2.masterPlaylistLoader_.media();var requestTimeout=_this2.masterPlaylistLoader_.targetDuration*1.5*1000;var activeAudioGroup=undefined;var activeTrack=undefined;if(_this2.masterPlaylistLoader_.isLowestEnabledRendition_()){_this2.requestOptions_.timeout=0;}else{_this2.requestOptions_.timeout=requestTimeout;}
_this2.mainSegmentLoader_.playlist(media,_this2.requestOptions_);_this2.mainSegmentLoader_.expired(_this2.masterPlaylistLoader_.expired_);_this2.mainSegmentLoader_.load();activeAudioGroup=_this2.activeAudioGroup();activeTrack=activeAudioGroup.filter(function(track){return track.enabled;})[0];if(!activeTrack){_this2.setupAudio();_this2.trigger('audioupdate');}
_this2.tech_.trigger({type:'mediachange',bubbles:true});});}},{key:'setupSegmentLoaderListeners_',value:function setupSegmentLoaderListeners_(){var _this3=this;this.mainSegmentLoader_.on('progress',function(){_this3.masterPlaylistLoader_.media(_this3.selectPlaylist());_this3.trigger('progress');});this.mainSegmentLoader_.on('error',function(){_this3.blacklistCurrentPlaylist(_this3.mainSegmentLoader_.error());});this.audioSegmentLoader_.on('error',function(){_videoJs2['default'].log.warn('Problem encountered with the current alternate audio track'+'. Switching back to default.');_this3.audioSegmentLoader_.abort();_this3.audioPlaylistLoader_=null;_this3.setupAudio();});}},{key:'handleAudioinfoUpdate_',value:function handleAudioinfoUpdate_(event){if(Hls.supportsAudioInfoChange_()||!this.audioInfo_||!objectChanged(this.audioInfo_,event.info)){this.audioInfo_=event.info;return;}
var error='had different audio properties (channels, sample rate, etc.) '+'or changed in some other way.  This behavior is currently '+'unsupported in Firefox 48 and below due to an issue: \n\n'+'https://bugzilla.mozilla.org/show_bug.cgi?id=1247138\n\n';var enabledIndex=this.activeAudioGroup().map(function(track){return track.enabled;}).indexOf(true);var enabledTrack=this.activeAudioGroup()[enabledIndex];var defaultTrack=this.activeAudioGroup().filter(function(track){return track.properties_&&track.properties_['default'];})[0];if(!this.audioPlaylistLoader_){error='The rendition that we tried to switch to '+error+'Unfortunately that means we will have to blacklist '+'the current playlist and switch to another. Sorry!';this.blacklistCurrentPlaylist();}else{error='The audio track \''+enabledTrack.label+'\' that we tried to '+('switch to '+error+' Unfortunately this means we will have to ')+('return you to the main track \''+defaultTrack.label+'\'. Sorry!');defaultTrack.enabled=true;this.activeAudioGroup().splice(enabledIndex,1);this.trigger('audioupdate');}
_videoJs2['default'].log.warn(error);this.setupAudio();}},{key:'mediaRequests_',value:function mediaRequests_(){return this.audioSegmentLoader_.mediaRequests+this.mainSegmentLoader_.mediaRequests;}},{key:'mediaTransferDuration_',value:function mediaTransferDuration_(){return this.audioSegmentLoader_.mediaTransferDuration+this.mainSegmentLoader_.mediaTransferDuration;}},{key:'mediaBytesTransferred_',value:function mediaBytesTransferred_(){return this.audioSegmentLoader_.mediaBytesTransferred+this.mainSegmentLoader_.mediaBytesTransferred;}},{key:'fillAudioTracks_',value:function fillAudioTracks_(){var master=this.master();var mediaGroups=master.mediaGroups||{};if(!mediaGroups||!mediaGroups.AUDIO||Object.keys(mediaGroups.AUDIO).length===0||this.mode_!=='html5'){mediaGroups.AUDIO={main:{'default':{'default':true}}};}
for(var mediaGroup in mediaGroups.AUDIO){if(!this.audioGroups_[mediaGroup]){this.audioGroups_[mediaGroup]=[];}
for(var label in mediaGroups.AUDIO[mediaGroup]){var properties=mediaGroups.AUDIO[mediaGroup][label];var track=new _videoJs2['default'].AudioTrack({id:label,kind:properties['default']?'main':'alternative',enabled:false,language:properties.language,label:label});track.properties_=properties;this.audioGroups_[mediaGroup].push(track);}}
(this.activeAudioGroup().filter(function(audioTrack){return audioTrack.properties_['default'];})[0]||this.activeAudioGroup()[0]).enabled=true;}},{key:'load',value:function load(){this.mainSegmentLoader_.load();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.load();}}},{key:'activeAudioGroup',value:function activeAudioGroup(){var videoPlaylist=this.masterPlaylistLoader_.media();var result=undefined;if(videoPlaylist.attributes&&videoPlaylist.attributes.AUDIO){result=this.audioGroups_[videoPlaylist.attributes.AUDIO];}
return result||this.audioGroups_.main;}},{key:'setupAudio',value:function setupAudio(){var _this4=this;var audioGroup=this.activeAudioGroup();var track=audioGroup.filter(function(audioTrack){return audioTrack.enabled;})[0];if(!track){track=audioGroup.filter(function(audioTrack){return audioTrack.properties_['default'];})[0]||audioGroup[0];track.enabled=true;}
if(this.audioPlaylistLoader_){this.audioPlaylistLoader_.dispose();this.audioPlaylistLoader_=null;}
this.audioSegmentLoader_.pause();this.audioSegmentLoader_.clearBuffer();if(!track.properties_.resolvedUri){return;}
this.audioPlaylistLoader_=new _playlistLoader2['default'](track.properties_.resolvedUri,this.hls_,this.withCredentials);this.audioPlaylistLoader_.start();this.audioPlaylistLoader_.on('loadedmetadata',function(){var audioPlaylist=_this4.audioPlaylistLoader_.media();_this4.audioSegmentLoader_.playlist(audioPlaylist,_this4.requestOptions_);if(!_this4.tech_.paused()||audioPlaylist.endList&&_this4.tech_.preload()!=='none'){_this4.audioSegmentLoader_.load();}
if(!audioPlaylist.endList){_this4.audioPlaylistLoader_.trigger('firstplay');}});this.audioPlaylistLoader_.on('loadedplaylist',function(){var updatedPlaylist=undefined;if(_this4.audioPlaylistLoader_){updatedPlaylist=_this4.audioPlaylistLoader_.media();}
if(!updatedPlaylist){_this4.audioPlaylistLoader_.media(_this4.audioPlaylistLoader_.playlists.master.playlists[0]);return;}
_this4.audioSegmentLoader_.playlist(updatedPlaylist,_this4.requestOptions_);});this.audioPlaylistLoader_.on('error',function(){_videoJs2['default'].log.warn('Problem encountered loading the alternate audio track'+'. Switching back to default.');_this4.audioSegmentLoader_.abort();_this4.setupAudio();});}},{key:'fastQualityChange_',value:function fastQualityChange_(){var media=this.selectPlaylist();if(media!==this.masterPlaylistLoader_.media()){this.masterPlaylistLoader_.media(media);this.mainSegmentLoader_.sourceUpdater_.remove(this.tech_.currentTime()+5,Infinity);}}},{key:'play',value:function play(){if(this.setupFirstPlay()){return;}
if(this.tech_.ended()){this.tech_.setCurrentTime(0);}
this.load();if(this.tech_.duration()===Infinity){if(this.tech_.currentTime()<this.tech_.seekable().start(0)){return this.tech_.setCurrentTime(this.tech_.seekable().start(0));}}}},{key:'setupFirstPlay',value:function setupFirstPlay(){var seekable=undefined;var media=this.masterPlaylistLoader_.media();if(media&&!media.endList&&!this.tech_.paused()&&!this.hasPlayed_){this.masterPlaylistLoader_.trigger('firstplay');this.hasPlayed_=true;seekable=this.seekable();if(seekable.length){this.tech_.setCurrentTime(seekable.end(0));}
this.load();return true;}
return false;}},{key:'handleSourceOpen_',value:function handleSourceOpen_(){try{this.setupSourceBuffers_();}catch(e){_videoJs2['default'].log.warn('Failed to create Source Buffers',e);return this.mediaSource.endOfStream('decode');}
if(this.tech_.autoplay()){this.tech_.play();}
this.trigger('sourceopen');}},{key:'blacklistCurrentPlaylist',value:function blacklistCurrentPlaylist(){var error=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var currentPlaylist=undefined;var nextPlaylist=undefined;currentPlaylist=error.playlist||this.masterPlaylistLoader_.media();if(!currentPlaylist){this.error=error;return this.mediaSource.endOfStream('network');}
currentPlaylist.excludeUntil=Date.now()+BLACKLIST_DURATION;nextPlaylist=this.selectPlaylist();if(nextPlaylist){_videoJs2['default'].log.warn('Problem encountered with the current '+'HLS playlist. Switching to another playlist.');return this.masterPlaylistLoader_.media(nextPlaylist);}
_videoJs2['default'].log.warn('Problem encountered with the current '+'HLS playlist. No suitable alternatives found.');this.error=error;return this.mediaSource.endOfStream('network');}},{key:'pauseLoading',value:function pauseLoading(){this.mainSegmentLoader_.pause();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.pause();}}},{key:'setCurrentTime',value:function setCurrentTime(currentTime){var buffered=_ranges2['default'].findRange(this.tech_.buffered(),currentTime);if(!(this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media())){return 0;}
if(!this.masterPlaylistLoader_.media().segments){return 0;}
if(buffered&&buffered.length){return currentTime;}
this.mainSegmentLoader_.abort();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.abort();}
if(!this.tech_.paused()){this.mainSegmentLoader_.load();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.load();}}}},{key:'duration',value:function duration(){if(!this.masterPlaylistLoader_){return 0;}
if(this.mediaSource){return this.mediaSource.duration;}
return Hls.Playlist.duration(this.masterPlaylistLoader_.media());}},{key:'seekable',value:function seekable(){var media=undefined;var mainSeekable=undefined;var audioSeekable=undefined;if(!this.masterPlaylistLoader_){return _videoJs2['default'].createTimeRanges();}
media=this.masterPlaylistLoader_.media();if(!media){return _videoJs2['default'].createTimeRanges();}
mainSeekable=Hls.Playlist.seekable(media,this.masterPlaylistLoader_.expired_);if(mainSeekable.length===0){return mainSeekable;}
if(this.audioPlaylistLoader_){audioSeekable=Hls.Playlist.seekable(this.audioPlaylistLoader_.media(),this.audioPlaylistLoader_.expired_);if(audioSeekable.length===0){return audioSeekable;}}
if(!audioSeekable){return mainSeekable;}
return _videoJs2['default'].createTimeRanges([[audioSeekable.start(0)>mainSeekable.start(0)?audioSeekable.start(0):mainSeekable.start(0),audioSeekable.end(0)<mainSeekable.end(0)?audioSeekable.end(0):mainSeekable.end(0)]]);}},{key:'updateDuration',value:function updateDuration(){var _this5=this;var oldDuration=this.mediaSource.duration;var newDuration=Hls.Playlist.duration(this.masterPlaylistLoader_.media());var buffered=this.tech_.buffered();var setDuration=function setDuration(){_this5.mediaSource.duration=newDuration;_this5.tech_.trigger('durationchange');_this5.mediaSource.removeEventListener('sourceopen',setDuration);};if(buffered.length>0){newDuration=Math.max(newDuration,buffered.end(buffered.length-1));}
if(oldDuration!==newDuration){if(this.mediaSource.readyState!=='open'){this.mediaSource.addEventListener('sourceopen',setDuration);}else{setDuration();}}}},{key:'dispose',value:function dispose(){this.masterPlaylistLoader_.dispose();this.mainSegmentLoader_.dispose();this.audioSegmentLoader_.dispose();}},{key:'master',value:function master(){return this.masterPlaylistLoader_.master;}},{key:'media',value:function media(){return this.masterPlaylistLoader_.media()||this.initialMedia_;}},{key:'setupSourceBuffers_',value:function setupSourceBuffers_(){var media=this.masterPlaylistLoader_.media();var mimeTypes=undefined;if(!media||this.mediaSource.readyState!=='open'){return;}
mimeTypes=mimeTypesForPlaylist_(this.masterPlaylistLoader_.master,media);if(mimeTypes.length<1){this.error='No compatible SourceBuffer configuration for the variant stream:'+media.resolvedUri;return this.mediaSource.endOfStream('decode');}
this.mainSegmentLoader_.mimeType(mimeTypes[0]);if(mimeTypes[1]){this.audioSegmentLoader_.mimeType(mimeTypes[1]);}
this.excludeIncompatibleVariants_(media);}},{key:'excludeIncompatibleVariants_',value:function excludeIncompatibleVariants_(media){var master=this.masterPlaylistLoader_.master;var codecCount=2;var videoCodec=null;var audioProfile=null;var codecs=undefined;if(media.attributes&&media.attributes.CODECS){codecs=parseCodecs(media.attributes.CODECS);videoCodec=codecs.videoCodec;audioProfile=codecs.audioProfile;codecCount=codecs.codecCount;}
master.playlists.forEach(function(variant){var variantCodecs={codecCount:2,videoCodec:null,audioProfile:null};if(variant.attributes&&variant.attributes.CODECS){var codecString=variant.attributes.CODECS;variantCodecs=parseCodecs(codecString);if(window.MediaSource&&window.MediaSource.isTypeSupported&&!window.MediaSource.isTypeSupported('video/mp4; codecs="'+codecString+'"')){variant.excludeUntil=Infinity;}}
if(variantCodecs.codecCount!==codecCount){variant.excludeUntil=Infinity;}
if(variantCodecs.videoCodec!==videoCodec){variant.excludeUntil=Infinity;}
if(variantCodecs.audioProfile==='5'&&audioProfile!=='5'||audioProfile==='5'&&variantCodecs.audioProfile!=='5'){variant.excludeUntil=Infinity;}});}},{key:'updateAdCues_',value:function updateAdCues_(media){var offset=arguments.length<=1||arguments[1]===undefined?0:arguments[1];_adCueTags2['default'].updateAdCues(media,this.cueTagsTrack_,offset);}}]);return MasterPlaylistController;})(_videoJs2['default'].EventTarget);exports.MasterPlaylistController=MasterPlaylistController;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad-cue-tags":1,"./playlist-loader":6,"./ranges":8,"./segment-loader":12}],5:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var _ranges=require('./ranges');var _ranges2=_interopRequireDefault(_ranges);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var timerCancelEvents=['seeking','seeked','pause','playing','error'];var PlaybackWatcher=(function(){function PlaybackWatcher(options){var _this=this;_classCallCheck(this,PlaybackWatcher);this.tech_=options.tech;this.seekable=options.seekable;this.consecutiveUpdates=0;this.lastRecordedTime=null;this.timer_=null;this.checkCurrentTimeTimeout_=null;if(options.debug){this.logger_=_videoJs2['default'].log.bind(_videoJs2['default'],'playback-watcher ->');}
this.logger_('initialize');var waitingHandler=function waitingHandler(){return _this.waiting_();};var cancelTimerHandler=function cancelTimerHandler(){return _this.cancelTimer_();};this.tech_.on('waiting',waitingHandler);this.tech_.on(timerCancelEvents,cancelTimerHandler);this.monitorCurrentTime_();this.dispose=function(){_this.logger_('dispose');_this.tech_.off('waiting',waitingHandler);_this.tech_.off(timerCancelEvents,cancelTimerHandler);if(_this.checkCurrentTimeTimeout_){clearTimeout(_this.checkCurrentTimeTimeout_);}
_this.cancelTimer_();};}
_createClass(PlaybackWatcher,[{key:'monitorCurrentTime_',value:function monitorCurrentTime_(){this.checkCurrentTime_();if(this.checkCurrentTimeTimeout_){clearTimeout(this.checkCurrentTimeTimeout_);}
this.checkCurrentTimeTimeout_=setTimeout(this.monitorCurrentTime_.bind(this),250);}},{key:'checkCurrentTime_',value:function checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking()){return;}
var currentTime=this.tech_.currentTime();if(this.consecutiveUpdates>=5&&currentTime===this.lastRecordedTime){this.consecutiveUpdates++;this.waiting_();}else if(currentTime===this.lastRecordedTime){this.consecutiveUpdates++;}else{this.consecutiveUpdates=0;this.lastRecordedTime=currentTime;}}},{key:'cancelTimer_',value:function cancelTimer_(){this.consecutiveUpdates=0;if(this.timer_){this.logger_('cancelTimer_');clearTimeout(this.timer_);}
this.timer_=null;}},{key:'waiting_',value:function waiting_(){var seekable=this.seekable();var currentTime=this.tech_.currentTime();if(this.tech_.seeking()||this.timer_!==null){return;}
if(this.fellOutOfLiveWindow_(seekable,currentTime)){var livePoint=seekable.end(seekable.length-1);this.logger_('Fell out of live window at time '+currentTime+'. Seeking to '+('live point (seekable end) '+livePoint));this.cancelTimer_();this.tech_.setCurrentTime(livePoint);return;}
var buffered=this.tech_.buffered();var nextRange=_ranges2['default'].findNextRange(buffered,currentTime);if(this.videoUnderflow_(nextRange,buffered,currentTime)){this.cancelTimer_();this.tech_.setCurrentTime(currentTime);return;}
if(nextRange.length>0){var difference=nextRange.start(0)-currentTime;this.logger_('Stopped at '+currentTime+', setting timer for '+difference+', seeking '+('to '+nextRange.start(0)));this.timer_=setTimeout(this.skipTheGap_.bind(this),difference*1000,currentTime);}}},{key:'fellOutOfLiveWindow_',value:function fellOutOfLiveWindow_(seekable,currentTime){if(seekable.length&&seekable.start(0)>0&&currentTime<seekable.start(0)){return true;}
return false;}},{key:'videoUnderflow_',value:function videoUnderflow_(nextRange,buffered,currentTime){if(nextRange.length===0){var gap=this.gapFromVideoUnderflow_(buffered,currentTime);if(gap){this.logger_('Encountered a gap in video from '+gap.start+' to '+gap.end+'. '+('Seeking to current time '+currentTime));return true;}}
return false;}},{key:'skipTheGap_',value:function skipTheGap_(scheduledCurrentTime){var buffered=this.tech_.buffered();var currentTime=this.tech_.currentTime();var nextRange=_ranges2['default'].findNextRange(buffered,currentTime);this.cancelTimer_();if(nextRange.length===0||currentTime!==scheduledCurrentTime){return;}
this.logger_('skipTheGap_:','currentTime:',currentTime,'scheduled currentTime:',scheduledCurrentTime,'nextRange start:',nextRange.start(0));this.tech_.setCurrentTime(nextRange.start(0)+_ranges2['default'].TIME_FUDGE_FACTOR);}},{key:'gapFromVideoUnderflow_',value:function gapFromVideoUnderflow_(buffered,currentTime){var gaps=_ranges2['default'].findGaps(buffered);for(var i=0;i<gaps.length;i++){var start=gaps.start(i);var end=gaps.end(i);if(currentTime-start<4&&currentTime-start>2){return{start:start,end:end};}}
return null;}},{key:'logger_',value:function logger_(){}}]);return PlaybackWatcher;})();exports['default']=PlaybackWatcher;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ranges":8}],6:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _resolveUrl=require('./resolve-url');var _resolveUrl2=_interopRequireDefault(_resolveUrl);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _stream=require('./stream');var _stream2=_interopRequireDefault(_stream);var _m3u8Parser=require('m3u8-parser');var _m3u8Parser2=_interopRequireDefault(_m3u8Parser);var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var updateSegments=function updateSegments(original,update,offset){var result=update.slice();var length=undefined;var i=undefined;offset=offset||0;length=Math.min(original.length,update.length+offset);for(i=offset;i<length;i++){result[i-offset]=(0,_videoJs.mergeOptions)(original[i],result[i-offset]);}
return result;};var updateMaster=function updateMaster(master,media){var changed=false;var result=(0,_videoJs.mergeOptions)(master,{});var i=master.playlists.length;var playlist=undefined;var segment=undefined;var j=undefined;while(i--){playlist=result.playlists[i];if(playlist.uri===media.uri){if(playlist.segments&&media.segments&&playlist.segments.length===media.segments.length&&playlist.mediaSequence===media.mediaSequence){continue;}
result.playlists[i]=(0,_videoJs.mergeOptions)(playlist,media);result.playlists[media.uri]=result.playlists[i];if(playlist.segments){result.playlists[i].segments=updateSegments(playlist.segments,media.segments,media.mediaSequence-playlist.mediaSequence);}
j=0;if(result.playlists[i].segments){j=result.playlists[i].segments.length;}
while(j--){segment=result.playlists[i].segments[j];if(!segment.resolvedUri){segment.resolvedUri=(0,_resolveUrl2['default'])(playlist.resolvedUri,segment.uri);}
if(segment.key&&!segment.key.resolvedUri){segment.key.resolvedUri=(0,_resolveUrl2['default'])(playlist.resolvedUri,segment.key.uri);}
if(segment.map&&!segment.map.resolvedUri){segment.map.resolvedUri=(0,_resolveUrl2['default'])(playlist.resolvedUri,segment.map.uri);}}
changed=true;}}
return changed?result:null;};var PlaylistLoader=function PlaylistLoader(srcUrl,hls,withCredentials){var _this=this;var loader=this;var dispose=undefined;var mediaUpdateTimeout=undefined;var request=undefined;var playlistRequestError=undefined;var haveMetadata=undefined;PlaylistLoader.prototype.constructor.call(this);this.hls_=hls;this.trackExpiredTime_=false;if(!srcUrl){throw new Error('A non-empty playlist URL is required');}
playlistRequestError=function(xhr,url,startingState){loader.setBandwidth(request||xhr);request=null;if(startingState){loader.state=startingState;}
loader.error={playlist:loader.master.playlists[url],status:xhr.status,message:'HLS playlist request error at URL: '+url,responseText:xhr.responseText,code:xhr.status>=500?4:2};loader.trigger('error');};haveMetadata=function(xhr,url){var parser=undefined;var refreshDelay=undefined;var update=undefined;loader.setBandwidth(request||xhr);request=null;loader.state='HAVE_METADATA';parser=new _m3u8Parser2['default'].Parser();parser.push(xhr.responseText);parser.end();parser.manifest.uri=url;update=updateMaster(loader.master,parser.manifest);refreshDelay=(parser.manifest.targetDuration||10)*1000;loader.targetDuration=parser.manifest.targetDuration;if(update){loader.master=update;loader.updateMediaPlaylist_(parser.manifest);}else{refreshDelay/=2;}
if(!loader.media().endList){_globalWindow2['default'].clearTimeout(mediaUpdateTimeout);mediaUpdateTimeout=_globalWindow2['default'].setTimeout(function(){loader.trigger('mediaupdatetimeout');},refreshDelay);}
loader.trigger('loadedplaylist');};loader.state='HAVE_NOTHING';this.expired_=0;dispose=this.dispose;loader.dispose=function(){loader.stopRequest();_globalWindow2['default'].clearTimeout(mediaUpdateTimeout);dispose.call(this);};loader.stopRequest=function(){if(request){var oldRequest=request;request=null;oldRequest.onreadystatechange=null;oldRequest.abort();}};loader.enabledPlaylists_=function(){return loader.master.playlists.filter(function(element,index,array){return!element.excludeUntil||element.excludeUntil<=Date.now();}).length;};loader.isLowestEnabledRendition_=function(){var media=loader.media();if(!media||!media.attributes){return false;}
var currentBandwidth=loader.media().attributes.BANDWIDTH||0;return!(loader.master.playlists.filter(function(playlist){var enabled=typeof playlist.excludeUntil==='undefined'||playlist.excludeUntil<=Date.now();if(!enabled){return false;}
var bandwidth=0;if(playlist&&playlist.attributes){bandwidth=playlist.attributes.BANDWIDTH;}
return bandwidth<=currentBandwidth;}).length>1);};loader.media=function(playlist){var startingState=loader.state;var mediaChange=undefined;if(!playlist){return loader.media_;}
if(loader.state==='HAVE_NOTHING'){throw new Error('Cannot switch media playlist from '+loader.state);}
if(typeof playlist==='string'){if(!loader.master.playlists[playlist]){throw new Error('Unknown playlist URI: '+playlist);}
playlist=loader.master.playlists[playlist];}
mediaChange=!loader.media_||playlist.uri!==loader.media_.uri;if(loader.master.playlists[playlist.uri].endList){if(request){request.onreadystatechange=null;request.abort();request=null;}
loader.state='HAVE_METADATA';loader.media_=playlist;if(mediaChange){loader.trigger('mediachanging');loader.trigger('mediachange');}
return;}
if(!mediaChange){return;}
loader.state='SWITCHING_MEDIA';if(request){if((0,_resolveUrl2['default'])(loader.master.uri,playlist.uri)===request.url){return;}
request.onreadystatechange=null;request.abort();request=null;}
if(this.media_){this.trigger('mediachanging');}
request=this.hls_.xhr({uri:(0,_resolveUrl2['default'])(loader.master.uri,playlist.uri),withCredentials:withCredentials},function(error,req){if(!request){return;}
if(error){return playlistRequestError(request,playlist.uri,startingState);}
haveMetadata(req,playlist.uri);if(startingState==='HAVE_MASTER'){loader.trigger('loadedmetadata');}else{loader.trigger('mediachange');}});};loader.setBandwidth=function(xhr){loader.bandwidth=xhr.bandwidth;};loader.on('firstplay',function(){this.trackExpiredTime_=true;});loader.on('mediaupdatetimeout',function(){if(loader.state!=='HAVE_METADATA'){return;}
loader.state='HAVE_CURRENT_METADATA';request=this.hls_.xhr({uri:(0,_resolveUrl2['default'])(loader.master.uri,loader.media().uri),withCredentials:withCredentials},function(error,req){if(!request){return;}
if(error){return playlistRequestError(request,loader.media().uri);}
haveMetadata(request,loader.media().uri);});});loader.pause=function(){loader.stopRequest();_globalWindow2['default'].clearTimeout(mediaUpdateTimeout);};loader.load=function(){if(loader.started){if(!loader.media().endList){loader.trigger('mediaupdatetimeout');}else{loader.trigger('loadedplaylist');}}else{loader.start();}};loader.start=function(){loader.started=true;request=_this.hls_.xhr({uri:srcUrl,withCredentials:withCredentials},function(error,req){var parser=undefined;var playlist=undefined;var i=undefined;if(!request){return;}
request=null;if(error){loader.error={status:req.status,message:'HLS playlist request error at URL: '+srcUrl,responseText:req.responseText,code:2};return loader.trigger('error');}
parser=new _m3u8Parser2['default'].Parser();parser.push(req.responseText);parser.end();loader.state='HAVE_MASTER';parser.manifest.uri=srcUrl;if(parser.manifest.playlists){loader.master=parser.manifest;i=loader.master.playlists.length;while(i--){playlist=loader.master.playlists[i];loader.master.playlists[playlist.uri]=playlist;playlist.resolvedUri=(0,_resolveUrl2['default'])(loader.master.uri,playlist.uri);}
for(var groupKey in loader.master.mediaGroups.AUDIO){for(var labelKey in loader.master.mediaGroups.AUDIO[groupKey]){var alternateAudio=loader.master.mediaGroups.AUDIO[groupKey][labelKey];if(alternateAudio.uri){alternateAudio.resolvedUri=(0,_resolveUrl2['default'])(loader.master.uri,alternateAudio.uri);}}}
loader.trigger('loadedplaylist');if(!request){loader.media(parser.manifest.playlists[0]);}
return;}
loader.master={mediaGroups:{'AUDIO':{},'VIDEO':{},'CLOSED-CAPTIONS':{},'SUBTITLES':{}},uri:_globalWindow2['default'].location.href,playlists:[{uri:srcUrl}]};loader.master.playlists[srcUrl]=loader.master.playlists[0];loader.master.playlists[0].resolvedUri=srcUrl;haveMetadata(req,srcUrl);return loader.trigger('loadedmetadata');});};};PlaylistLoader.prototype=new _stream2['default']();PlaylistLoader.prototype.updateMediaPlaylist_=function(update){var outdated=undefined;var i=undefined;var segment=undefined;outdated=this.media_;this.media_=this.master.playlists[update.uri];if(!outdated){return;}
if(!this.trackExpiredTime_){return;}
if(update.uri!==outdated.uri){return;}
if(update.segments.length){if(typeof update.segments[0].start!=='undefined'){this.expired_=update.segments[0].start;return;}else if(typeof update.segments[0].end!=='undefined'){this.expired_=update.segments[0].end-update.segments[0].duration;return;}}
i=update.mediaSequence-outdated.mediaSequence-1;for(;i>=0;i--){segment=outdated.segments[i];if(!segment){this.expired_+=outdated.targetDuration||10;continue;}
if(typeof segment.end!=='undefined'){this.expired_=segment.end;return;}
if(typeof segment.start!=='undefined'){this.expired_=segment.start+segment.duration;return;}
this.expired_+=segment.duration;}};exports['default']=PlaylistLoader;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./resolve-url":11,"./stream":14,"global/window":26,"m3u8-parser":63}],7:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var Playlist={UNSAFE_LIVE_SEGMENTS:3};var backwardDuration=function backwardDuration(playlist,endSequence){var result=0;var i=endSequence-playlist.mediaSequence;var segment=playlist.segments[i];if(segment){if(typeof segment.start!=='undefined'){return{result:segment.start,precise:true};}
if(typeof segment.end!=='undefined'){return{result:segment.end-segment.duration,precise:true};}}
while(i--){segment=playlist.segments[i];if(typeof segment.end!=='undefined'){return{result:result+segment.end,precise:true};}
result+=segment.duration;if(typeof segment.start!=='undefined'){return{result:result+segment.start,precise:true};}}
return{result:result,precise:false};};var forwardDuration=function forwardDuration(playlist,endSequence){var result=0;var segment=undefined;var i=endSequence-playlist.mediaSequence;for(;i<playlist.segments.length;i++){segment=playlist.segments[i];if(typeof segment.start!=='undefined'){return{result:segment.start-result,precise:true};}
result+=segment.duration;if(typeof segment.end!=='undefined'){return{result:segment.end-result,precise:true};}}
return{result:-1,precise:false};};var intervalDuration=function intervalDuration(playlist,endSequence,expired){var backward=undefined;var forward=undefined;if(typeof endSequence==='undefined'){endSequence=playlist.mediaSequence+playlist.segments.length;}
if(endSequence<playlist.mediaSequence){return 0;}
backward=backwardDuration(playlist,endSequence);if(backward.precise){return backward.result;}
forward=forwardDuration(playlist,endSequence);if(forward.precise){return forward.result;}
return backward.result+expired;};var duration=function duration(playlist,endSequence,expired){if(!playlist){return 0;}
if(typeof expired!=='number'){expired=0;}
if(typeof endSequence==='undefined'){if(playlist.totalDuration){return playlist.totalDuration;}
if(!playlist.endList){return _globalWindow2['default'].Infinity;}}
return intervalDuration(playlist,endSequence,expired);};exports.duration=duration;var seekable=function seekable(playlist,expired){var start=undefined;var end=undefined;var endSequence=undefined;if(typeof expired!=='number'){expired=0;}
if(!playlist||!playlist.segments){return(0,_videoJs.createTimeRange)();}
if(playlist.endList){return(0,_videoJs.createTimeRange)(0,duration(playlist));}
start=intervalDuration(playlist,playlist.mediaSequence,expired);endSequence=Math.max(0,playlist.segments.length-Playlist.UNSAFE_LIVE_SEGMENTS);end=intervalDuration(playlist,playlist.mediaSequence+endSequence,expired);return(0,_videoJs.createTimeRange)(start,end);};exports.seekable=seekable;var getMediaIndexForTime_=function getMediaIndexForTime_(playlist,time,expired){var i=undefined;var segment=undefined;var originalTime=time;var numSegments=playlist.segments.length;var lastSegment=numSegments-1;var startIndex=undefined;var endIndex=undefined;var knownStart=undefined;var knownEnd=undefined;if(!playlist){return 0;}
if(time<0){return 0;}
if(time===0&&!expired){return 0;}
expired=expired||0;for(i=0;i<numSegments;i++){segment=playlist.segments[i];if(segment.end){if(segment.end>time){knownEnd=segment.end;endIndex=i;break;}else{knownStart=segment.end;startIndex=i+1;}}}
if(startIndex===numSegments){return numSegments;}
if(typeof startIndex!=='undefined'){time=time-knownStart;for(i=startIndex;i<(endIndex||numSegments);i++){segment=playlist.segments[i];time-=segment.duration;if(time<0){return i;}}
if(i>=endIndex){return startIndex+Math.floor((originalTime-knownStart)/(knownEnd-knownStart)*(endIndex-startIndex));}
return lastSegment;}else if(typeof endIndex!=='undefined'){time=knownEnd-time;for(i=endIndex;i>=0;i--){segment=playlist.segments[i];time-=segment.duration;if(time<0){return i;}}
if(time===0){return 0;}
return-1;}
time=time-expired;if(time<0){return-1;}
for(i=0;i<numSegments;i++){segment=playlist.segments[i];time-=segment.duration;if(time<0){return i;}}
return lastSegment;};exports.getMediaIndexForTime_=getMediaIndexForTime_;Playlist.duration=duration;Playlist.seekable=seekable;Playlist.getMediaIndexForTime_=getMediaIndexForTime_;exports['default']=Playlist;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"global/window":26}],8:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i['return'])_i['return']();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError('Invalid attempt to destructure non-iterable instance');}};})();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var TIME_FUDGE_FACTOR=1/30;var clamp=function clamp(num,_ref){var _ref2=_slicedToArray(_ref,2);var start=_ref2[0];var end=_ref2[1];return Math.min(Math.max(start,num),end);};var filterRanges=function filterRanges(timeRanges,predicate){var results=[];var i=undefined;if(timeRanges&&timeRanges.length){for(i=0;i<timeRanges.length;i++){if(predicate(timeRanges.start(i),timeRanges.end(i))){results.push([timeRanges.start(i),timeRanges.end(i)]);}}}
return _videoJs2['default'].createTimeRanges(results);};var findRange=function findRange(buffered,time){return filterRanges(buffered,function(start,end){return start-TIME_FUDGE_FACTOR<=time&&end+TIME_FUDGE_FACTOR>=time;});};var findNextRange=function findNextRange(timeRanges,time){return filterRanges(timeRanges,function(start){return start-TIME_FUDGE_FACTOR>=time;});};var findGaps=function findGaps(buffered){if(buffered.length<2){return _videoJs2['default'].createTimeRanges();}
var ranges=[];for(var i=1;i<buffered.length;i++){var start=buffered.end(i-1);var end=buffered.start(i);ranges.push([start,end]);}
return _videoJs2['default'].createTimeRanges(ranges);};var findSoleUncommonTimeRangesEnd=function findSoleUncommonTimeRangesEnd(original,update){var i=undefined;var start=undefined;var end=undefined;var result=[];var edges=[];var overlapsCurrentEnd=function overlapsCurrentEnd(span){return span[0]<=end&&span[1]>=end;};if(original){for(i=0;i<original.length;i++){start=original.start(i);end=original.end(i);edges.push([start,end]);}}
if(update){for(i=0;i<update.length;i++){start=update.start(i);end=update.end(i);if(edges.some(overlapsCurrentEnd)){continue;}
result.push(end);}}
if(result.length!==1){return null;}
return result[0];};var bufferIntersection=function bufferIntersection(bufferA,bufferB){var start=null;var end=null;var arity=0;var extents=[];var ranges=[];if(!bufferA||!bufferA.length||!bufferB||!bufferB.length){return _videoJs2['default'].createTimeRange();}
var count=bufferA.length;while(count--){extents.push({time:bufferA.start(count),type:'start'});extents.push({time:bufferA.end(count),type:'end'});}
count=bufferB.length;while(count--){extents.push({time:bufferB.start(count),type:'start'});extents.push({time:bufferB.end(count),type:'end'});}
extents.sort(function(a,b){return a.time-b.time;});for(count=0;count<extents.length;count++){if(extents[count].type==='start'){arity++;if(arity===2){start=extents[count].time;}}else if(extents[count].type==='end'){arity--;if(arity===1){end=extents[count].time;}}
if(start!==null&&end!==null){ranges.push([start,end]);start=null;end=null;}}
return _videoJs2['default'].createTimeRanges(ranges);};var calculateBufferedPercent=function calculateBufferedPercent(adjustedRange,referenceRange,currentTime,buffered){var referenceDuration=referenceRange.end(0)-referenceRange.start(0);var adjustedDuration=adjustedRange.end(0)-adjustedRange.start(0);var bufferMissingFromAdjusted=referenceDuration-adjustedDuration;var adjustedIntersection=bufferIntersection(adjustedRange,buffered);var referenceIntersection=bufferIntersection(referenceRange,buffered);var adjustedOverlap=0;var referenceOverlap=0;var count=adjustedIntersection.length;while(count--){adjustedOverlap+=adjustedIntersection.end(count)-adjustedIntersection.start(count);if(adjustedIntersection.start(count)===currentTime){adjustedOverlap+=bufferMissingFromAdjusted;}}
count=referenceIntersection.length;while(count--){referenceOverlap+=referenceIntersection.end(count)-referenceIntersection.start(count);}
return Math.max(adjustedOverlap,referenceOverlap)/referenceDuration*100;};var getSegmentBufferedPercent=function getSegmentBufferedPercent(startOfSegment,segmentDuration,currentTime,buffered){var endOfSegment=startOfSegment+segmentDuration;var originalSegmentRange=_videoJs2['default'].createTimeRanges([[startOfSegment,endOfSegment]]);var adjustedSegmentRange=_videoJs2['default'].createTimeRanges([[clamp(startOfSegment,[currentTime,endOfSegment]),endOfSegment]]);if(adjustedSegmentRange.start(0)===adjustedSegmentRange.end(0)){return 0;}
var percent=calculateBufferedPercent(adjustedSegmentRange,originalSegmentRange,currentTime,buffered);if(isNaN(percent)||percent===Infinity||percent===-Infinity){return 0;}
return percent;};exports['default']={findRange:findRange,findNextRange:findNextRange,findGaps:findGaps,findSoleUncommonTimeRangesEnd:findSoleUncommonTimeRangesEnd,getSegmentBufferedPercent:getSegmentBufferedPercent,TIME_FUDGE_FACTOR:TIME_FUDGE_FACTOR};module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],9:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var defaultOptions={errorInterval:30,getSource:function getSource(next){var tech=this.tech({IWillNotUseThisInPlugins:true});var sourceObj=tech.currentSource_;return next(sourceObj);}};var initPlugin=function initPlugin(player,options){var lastCalled=0;var seekTo=0;var localOptions=_videoJs2['default'].mergeOptions(defaultOptions,options);var loadedMetadataHandler=function loadedMetadataHandler(){if(seekTo){player.currentTime(seekTo);}};var setSource=function setSource(sourceObj){if(sourceObj===null||sourceObj===undefined){return;}
seekTo=player.duration()!==Infinity&&player.currentTime()||0;player.one('loadedmetadata',loadedMetadataHandler);player.src(sourceObj);player.play();};var errorHandler=function errorHandler(){if(Date.now()-lastCalled<localOptions.errorInterval*1000){return;}
if(!localOptions.getSource||typeof localOptions.getSource!=='function'){_videoJs2['default'].log.error('ERROR: reloadSourceOnError - The option getSource must be a function!');return;}
lastCalled=Date.now();return localOptions.getSource.call(player,setSource);};var cleanupEvents=function cleanupEvents(){player.off('loadedmetadata',loadedMetadataHandler);player.off('error',errorHandler);player.off('dispose',cleanupEvents);};var reinitPlugin=function reinitPlugin(newOptions){cleanupEvents();initPlugin(player,newOptions);};player.on('error',errorHandler);player.on('dispose',cleanupEvents);player.reloadSourceOnError=reinitPlugin;};var reloadSourceOnError=function reloadSourceOnError(options){initPlugin(this,options);};exports['default']=reloadSourceOnError;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],10:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var enableFunction=function enableFunction(playlist,changePlaylistFn,enable){var currentlyEnabled=typeof playlist.excludeUntil==='undefined'||playlist.excludeUntil<=Date.now();if(typeof enable==='undefined'){return currentlyEnabled;}
if(enable!==currentlyEnabled){if(enable){delete playlist.excludeUntil;}else{playlist.excludeUntil=Infinity;}
changePlaylistFn();}
return enable;};var Representation=function Representation(hlsHandler,playlist,id){_classCallCheck(this,Representation);var fastChangeFunction=hlsHandler.masterPlaylistController_.fastQualityChange_.bind(hlsHandler.masterPlaylistController_);if(playlist.attributes){var attributes=playlist.attributes;if(attributes.RESOLUTION){var resolution=attributes.RESOLUTION;this.width=resolution.width;this.height=resolution.height;}
this.bandwidth=attributes.BANDWIDTH;}
this.id=id;this.enabled=enableFunction.bind(this,playlist,fastChangeFunction);};var renditionSelectionMixin=function renditionSelectionMixin(hlsHandler){var playlists=hlsHandler.playlists;hlsHandler.representations=function(){return playlists.master.playlists.map(function(e,i){return new Representation(hlsHandler,e,i);});};};exports['default']=renditionSelectionMixin;module.exports=exports['default'];},{}],11:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _urlToolkit=require('url-toolkit');var _urlToolkit2=_interopRequireDefault(_urlToolkit);var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var resolveUrl=function resolveUrl(baseURL,relativeURL){if(/^[a-z]+:/i.test(relativeURL)){return relativeURL;}
if(!/\/\//i.test(baseURL)){baseURL=_urlToolkit2['default'].buildAbsoluteURL(_globalWindow2['default'].location.href,baseURL);}
return _urlToolkit2['default'].buildAbsoluteURL(baseURL,relativeURL);};exports['default']=resolveUrl;module.exports=exports['default'];},{"global/window":26,"url-toolkit":86}],12:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x2,_x3,_x4){var _again=true;_function:while(_again){var object=_x2,property=_x3,receiver=_x4;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x2=parent;_x3=property;_x4=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _ranges=require('./ranges');var _ranges2=_interopRequireDefault(_ranges);var _playlist=require('./playlist');var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _sourceUpdater=require('./source-updater');var _sourceUpdater2=_interopRequireDefault(_sourceUpdater);var _aesDecrypter=require('aes-decrypter');var _muxJsLibMp4Probe=require('mux.js/lib/mp4/probe');var _muxJsLibMp4Probe2=_interopRequireDefault(_muxJsLibMp4Probe);var _config=require('./config');var _config2=_interopRequireDefault(_config);var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var CHECK_BUFFER_DELAY=500;var updateSegmentMetadata=function updateSegmentMetadata(playlist,segmentIndex,segmentEnd){if(!playlist){return false;}
var segment=playlist.segments[segmentIndex];var previousSegment=playlist.segments[segmentIndex-1];if(segmentEnd&&segment){segment.end=segmentEnd;if(!previousSegment){segment.duration=segment.end;}else if(previousSegment.end){segment.duration=segment.end-previousSegment.end;}
return true;}
return false;};var detectEndOfStream=function detectEndOfStream(playlist,mediaSource,segmentIndex){if(!playlist){return false;}
var segments=playlist.segments;var appendedLastSegment=segmentIndex===segments.length;return playlist.endList&&mediaSource.readyState==='open'&&appendedLastSegment;};var byterangeStr=function byterangeStr(byterange){var byterangeStart=undefined;var byterangeEnd=undefined;byterangeEnd=byterange.offset+byterange.length-1;byterangeStart=byterange.offset;return 'bytes='+byterangeStart+'-'+byterangeEnd;};var segmentXhrHeaders=function segmentXhrHeaders(segment){var headers={};if('byterange'in segment){headers.Range=byterangeStr(segment.byterange);}
return headers;};var initSegmentId=function initSegmentId(initSegment){var byterange=initSegment.byterange||{length:Infinity,offset:0};return[byterange.length,byterange.offset,initSegment.resolvedUri].join(',');};var SegmentLoader=(function(_videojs$EventTarget){_inherits(SegmentLoader,_videojs$EventTarget);function SegmentLoader(options){_classCallCheck(this,SegmentLoader);_get(Object.getPrototypeOf(SegmentLoader.prototype),'constructor',this).call(this);var settings=undefined;if(!options){throw new TypeError('Initialization options are required');}
if(typeof options.currentTime!=='function'){throw new TypeError('No currentTime getter specified');}
if(!options.mediaSource){throw new TypeError('No MediaSource specified');}
settings=_videoJs2['default'].mergeOptions(_videoJs2['default'].options.hls,options);this.state='INIT';this.bandwidth=settings.bandwidth;this.throughput={rate:0,count:0};this.roundTrip=NaN;this.resetStats_();this.hasPlayed_=settings.hasPlayed;this.currentTime_=settings.currentTime;this.seekable_=settings.seekable;this.seeking_=settings.seeking;this.setCurrentTime_=settings.setCurrentTime;this.mediaSource_=settings.mediaSource;this.hls_=settings.hls;this.checkBufferTimeout_=null;this.error_=void 0;this.expired_=0;this.timeCorrection_=0;this.currentTimeline_=-1;this.zeroOffset_=NaN;this.xhr_=null;this.pendingSegment_=null;this.mimeType_=null;this.sourceUpdater_=null;this.xhrOptions_=null;this.activeInitSegmentId_=null;this.initSegments_={};}
_createClass(SegmentLoader,[{key:'resetStats_',value:function resetStats_(){this.mediaBytesTransferred=0;this.mediaRequests=0;this.mediaTransferDuration=0;}},{key:'dispose',value:function dispose(){this.state='DISPOSED';this.abort_();if(this.sourceUpdater_){this.sourceUpdater_.dispose();}
this.resetStats_();}},{key:'abort',value:function abort(){if(this.state!=='WAITING'){return;}
this.abort_();if(!this.paused()){this.state='READY';this.fillBuffer_();}}},{key:'error',value:function error(_error){if(typeof _error!=='undefined'){this.error_=_error;}
this.pendingSegment_=null;return this.error_;}},{key:'load',value:function load(){this.monitorBuffer_();if(!this.playlist_){return;}
if(this.state==='INIT'&&this.mimeType_){return this.init_();}
if(!this.sourceUpdater_||this.state!=='READY'&&this.state!=='INIT'){return;}
this.state='READY';this.fillBuffer_();}},{key:'playlist',value:function playlist(media){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(!media){return;}
this.playlist_=media;this.xhrOptions_=options;if(this.mimeType_&&this.state==='INIT'&&!this.paused()){return this.init_();}}},{key:'pause',value:function pause(){if(this.checkBufferTimeout_){_globalWindow2['default'].clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=null;}}},{key:'paused',value:function paused(){return this.checkBufferTimeout_===null;}},{key:'expired',value:function expired(_expired){this.expired_=_expired;}},{key:'mimeType',value:function mimeType(_mimeType){if(this.mimeType_){return;}
this.mimeType_=_mimeType;if(this.playlist_&&this.state==='INIT'&&!this.paused()){this.init_();}}},{key:'monitorBuffer_',value:function monitorBuffer_(){if(this.state==='READY'){this.fillBuffer_();}
if(this.checkBufferTimeout_){_globalWindow2['default'].clearTimeout(this.checkBufferTimeout_);}
this.checkBufferTimeout_=_globalWindow2['default'].setTimeout(this.monitorBuffer_.bind(this),CHECK_BUFFER_DELAY);}},{key:'checkBuffer_',value:function checkBuffer_(buffered,playlist,currentTime,hasPlayed,expired,timeCorrection){var currentBuffered=_ranges2['default'].findRange(buffered,currentTime);if(currentBuffered.length===0&&currentTime===0){currentBuffered=_ranges2['default'].findRange(buffered,currentTime+_ranges2['default'].TIME_FUDGE_FACTOR);}
var bufferedTime=undefined;var currentBufferedEnd=undefined;var mediaIndex=undefined;if(!playlist.segments.length){return null;}
if(currentBuffered.length===0){mediaIndex=(0,_playlist.getMediaIndexForTime_)(playlist,currentTime+timeCorrection,expired);}else{currentBufferedEnd=currentBuffered.end(0);bufferedTime=Math.max(0,currentBufferedEnd-currentTime);if(!hasPlayed&&bufferedTime>=1){return null;}
if(hasPlayed&&bufferedTime>=_config2['default'].GOAL_BUFFER_LENGTH){return null;}
mediaIndex=(0,_playlist.getMediaIndexForTime_)(playlist,currentBufferedEnd+timeCorrection,expired);}
return mediaIndex;}},{key:'abort_',value:function abort_(){if(this.xhr_){this.xhr_.abort();}
this.pendingSegment_=null;}},{key:'init_',value:function init_(){this.state='READY';this.sourceUpdater_=new _sourceUpdater2['default'](this.mediaSource_,this.mimeType_);this.clearBuffer();return this.fillBuffer_();}},{key:'fillBuffer_',value:function fillBuffer_(){if(this.sourceUpdater_.updating()){return;}
var buffered=this.sourceUpdater_.buffered();var playlist=this.playlist_;var currentTime=this.currentTime_();var hasPlayed=this.hasPlayed_();var expired=this.expired_;var timeCorrection=this.timeCorrection_;var requestIndex=this.checkBuffer_(buffered,playlist,currentTime,hasPlayed,expired,timeCorrection);if(requestIndex===null){return;}
var isEndOfStream=detectEndOfStream(playlist,this.mediaSource_,requestIndex);if(isEndOfStream){this.mediaSource_.endOfStream();return;}
if(requestIndex===playlist.segments.length-1&&this.mediaSource_.readyState==='ended'&&!this.seeking_()){return;}
if(requestIndex<0||requestIndex>=playlist.segments.length){return;}
var segment=this.playlist_.segments[requestIndex];var request={uri:segment.resolvedUri,mediaIndex:requestIndex,playlist:playlist,bytes:null,encryptedBytes:null,buffered:null,timestampOffset:NaN,timeline:segment.timeline,duration:segment.duration};var startOfSegment=(0,_playlist.duration)(playlist,playlist.mediaSequence+request.mediaIndex,expired);request.timestampOffset=this.sourceUpdater_.timestampOffset();if(segment.timeline!==this.currentTimeline_||startOfSegment<this.sourceUpdater_.timestampOffset()){request.timestampOffset=startOfSegment;}
var percentBuffered=_ranges2['default'].getSegmentBufferedPercent(startOfSegment,segment.duration,currentTime,buffered);if(percentBuffered>=90){var correctionApplied=this.incrementTimeCorrection_(playlist.targetDuration/2,1);if(correctionApplied&&!this.paused()){this.fillBuffer_();}
return;}
this.loadSegment_(request);}},{key:'trimBuffer_',value:function trimBuffer_(segmentInfo){var seekable=this.seekable_();var currentTime=this.currentTime_();var removeToTime=undefined;if(seekable.length&&seekable.start(0)>0&&seekable.start(0)<currentTime){return seekable.start(0);}
removeToTime=currentTime-60;if(!this.playlist_.endList){return removeToTime;}
for(var i=1;i<=segmentInfo.playlist.segments.length;i++){var removeDuration=(0,_playlist.duration)(segmentInfo.playlist,segmentInfo.playlist.mediaSequence+i,this.expired_);var previousDuration=(0,_playlist.duration)(segmentInfo.playlist,segmentInfo.playlist.mediaSequence+(i-1),this.expired_);if(removeDuration>=removeToTime){removeToTime=previousDuration;break;}}
return removeToTime;}},{key:'loadSegment_',value:function loadSegment_(segmentInfo){var segment=undefined;var keyXhr=undefined;var initSegmentXhr=undefined;var segmentXhr=undefined;var removeToTime=0;removeToTime=this.trimBuffer_(segmentInfo);if(removeToTime>0){this.sourceUpdater_.remove(0,removeToTime);}
segment=segmentInfo.playlist.segments[segmentInfo.mediaIndex];if(segment.key){var keyRequestOptions=_videoJs2['default'].mergeOptions(this.xhrOptions_,{uri:segment.key.resolvedUri,responseType:'arraybuffer'});keyXhr=this.hls_.xhr(keyRequestOptions,this.handleResponse_.bind(this));}
if(segment.map&&!this.initSegments_[initSegmentId(segment.map)]){var initSegmentOptions=_videoJs2['default'].mergeOptions(this.xhrOptions_,{uri:segment.map.resolvedUri,responseType:'arraybuffer',headers:segmentXhrHeaders(segment.map)});initSegmentXhr=this.hls_.xhr(initSegmentOptions,this.handleResponse_.bind(this));}
this.pendingSegment_=segmentInfo;var segmentRequestOptions=_videoJs2['default'].mergeOptions(this.xhrOptions_,{uri:segmentInfo.uri,responseType:'arraybuffer',headers:segmentXhrHeaders(segment)});segmentXhr=this.hls_.xhr(segmentRequestOptions,this.handleResponse_.bind(this));this.xhr_={keyXhr:keyXhr,initSegmentXhr:initSegmentXhr,segmentXhr:segmentXhr,abort:function abort(){if(this.segmentXhr){this.segmentXhr.onreadystatechange=null;this.segmentXhr.abort();this.segmentXhr=null;}
if(this.initSegmentXhr){this.initSegmentXhr.onreadystatechange=null;this.initSegmentXhr.abort();this.initSegmentXhr=null;}
if(this.keyXhr){this.keyXhr.onreadystatechange=null;this.keyXhr.abort();this.keyXhr=null;}}};this.state='WAITING';}},{key:'handleResponse_',value:function handleResponse_(error,request){var segmentInfo=undefined;var segment=undefined;var keyXhrRequest=undefined;var view=undefined;if(!this.xhr_||request!==this.xhr_.segmentXhr&&request!==this.xhr_.keyXhr&&request!==this.xhr_.initSegmentXhr){return;}
segmentInfo=this.pendingSegment_;segment=segmentInfo.playlist.segments[segmentInfo.mediaIndex];if(request.timedout){this.abort_();this.bandwidth=1;this.roundTrip=NaN;this.state='READY';return this.trigger('progress');}
if(!request.aborted&&error){keyXhrRequest=this.xhr_.keyXhr;this.abort_();this.error({status:request.status,message:request===keyXhrRequest?'HLS key request error at URL: '+segment.key.uri:'HLS segment request error at URL: '+segmentInfo.uri,code:2,xhr:request});this.state='READY';this.pause();return this.trigger('error');}
if(!request.response){this.abort_();return;}
if(request===this.xhr_.segmentXhr){this.xhr_.segmentXhr=null;segmentInfo.startOfAppend=Date.now();this.roundTrip=request.roundTripTime;this.bandwidth=request.bandwidth;this.mediaBytesTransferred+=request.bytesReceived||0;this.mediaRequests+=1;this.mediaTransferDuration+=request.roundTripTime||0;if(segment.key){segmentInfo.encryptedBytes=new Uint8Array(request.response);}else{segmentInfo.bytes=new Uint8Array(request.response);}}
if(request===this.xhr_.keyXhr){keyXhrRequest=this.xhr_.segmentXhr;this.xhr_.keyXhr=null;if(request.response.byteLength!==16){this.abort_();this.error({status:request.status,message:'Invalid HLS key at URL: '+segment.key.uri,code:2,xhr:request});this.state='READY';this.pause();return this.trigger('error');}
view=new DataView(request.response);segment.key.bytes=new Uint32Array([view.getUint32(0),view.getUint32(4),view.getUint32(8),view.getUint32(12)]);segment.key.iv=segment.key.iv||new Uint32Array([0,0,0,segmentInfo.mediaIndex+segmentInfo.playlist.mediaSequence]);}
if(request===this.xhr_.initSegmentXhr){this.xhr_.initSegmentXhr=null;segment.map.bytes=new Uint8Array(request.response);this.initSegments_[initSegmentId(segment.map)]=segment.map;}
if(!this.xhr_.segmentXhr&&!this.xhr_.keyXhr&&!this.xhr_.initSegmentXhr){this.xhr_=null;this.processResponse_();}}},{key:'clearBuffer',value:function clearBuffer(){if(this.sourceUpdater_&&this.sourceUpdater_.buffered().length){this.sourceUpdater_.remove(0,Infinity);}}},{key:'processResponse_',value:function processResponse_(){var segmentInfo=undefined;var segment=undefined;this.state='DECRYPTING';segmentInfo=this.pendingSegment_;segment=segmentInfo.playlist.segments[segmentInfo.mediaIndex];if(segment.map&&isNaN(this.zeroOffset_)){var timescales=_muxJsLibMp4Probe2['default'].timescale(segment.map.bytes);var startTime=_muxJsLibMp4Probe2['default'].startTime(timescales,segmentInfo.bytes);this.zeroOffset_=startTime;segmentInfo.timestampOffset-=startTime;}
if(segment.key){new _aesDecrypter.Decrypter(segmentInfo.encryptedBytes,segment.key.bytes,segment.key.iv,(function(err,bytes){segmentInfo.bytes=bytes;this.handleSegment_();}).bind(this));}else{this.handleSegment_();}}},{key:'handleSegment_',value:function handleSegment_(){var _this=this;var segmentInfo=undefined;var segment=undefined;this.state='APPENDING';segmentInfo=this.pendingSegment_;segmentInfo.buffered=this.sourceUpdater_.buffered();segment=segmentInfo.playlist.segments[segmentInfo.mediaIndex];this.currentTimeline_=segmentInfo.timeline;if(segmentInfo.timestampOffset!==this.sourceUpdater_.timestampOffset()){this.sourceUpdater_.timestampOffset(segmentInfo.timestampOffset);}
if(segment.map){(function(){var initId=initSegmentId(segment.map);if(!_this.activeInitSegmentId_||_this.activeInitSegmentId_!==initId){var initSegment=_this.initSegments_[initId];_this.sourceUpdater_.appendBuffer(initSegment.bytes,function(){_this.activeInitSegmentId_=initId;});}})();}
segmentInfo.byteLength=segmentInfo.bytes.byteLength;this.sourceUpdater_.appendBuffer(segmentInfo.bytes,this.handleUpdateEnd_.bind(this));}},{key:'handleUpdateEnd_',value:function handleUpdateEnd_(){var segmentInfo=this.pendingSegment_;var currentTime=this.currentTime_();this.pendingSegment_=null;this.recordThroughput_(segmentInfo);var timelineUpdated=this.updateTimeline_(segmentInfo);this.trigger('progress');var currentMediaIndex=segmentInfo.mediaIndex;currentMediaIndex+=segmentInfo.playlist.mediaSequence-this.playlist_.mediaSequence;var currentBuffered=_ranges2['default'].findRange(this.sourceUpdater_.buffered(),currentTime);var isEndOfStream=detectEndOfStream(segmentInfo.playlist,this.mediaSource_,currentMediaIndex+1);if(isEndOfStream){this.mediaSource_.endOfStream();}
var seekable=this.seekable_();var next=_ranges2['default'].findNextRange(this.sourceUpdater_.buffered(),currentTime);if(this.seeking_()&&currentBuffered.length===0){if(seekable.length&&currentTime<seekable.start(0)){if(next.length){_videoJs2['default'].log('tried seeking to',currentTime,'but that was too early, retrying at',next.start(0));this.setCurrentTime_(next.start(0)+_ranges2['default'].TIME_FUDGE_FACTOR);}}}
this.state='READY';if(timelineUpdated){this.timeCorrection_=0;if(!this.paused()){this.fillBuffer_();}
return;}
var correctionApplied=this.incrementTimeCorrection_(segmentInfo.duration,4);if(correctionApplied&&!this.paused()){this.fillBuffer_();}}},{key:'updateTimeline_',value:function updateTimeline_(segmentInfo){var segment=undefined;var segmentEnd=undefined;var timelineUpdated=false;var playlist=segmentInfo.playlist;var currentMediaIndex=segmentInfo.mediaIndex;currentMediaIndex+=playlist.mediaSequence-this.playlist_.mediaSequence;segment=playlist.segments[currentMediaIndex];if(segment&&segmentInfo&&segmentInfo.playlist.uri===this.playlist_.uri){segmentEnd=_ranges2['default'].findSoleUncommonTimeRangesEnd(segmentInfo.buffered,this.sourceUpdater_.buffered());timelineUpdated=updateSegmentMetadata(playlist,currentMediaIndex,segmentEnd);}
return timelineUpdated;}},{key:'recordThroughput_',value:function recordThroughput_(segmentInfo){var rate=this.throughput.rate;var segmentProcessingTime=Date.now()-segmentInfo.startOfAppend+1;var segmentProcessingThroughput=Math.floor(segmentInfo.byteLength/segmentProcessingTime*8*1000);this.throughput.rate+=(segmentProcessingThroughput-rate)/++this.throughput.count;}},{key:'incrementTimeCorrection_',value:function incrementTimeCorrection_(secondsToIncrement,maxSegmentsToWalk){if(this.timeCorrection_>=this.playlist_.targetDuration*maxSegmentsToWalk){this.timeCorrection_=0;return false;}
this.timeCorrection_+=secondsToIncrement;return true;}}]);return SegmentLoader;})(_videoJs2['default'].EventTarget);exports['default']=SegmentLoader;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./config":3,"./playlist":7,"./ranges":8,"./source-updater":13,"aes-decrypter":19,"global/window":26,"mux.js/lib/mp4/probe":82}],13:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var SourceUpdater=(function(){function SourceUpdater(mediaSource,mimeType){var _this=this;_classCallCheck(this,SourceUpdater);var createSourceBuffer=function createSourceBuffer(){_this.sourceBuffer_=mediaSource.addSourceBuffer(mimeType);_this.onUpdateendCallback_=function(){var pendingCallback=_this.pendingCallback_;_this.pendingCallback_=null;if(pendingCallback){pendingCallback();}
_this.runCallback_();};_this.sourceBuffer_.addEventListener('updateend',_this.onUpdateendCallback_);_this.runCallback_();};this.callbacks_=[];this.pendingCallback_=null;this.timestampOffset_=0;this.mediaSource=mediaSource;if(mediaSource.readyState==='closed'){mediaSource.addEventListener('sourceopen',createSourceBuffer);}else{createSourceBuffer();}}
_createClass(SourceUpdater,[{key:'abort',value:function abort(done){var _this2=this;this.queueCallback_(function(){_this2.sourceBuffer_.abort();},done);}},{key:'appendBuffer',value:function appendBuffer(bytes,done){var _this3=this;this.queueCallback_(function(){_this3.sourceBuffer_.appendBuffer(bytes);},done);}},{key:'buffered',value:function buffered(){if(!this.sourceBuffer_){return _videoJs2['default'].createTimeRanges();}
return this.sourceBuffer_.buffered;}},{key:'duration',value:function duration(_duration){var _this4=this;this.queueCallback_(function(){_this4.sourceBuffer_.duration=_duration;});}},{key:'remove',value:function remove(start,end){var _this5=this;this.queueCallback_(function(){_this5.sourceBuffer_.remove(start,end);});}},{key:'updating',value:function updating(){return!this.sourceBuffer_||this.sourceBuffer_.updating;}},{key:'timestampOffset',value:function timestampOffset(offset){var _this6=this;if(typeof offset!=='undefined'){this.queueCallback_(function(){_this6.sourceBuffer_.timestampOffset=offset;});this.timestampOffset_=offset;}
return this.timestampOffset_;}},{key:'queueCallback_',value:function queueCallback_(callback,done){this.callbacks_.push([callback.bind(this),done]);this.runCallback_();}},{key:'runCallback_',value:function runCallback_(){var callbacks=undefined;if(this.sourceBuffer_&&!this.sourceBuffer_.updating&&this.callbacks_.length){callbacks=this.callbacks_.shift();this.pendingCallback_=callbacks[1];callbacks[0]();}}},{key:'dispose',value:function dispose(){this.sourceBuffer_.removeEventListener('updateend',this.onUpdateendCallback_);if(this.sourceBuffer_&&this.mediaSource.readyState==='open'){this.sourceBuffer_.abort();}}}]);return SourceUpdater;})();exports['default']=SourceUpdater;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],14:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var Stream=(function(){function Stream(){_classCallCheck(this,Stream);this.listeners={};}
_createClass(Stream,[{key:'on',value:function on(type,listener){if(!this.listeners[type]){this.listeners[type]=[];}
this.listeners[type].push(listener);}},{key:'off',value:function off(type,listener){var index=undefined;if(!this.listeners[type]){return false;}
index=this.listeners[type].indexOf(listener);this.listeners[type].splice(index,1);return index>-1;}},{key:'trigger',value:function trigger(type){var callbacks=undefined;var i=undefined;var length=undefined;var args=undefined;callbacks=this.listeners[type];if(!callbacks){return;}
if(arguments.length===2){length=callbacks.length;for(i=0;i<length;++i){callbacks[i].call(this,arguments[1]);}}else{args=Array.prototype.slice.call(arguments,1);length=callbacks.length;for(i=0;i<length;++i){callbacks[i].apply(this,args);}}}},{key:'dispose',value:function dispose(){this.listeners={};}},{key:'pipe',value:function pipe(destination){this.on('data',function(data){destination.push(data);});}}]);return Stream;})();exports['default']=Stream;module.exports=exports['default'];},{}],15:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var xhrFactory=function xhrFactory(){var xhr=function XhrFunction(options,callback){options=(0,_videoJs.mergeOptions)({timeout:45e3},options);if(XhrFunction.beforeRequest&&typeof XhrFunction.beforeRequest==='function'){var newOptions=XhrFunction.beforeRequest(options);if(newOptions){options=newOptions;}}
var request=(0,_videoJs.xhr)(options,function(error,response){if(!error&&request.response){request.responseTime=Date.now();request.roundTripTime=request.responseTime-request.requestTime;request.bytesReceived=request.response.byteLength||request.response.length;if(!request.bandwidth){request.bandwidth=Math.floor(request.bytesReceived/request.roundTripTime*8*1000);}}
if(error||request.timedout){request.timedout=request.timedout||error.code==='ETIMEDOUT';}else{request.timedout=false;}
if(!error&&response.statusCode!==200&&response.statusCode!==206&&response.statusCode!==0){error=new Error('XHR Failed with a response of: '+(request&&(request.response||request.responseText)));}
callback(error,request);});request.requestTime=Date.now();return request;};return xhr;};exports['default']=xhrFactory;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],16:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var precompute=function precompute(){var tables=[[[],[],[],[],[]],[[],[],[],[],[]]];var encTable=tables[0];var decTable=tables[1];var sbox=encTable[4];var sboxInv=decTable[4];var i=undefined;var x=undefined;var xInv=undefined;var d=[];var th=[];var x2=undefined;var x4=undefined;var x8=undefined;var s=undefined;var tEnc=undefined;var tDec=undefined;for(i=0;i<256;i++){th[(d[i]=i<<1^(i>>7)*283)^i]=i;}
for(x=xInv=0;!sbox[x];x^=x2||1,xInv=th[xInv]||1){s=xInv^xInv<<1^xInv<<2^xInv<<3^xInv<<4;s=s>>8^s&255^99;sbox[x]=s;sboxInv[s]=x;x8=d[x4=d[x2=d[x]]];tDec=x8*0x1010101^x4*0x10001^x2*0x101^x*0x1010100;tEnc=d[s]*0x101^s*0x1010100;for(i=0;i<4;i++){encTable[i][x]=tEnc=tEnc<<24^tEnc>>>8;decTable[i][s]=tDec=tDec<<24^tDec>>>8;}}
for(i=0;i<5;i++){encTable[i]=encTable[i].slice(0);decTable[i]=decTable[i].slice(0);}
return tables;};var aesTables=null;var AES=(function(){function AES(key){_classCallCheck(this,AES);if(!aesTables){aesTables=precompute();}
this._tables=[[aesTables[0][0].slice(),aesTables[0][1].slice(),aesTables[0][2].slice(),aesTables[0][3].slice(),aesTables[0][4].slice()],[aesTables[1][0].slice(),aesTables[1][1].slice(),aesTables[1][2].slice(),aesTables[1][3].slice(),aesTables[1][4].slice()]];var i=undefined;var j=undefined;var tmp=undefined;var encKey=undefined;var decKey=undefined;var sbox=this._tables[0][4];var decTable=this._tables[1];var keyLen=key.length;var rcon=1;if(keyLen!==4&&keyLen!==6&&keyLen!==8){throw new Error('Invalid aes key size');}
encKey=key.slice(0);decKey=[];this._key=[encKey,decKey];for(i=keyLen;i<4*keyLen+28;i++){tmp=encKey[i-1];if(i%keyLen===0||keyLen===8&&i%keyLen===4){tmp=sbox[tmp>>>24]<<24^sbox[tmp>>16&255]<<16^sbox[tmp>>8&255]<<8^sbox[tmp&255];if(i%keyLen===0){tmp=tmp<<8^tmp>>>24^rcon<<24;rcon=rcon<<1^(rcon>>7)*283;}}
encKey[i]=encKey[i-keyLen]^tmp;}
for(j=0;i;j++,i--){tmp=encKey[j&3?i:i-4];if(i<=4||j<4){decKey[j]=tmp;}else{decKey[j]=decTable[0][sbox[tmp>>>24]]^decTable[1][sbox[tmp>>16&255]]^decTable[2][sbox[tmp>>8&255]]^decTable[3][sbox[tmp&255]];}}}
_createClass(AES,[{key:'decrypt',value:function decrypt(encrypted0,encrypted1,encrypted2,encrypted3,out,offset){var key=this._key[1];var a=encrypted0^key[0];var b=encrypted3^key[1];var c=encrypted2^key[2];var d=encrypted1^key[3];var a2=undefined;var b2=undefined;var c2=undefined;var nInnerRounds=key.length/4-2;var i=undefined;var kIndex=4;var table=this._tables[1];var table0=table[0];var table1=table[1];var table2=table[2];var table3=table[3];var sbox=table[4];for(i=0;i<nInnerRounds;i++){a2=table0[a>>>24]^table1[b>>16&255]^table2[c>>8&255]^table3[d&255]^key[kIndex];b2=table0[b>>>24]^table1[c>>16&255]^table2[d>>8&255]^table3[a&255]^key[kIndex+1];c2=table0[c>>>24]^table1[d>>16&255]^table2[a>>8&255]^table3[b&255]^key[kIndex+2];d=table0[d>>>24]^table1[a>>16&255]^table2[b>>8&255]^table3[c&255]^key[kIndex+3];kIndex+=4;a=a2;b=b2;c=c2;}
for(i=0;i<4;i++){out[(3&-i)+offset]=sbox[a>>>24]<<24^sbox[b>>16&255]<<16^sbox[c>>8&255]<<8^sbox[d&255]^key[kIndex++];a2=a;a=b;b=c;c=d;d=a2;}}}]);return AES;})();exports['default']=AES;module.exports=exports['default'];},{}],17:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _stream=require('./stream');var _stream2=_interopRequireDefault(_stream);var AsyncStream=(function(_Stream){_inherits(AsyncStream,_Stream);function AsyncStream(){_classCallCheck(this,AsyncStream);_get(Object.getPrototypeOf(AsyncStream.prototype),'constructor',this).call(this,_stream2['default']);this.jobs=[];this.delay=1;this.timeout_=null;}
_createClass(AsyncStream,[{key:'processJob_',value:function processJob_(){this.jobs.shift()();if(this.jobs.length){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay);}else{this.timeout_=null;}}},{key:'push',value:function push(job){this.jobs.push(job);if(!this.timeout_){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay);}}}]);return AsyncStream;})(_stream2['default']);exports['default']=AsyncStream;module.exports=exports['default'];},{"./stream":20}],18:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var _aes=require('./aes');var _aes2=_interopRequireDefault(_aes);var _asyncStream=require('./async-stream');var _asyncStream2=_interopRequireDefault(_asyncStream);var _pkcs7=require('pkcs7');var ntoh=function ntoh(word){return word<<24|(word&0xff00)<<8|(word&0xff0000)>>8|word>>>24;};var decrypt=function decrypt(encrypted,key,initVector){var encrypted32=new Int32Array(encrypted.buffer,encrypted.byteOffset,encrypted.byteLength>>2);var decipher=new _aes2['default'](Array.prototype.slice.call(key));var decrypted=new Uint8Array(encrypted.byteLength);var decrypted32=new Int32Array(decrypted.buffer);var init0=undefined;var init1=undefined;var init2=undefined;var init3=undefined;var encrypted0=undefined;var encrypted1=undefined;var encrypted2=undefined;var encrypted3=undefined;var wordIx=undefined;init0=initVector[0];init1=initVector[1];init2=initVector[2];init3=initVector[3];for(wordIx=0;wordIx<encrypted32.length;wordIx+=4){encrypted0=ntoh(encrypted32[wordIx]);encrypted1=ntoh(encrypted32[wordIx+1]);encrypted2=ntoh(encrypted32[wordIx+2]);encrypted3=ntoh(encrypted32[wordIx+3]);decipher.decrypt(encrypted0,encrypted1,encrypted2,encrypted3,decrypted32,wordIx);decrypted32[wordIx]=ntoh(decrypted32[wordIx]^init0);decrypted32[wordIx+1]=ntoh(decrypted32[wordIx+1]^init1);decrypted32[wordIx+2]=ntoh(decrypted32[wordIx+2]^init2);decrypted32[wordIx+3]=ntoh(decrypted32[wordIx+3]^init3);init0=encrypted0;init1=encrypted1;init2=encrypted2;init3=encrypted3;}
return decrypted;};exports.decrypt=decrypt;var Decrypter=(function(){function Decrypter(encrypted,key,initVector,done){_classCallCheck(this,Decrypter);var step=Decrypter.STEP;var encrypted32=new Int32Array(encrypted.buffer);var decrypted=new Uint8Array(encrypted.byteLength);var i=0;this.asyncStream_=new _asyncStream2['default']();this.asyncStream_.push(this.decryptChunk_(encrypted32.subarray(i,i+step),key,initVector,decrypted));for(i=step;i<encrypted32.length;i+=step){initVector=new Uint32Array([ntoh(encrypted32[i-4]),ntoh(encrypted32[i-3]),ntoh(encrypted32[i-2]),ntoh(encrypted32[i-1])]);this.asyncStream_.push(this.decryptChunk_(encrypted32.subarray(i,i+step),key,initVector,decrypted));}
this.asyncStream_.push(function(){done(null,(0,_pkcs7.unpad)(decrypted));});}
_createClass(Decrypter,[{key:'decryptChunk_',value:function decryptChunk_(encrypted,key,initVector,decrypted){return function(){var bytes=decrypt(encrypted,key,initVector);decrypted.set(bytes,encrypted.byteOffset);};}}],[{key:'STEP',get:function get(){return 32000;}}]);return Decrypter;})();exports.Decrypter=Decrypter;exports['default']={Decrypter:Decrypter,decrypt:decrypt};},{"./aes":16,"./async-stream":17,"pkcs7":22}],19:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _decrypter=require('./decrypter');var _asyncStream=require('./async-stream');var _asyncStream2=_interopRequireDefault(_asyncStream);exports['default']={decrypt:_decrypter.decrypt,Decrypter:_decrypter.Decrypter,AsyncStream:_asyncStream2['default']};module.exports=exports['default'];},{"./async-stream":17,"./decrypter":18}],20:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"dup":14}],21:[function(require,module,exports){'use strict';var PADDING;module.exports=function pad(plaintext){var padding=PADDING[(plaintext.byteLength%16)||0],result=new Uint8Array(plaintext.byteLength+padding.length);result.set(plaintext);result.set(padding,plaintext.byteLength);return result;};PADDING=[[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[14,14,14,14,14,14,14,14,14,14,14,14,14,14],[13,13,13,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,12],[11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10],[9,9,9,9,9,9,9,9,9],[8,8,8,8,8,8,8,8],[7,7,7,7,7,7,7],[6,6,6,6,6,6],[5,5,5,5,5],[4,4,4,4],[3,3,3],[2,2],[1]];},{}],22:[function(require,module,exports){'use strict';exports.pad=require('./pad.js');exports.unpad=require('./unpad.js');},{"./pad.js":21,"./unpad.js":23}],23:[function(require,module,exports){'use strict';module.exports=function unpad(padded){return padded.subarray(0,padded.byteLength-padded[padded.byteLength-1]);};},{}],24:[function(require,module,exports){},{}],25:[function(require,module,exports){(function(global){var topLevel=typeof global!=='undefined'?global:typeof window!=='undefined'?window:{}
var minDoc=require('min-document');if(typeof document!=='undefined'){module.exports=document;}else{var doccy=topLevel['__GLOBAL_DOCUMENT_CACHE@4'];if(!doccy){doccy=topLevel['__GLOBAL_DOCUMENT_CACHE@4']=minDoc;}
module.exports=doccy;}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":24}],26:[function(require,module,exports){(function(global){if(typeof window!=="undefined"){module.exports=window;}else if(typeof global!=="undefined"){module.exports=global;}else if(typeof self!=="undefined"){module.exports=self;}else{module.exports={};}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],27:[function(require,module,exports){var FUNC_ERROR_TEXT='Expected a function';var nativeMax=Math.max;function restParam(func,start){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
start=nativeMax(start===undefined?(func.length-1):(+start||0),0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);while(++index<length){rest[index]=args[start+index];}
switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest);}
var otherArgs=Array(start+1);index=-1;while(++index<start){otherArgs[index]=args[index];}
otherArgs[start]=rest;return func.apply(this,otherArgs);};}
module.exports=restParam;},{}],28:[function(require,module,exports){function arrayCopy(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index];}
return array;}
module.exports=arrayCopy;},{}],29:[function(require,module,exports){function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}
return array;}
module.exports=arrayEach;},{}],30:[function(require,module,exports){function baseCopy(source,props,object){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key];}
return object;}
module.exports=baseCopy;},{}],31:[function(require,module,exports){var createBaseFor=require('./createBaseFor');var baseFor=createBaseFor();module.exports=baseFor;},{"./createBaseFor":38}],32:[function(require,module,exports){var baseFor=require('./baseFor'),keysIn=require('../object/keysIn');function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn);}
module.exports=baseForIn;},{"../object/keysIn":59,"./baseFor":31}],33:[function(require,module,exports){var arrayEach=require('./arrayEach'),baseMergeDeep=require('./baseMergeDeep'),isArray=require('../lang/isArray'),isArrayLike=require('./isArrayLike'),isObject=require('../lang/isObject'),isObjectLike=require('./isObjectLike'),isTypedArray=require('../lang/isTypedArray'),keys=require('../object/keys');function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object)){return object;}
var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source)),props=isSrcArr?undefined:keys(source);arrayEach(props||source,function(srcValue,key){if(props){key=srcValue;srcValue=source[key];}
if(isObjectLike(srcValue)){stackA||(stackA=[]);stackB||(stackB=[]);baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB);}
else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;if(isCommon){result=srcValue;}
if((result!==undefined||(isSrcArr&&!(key in object)))&&(isCommon||(result===result?(result!==value):(value===value)))){object[key]=result;}}});return object;}
module.exports=baseMerge;},{"../lang/isArray":50,"../lang/isObject":53,"../lang/isTypedArray":56,"../object/keys":58,"./arrayEach":29,"./baseMergeDeep":34,"./isArrayLike":41,"./isObjectLike":46}],34:[function(require,module,exports){var arrayCopy=require('./arrayCopy'),isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isArrayLike=require('./isArrayLike'),isPlainObject=require('../lang/isPlainObject'),isTypedArray=require('../lang/isTypedArray'),toPlainObject=require('../lang/toPlainObject');function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){var length=stackA.length,srcValue=source[key];while(length--){if(stackA[length]==srcValue){object[key]=stackB[length];return;}}
var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;if(isCommon){result=srcValue;if(isArrayLike(srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))){result=isArray(value)?value:(isArrayLike(value)?arrayCopy(value):[]);}
else if(isPlainObject(srcValue)||isArguments(srcValue)){result=isArguments(value)?toPlainObject(value):(isPlainObject(value)?value:{});}
else{isCommon=false;}}
stackA.push(srcValue);stackB.push(result);if(isCommon){object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB);}else if(result===result?(result!==value):(value===value)){object[key]=result;}}
module.exports=baseMergeDeep;},{"../lang/isArguments":49,"../lang/isArray":50,"../lang/isPlainObject":54,"../lang/isTypedArray":56,"../lang/toPlainObject":57,"./arrayCopy":28,"./isArrayLike":41}],35:[function(require,module,exports){var toObject=require('./toObject');function baseProperty(key){return function(object){return object==null?undefined:toObject(object)[key];};}
module.exports=baseProperty;},{"./toObject":48}],36:[function(require,module,exports){var identity=require('../utility/identity');function bindCallback(func,thisArg,argCount){if(typeof func!='function'){return identity;}
if(thisArg===undefined){return func;}
switch(argCount){case 1:return function(value){return func.call(thisArg,value);};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection);};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection);};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source);};}
return function(){return func.apply(thisArg,arguments);};}
module.exports=bindCallback;},{"../utility/identity":62}],37:[function(require,module,exports){var bindCallback=require('./bindCallback'),isIterateeCall=require('./isIterateeCall'),restParam=require('../function/restParam');function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=object==null?0:sources.length,customizer=length>2?sources[length-2]:undefined,guard=length>2?sources[2]:undefined,thisArg=length>1?sources[length-1]:undefined;if(typeof customizer=='function'){customizer=bindCallback(customizer,thisArg,5);length-=2;}else{customizer=typeof thisArg=='function'?thisArg:undefined;length-=(customizer?1:0);}
if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1;}
while(++index<length){var source=sources[index];if(source){assigner(object,source,customizer);}}
return object;});}
module.exports=createAssigner;},{"../function/restParam":27,"./bindCallback":36,"./isIterateeCall":44}],38:[function(require,module,exports){var toObject=require('./toObject');function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break;}}
return object;};}
module.exports=createBaseFor;},{"./toObject":48}],39:[function(require,module,exports){var baseProperty=require('./baseProperty');var getLength=baseProperty('length');module.exports=getLength;},{"./baseProperty":35}],40:[function(require,module,exports){var isNative=require('../lang/isNative');function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined;}
module.exports=getNative;},{"../lang/isNative":52}],41:[function(require,module,exports){var getLength=require('./getLength'),isLength=require('./isLength');function isArrayLike(value){return value!=null&&isLength(getLength(value));}
module.exports=isArrayLike;},{"./getLength":39,"./isLength":45}],42:[function(require,module,exports){var isHostObject=(function(){try{Object({'toString':0}+'');}catch(e){return function(){return false;};}
return function(value){return typeof value.toString!='function'&&typeof(value+'')=='string';};}());module.exports=isHostObject;},{}],43:[function(require,module,exports){var reIsUint=/^\d+$/;var MAX_SAFE_INTEGER=9007199254740991;function isIndex(value,length){value=(typeof value=='number'||reIsUint.test(value))?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length;}
module.exports=isIndex;},{}],44:[function(require,module,exports){var isArrayLike=require('./isArrayLike'),isIndex=require('./isIndex'),isObject=require('../lang/isObject');function isIterateeCall(value,index,object){if(!isObject(object)){return false;}
var type=typeof index;if(type=='number'?(isArrayLike(object)&&isIndex(index,object.length)):(type=='string'&&index in object)){var other=object[index];return value===value?(value===other):(other!==other);}
return false;}
module.exports=isIterateeCall;},{"../lang/isObject":53,"./isArrayLike":41,"./isIndex":43}],45:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}
module.exports=isLength;},{}],46:[function(require,module,exports){function isObjectLike(value){return!!value&&typeof value=='object';}
module.exports=isObjectLike;},{}],47:[function(require,module,exports){var isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isIndex=require('./isIndex'),isLength=require('./isLength'),isString=require('../lang/isString'),keysIn=require('../object/keysIn');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object)||isString(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if((allowIndexes&&isIndex(key,length))||hasOwnProperty.call(object,key)){result.push(key);}}
return result;}
module.exports=shimKeys;},{"../lang/isArguments":49,"../lang/isArray":50,"../lang/isString":55,"../object/keysIn":59,"./isIndex":43,"./isLength":45}],48:[function(require,module,exports){var isObject=require('../lang/isObject'),isString=require('../lang/isString'),support=require('../support');function toObject(value){if(support.unindexedChars&&isString(value)){var index=-1,length=value.length,result=Object(value);while(++index<length){result[index]=value.charAt(index);}
return result;}
return isObject(value)?value:Object(value);}
module.exports=toObject;},{"../lang/isObject":53,"../lang/isString":55,"../support":61}],49:[function(require,module,exports){var isArrayLike=require('../internal/isArrayLike'),isObjectLike=require('../internal/isObjectLike');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var propertyIsEnumerable=objectProto.propertyIsEnumerable;function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee');}
module.exports=isArguments;},{"../internal/isArrayLike":41,"../internal/isObjectLike":46}],50:[function(require,module,exports){var getNative=require('../internal/getNative'),isLength=require('../internal/isLength'),isObjectLike=require('../internal/isObjectLike');var arrayTag='[object Array]';var objectProto=Object.prototype;var objToString=objectProto.toString;var nativeIsArray=getNative(Array,'isArray');var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag;};module.exports=isArray;},{"../internal/getNative":40,"../internal/isLength":45,"../internal/isObjectLike":46}],51:[function(require,module,exports){var isObject=require('./isObject');var funcTag='[object Function]';var objectProto=Object.prototype;var objToString=objectProto.toString;function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag;}
module.exports=isFunction;},{"./isObject":53}],52:[function(require,module,exports){var isFunction=require('./isFunction'),isHostObject=require('../internal/isHostObject'),isObjectLike=require('../internal/isObjectLike');var reIsHostCtor=/^\[object .+?Constructor\]$/;var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var reIsNative=RegExp('^'+
fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');function isNative(value){if(value==null){return false;}
if(isFunction(value)){return reIsNative.test(fnToString.call(value));}
return isObjectLike(value)&&(isHostObject(value)?reIsNative:reIsHostCtor).test(value);}
module.exports=isNative;},{"../internal/isHostObject":42,"../internal/isObjectLike":46,"./isFunction":51}],53:[function(require,module,exports){function isObject(value){var type=typeof value;return!!value&&(type=='object'||type=='function');}
module.exports=isObject;},{}],54:[function(require,module,exports){var baseForIn=require('../internal/baseForIn'),isArguments=require('./isArguments'),isHostObject=require('../internal/isHostObject'),isObjectLike=require('../internal/isObjectLike'),support=require('../support');var objectTag='[object Object]';var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function isPlainObject(value){var Ctor;if(!(isObjectLike(value)&&objToString.call(value)==objectTag&&!isHostObject(value)&&!isArguments(value))||(!hasOwnProperty.call(value,'constructor')&&(Ctor=value.constructor,typeof Ctor=='function'&&!(Ctor instanceof Ctor)))){return false;}
var result;if(support.ownLast){baseForIn(value,function(subValue,key,object){result=hasOwnProperty.call(object,key);return false;});return result!==false;}
baseForIn(value,function(subValue,key){result=key;});return result===undefined||hasOwnProperty.call(value,result);}
module.exports=isPlainObject;},{"../internal/baseForIn":32,"../internal/isHostObject":42,"../internal/isObjectLike":46,"../support":61,"./isArguments":49}],55:[function(require,module,exports){var isObjectLike=require('../internal/isObjectLike');var stringTag='[object String]';var objectProto=Object.prototype;var objToString=objectProto.toString;function isString(value){return typeof value=='string'||(isObjectLike(value)&&objToString.call(value)==stringTag);}
module.exports=isString;},{"../internal/isObjectLike":46}],56:[function(require,module,exports){var isLength=require('../internal/isLength'),isObjectLike=require('../internal/isObjectLike');var argsTag='[object Arguments]',arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',mapTag='[object Map]',numberTag='[object Number]',objectTag='[object Object]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var objectProto=Object.prototype;var objToString=objectProto.toString;function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)];}
module.exports=isTypedArray;},{"../internal/isLength":45,"../internal/isObjectLike":46}],57:[function(require,module,exports){var baseCopy=require('../internal/baseCopy'),keysIn=require('../object/keysIn');function toPlainObject(value){return baseCopy(value,keysIn(value));}
module.exports=toPlainObject;},{"../internal/baseCopy":30,"../object/keysIn":59}],58:[function(require,module,exports){var getNative=require('../internal/getNative'),isArrayLike=require('../internal/isArrayLike'),isObject=require('../lang/isObject'),shimKeys=require('../internal/shimKeys'),support=require('../support');var nativeKeys=getNative(Object,'keys');var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if((typeof Ctor=='function'&&Ctor.prototype===object)||(typeof object=='function'?support.enumPrototypes:isArrayLike(object))){return shimKeys(object);}
return isObject(object)?nativeKeys(object):[];};module.exports=keys;},{"../internal/getNative":40,"../internal/isArrayLike":41,"../internal/shimKeys":47,"../lang/isObject":53,"../support":61}],59:[function(require,module,exports){var arrayEach=require('../internal/arrayEach'),isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isFunction=require('../lang/isFunction'),isIndex=require('../internal/isIndex'),isLength=require('../internal/isLength'),isObject=require('../lang/isObject'),isString=require('../lang/isString'),support=require('../support');var arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',numberTag='[object Number]',objectTag='[object Object]',regexpTag='[object RegExp]',stringTag='[object String]';var shadowProps=['constructor','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','valueOf'];var errorProto=Error.prototype,objectProto=Object.prototype,stringProto=String.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var nonEnumProps={};nonEnumProps[arrayTag]=nonEnumProps[dateTag]=nonEnumProps[numberTag]={'constructor':true,'toLocaleString':true,'toString':true,'valueOf':true};nonEnumProps[boolTag]=nonEnumProps[stringTag]={'constructor':true,'toString':true,'valueOf':true};nonEnumProps[errorTag]=nonEnumProps[funcTag]=nonEnumProps[regexpTag]={'constructor':true,'toString':true};nonEnumProps[objectTag]={'constructor':true};arrayEach(shadowProps,function(key){for(var tag in nonEnumProps){if(hasOwnProperty.call(nonEnumProps,tag)){var props=nonEnumProps[tag];props[key]=hasOwnProperty.call(props,key);}}});function keysIn(object){if(object==null){return[];}
if(!isObject(object)){object=Object(object);}
var length=object.length;length=(length&&isLength(length)&&(isArray(object)||isArguments(object)||isString(object))&&length)||0;var Ctor=object.constructor,index=-1,proto=(isFunction(Ctor)&&Ctor.prototype)||objectProto,isProto=proto===object,result=Array(length),skipIndexes=length>0,skipErrorProps=support.enumErrorProps&&(object===errorProto||object instanceof Error),skipProto=support.enumPrototypes&&isFunction(object);while(++index<length){result[index]=(index+'');}
for(var key in object){if(!(skipProto&&key=='prototype')&&!(skipErrorProps&&(key=='message'||key=='name'))&&!(skipIndexes&&isIndex(key,length))&&!(key=='constructor'&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key);}}
if(support.nonEnumShadows&&object!==objectProto){var tag=object===stringProto?stringTag:(object===errorProto?errorTag:objToString.call(object)),nonEnums=nonEnumProps[tag]||nonEnumProps[objectTag];if(tag==objectTag){proto=objectProto;}
length=shadowProps.length;while(length--){key=shadowProps[length];var nonEnum=nonEnums[key];if(!(isProto&&nonEnum)&&(nonEnum?hasOwnProperty.call(object,key):object[key]!==proto[key])){result.push(key);}}}
return result;}
module.exports=keysIn;},{"../internal/arrayEach":29,"../internal/isIndex":43,"../internal/isLength":45,"../lang/isArguments":49,"../lang/isArray":50,"../lang/isFunction":51,"../lang/isObject":53,"../lang/isString":55,"../support":61}],60:[function(require,module,exports){var baseMerge=require('../internal/baseMerge'),createAssigner=require('../internal/createAssigner');var merge=createAssigner(baseMerge);module.exports=merge;},{"../internal/baseMerge":33,"../internal/createAssigner":37}],61:[function(require,module,exports){var arrayProto=Array.prototype,errorProto=Error.prototype,objectProto=Object.prototype;var propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice;var support={};(function(x){var Ctor=function(){this.x=x;},object={'0':x,'length':x},props=[];Ctor.prototype={'valueOf':x,'y':x};for(var key in new Ctor){props.push(key);}
support.enumErrorProps=propertyIsEnumerable.call(errorProto,'message')||propertyIsEnumerable.call(errorProto,'name');support.enumPrototypes=propertyIsEnumerable.call(Ctor,'prototype');support.nonEnumShadows=!/valueOf/.test(props);support.ownLast=props[0]!='x';support.spliceObjects=(splice.call(object,0,1),!object[0]);support.unindexedChars=('x'[0]+Object('x')[0])!='xx';}(1,0));module.exports=support;},{}],62:[function(require,module,exports){function identity(value){return value;}
module.exports=identity;},{}],63:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _lineStream=require('./line-stream');var _lineStream2=_interopRequireDefault(_lineStream);var _parseStream=require('./parse-stream');var _parseStream2=_interopRequireDefault(_parseStream);var _parser=require('./parser');var _parser2=_interopRequireDefault(_parser);exports['default']={LineStream:_lineStream2['default'],ParseStream:_parseStream2['default'],Parser:_parser2['default']};module.exports=exports['default'];},{"./line-stream":64,"./parse-stream":65,"./parser":66}],64:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _stream=require('./stream');var _stream2=_interopRequireDefault(_stream);var LineStream=(function(_Stream){_inherits(LineStream,_Stream);function LineStream(){_classCallCheck(this,LineStream);_get(Object.getPrototypeOf(LineStream.prototype),'constructor',this).call(this);this.buffer='';}
_createClass(LineStream,[{key:'push',value:function push(data){var nextNewline=undefined;this.buffer+=data;nextNewline=this.buffer.indexOf('\n');for(;nextNewline>-1;nextNewline=this.buffer.indexOf('\n')){this.trigger('data',this.buffer.substring(0,nextNewline));this.buffer=this.buffer.substring(nextNewline+1);}}}]);return LineStream;})(_stream2['default']);exports['default']=LineStream;module.exports=exports['default'];},{"./stream":67}],65:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i['return'])_i['return']();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError('Invalid attempt to destructure non-iterable instance');}};})();var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _stream=require('./stream');var _stream2=_interopRequireDefault(_stream);var attributeSeparator=function attributeSeparator(){var key='[^=]*';var value='"[^"]*"|[^,]*';var keyvalue='(?:'+key+')=(?:'+value+')';return new RegExp('(?:^|,)('+keyvalue+')');};var parseAttributes=function parseAttributes(attributes){var attrs=attributes.split(attributeSeparator());var i=attrs.length;var result={};var attr=undefined;while(i--){if(attrs[i]===''){continue;}
attr=/([^=]*)=(.*)/.exec(attrs[i]).slice(1);attr[0]=attr[0].replace(/^\s+|\s+$/g,'');attr[1]=attr[1].replace(/^\s+|\s+$/g,'');attr[1]=attr[1].replace(/^['"](.*)['"]$/g,'$1');result[attr[0]]=attr[1];}
return result;};var ParseStream=(function(_Stream){_inherits(ParseStream,_Stream);function ParseStream(){_classCallCheck(this,ParseStream);_get(Object.getPrototypeOf(ParseStream.prototype),'constructor',this).call(this);}
_createClass(ParseStream,[{key:'push',value:function push(line){var match=undefined;var event=undefined;line=line.replace(/^[\u0000\s]+|[\u0000\s]+$/g,'');if(line.length===0){return;}
if(line[0]!=='#'){this.trigger('data',{type:'uri',uri:line});return;}
if(line.indexOf('#EXT')!==0){this.trigger('data',{type:'comment',text:line.slice(1)});return;}
line=line.replace('\r','');match=/^#EXTM3U/.exec(line);if(match){this.trigger('data',{type:'tag',tagType:'m3u'});return;}
match=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(line);if(match){event={type:'tag',tagType:'inf'};if(match[1]){event.duration=parseFloat(match[1]);}
if(match[2]){event.title=match[2];}
this.trigger('data',event);return;}
match=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(line);if(match){event={type:'tag',tagType:'targetduration'};if(match[1]){event.duration=parseInt(match[1],10);}
this.trigger('data',event);return;}
match=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(line);if(match){event={type:'tag',tagType:'totalduration'};if(match[1]){event.duration=parseInt(match[1],10);}
this.trigger('data',event);return;}
match=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(line);if(match){event={type:'tag',tagType:'version'};if(match[1]){event.version=parseInt(match[1],10);}
this.trigger('data',event);return;}
match=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(line);if(match){event={type:'tag',tagType:'media-sequence'};if(match[1]){event.number=parseInt(match[1],10);}
this.trigger('data',event);return;}
match=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(line);if(match){event={type:'tag',tagType:'discontinuity-sequence'};if(match[1]){event.number=parseInt(match[1],10);}
this.trigger('data',event);return;}
match=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(line);if(match){event={type:'tag',tagType:'playlist-type'};if(match[1]){event.playlistType=match[1];}
this.trigger('data',event);return;}
match=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(line);if(match){event={type:'tag',tagType:'byterange'};if(match[1]){event.length=parseInt(match[1],10);}
if(match[2]){event.offset=parseInt(match[2],10);}
this.trigger('data',event);return;}
match=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(line);if(match){event={type:'tag',tagType:'allow-cache'};if(match[1]){event.allowed=!/NO/.test(match[1]);}
this.trigger('data',event);return;}
match=/^#EXT-X-MAP:?(.*)$/.exec(line);if(match){event={type:'tag',tagType:'map'};if(match[1]){var attributes=parseAttributes(match[1]);if(attributes.URI){event.uri=attributes.URI;}
if(attributes.BYTERANGE){var _attributes$BYTERANGE$split=attributes.BYTERANGE.split('@');var _attributes$BYTERANGE$split2=_slicedToArray(_attributes$BYTERANGE$split,2);var _length=_attributes$BYTERANGE$split2[0];var offset=_attributes$BYTERANGE$split2[1];event.byterange={};if(_length){event.byterange.length=parseInt(_length,10);}
if(offset){event.byterange.offset=parseInt(offset,10);}}}
this.trigger('data',event);return;}
match=/^#EXT-X-STREAM-INF:?(.*)$/.exec(line);if(match){event={type:'tag',tagType:'stream-inf'};if(match[1]){event.attributes=parseAttributes(match[1]);if(event.attributes.RESOLUTION){var split=event.attributes.RESOLUTION.split('x');var resolution={};if(split[0]){resolution.width=parseInt(split[0],10);}
if(split[1]){resolution.height=parseInt(split[1],10);}
event.attributes.RESOLUTION=resolution;}
if(event.attributes.BANDWIDTH){event.attributes.BANDWIDTH=parseInt(event.attributes.BANDWIDTH,10);}
if(event.attributes['PROGRAM-ID']){event.attributes['PROGRAM-ID']=parseInt(event.attributes['PROGRAM-ID'],10);}}
this.trigger('data',event);return;}
match=/^#EXT-X-MEDIA:?(.*)$/.exec(line);if(match){event={type:'tag',tagType:'media'};if(match[1]){event.attributes=parseAttributes(match[1]);}
this.trigger('data',event);return;}
match=/^#EXT-X-ENDLIST/.exec(line);if(match){this.trigger('data',{type:'tag',tagType:'endlist'});return;}
match=/^#EXT-X-DISCONTINUITY/.exec(line);if(match){this.trigger('data',{type:'tag',tagType:'discontinuity'});return;}
match=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(line);if(match){event={type:'tag',tagType:'program-date-time'};if(match[1]){event.dateTimeString=match[1];event.dateTimeObject=new Date(match[1]);}
this.trigger('data',event);return;}
match=/^#EXT-X-KEY:?(.*)$/.exec(line);if(match){event={type:'tag',tagType:'key'};if(match[1]){event.attributes=parseAttributes(match[1]);if(event.attributes.IV){if(event.attributes.IV.substring(0,2).toLowerCase()==='0x'){event.attributes.IV=event.attributes.IV.substring(2);}
event.attributes.IV=event.attributes.IV.match(/.{8}/g);event.attributes.IV[0]=parseInt(event.attributes.IV[0],16);event.attributes.IV[1]=parseInt(event.attributes.IV[1],16);event.attributes.IV[2]=parseInt(event.attributes.IV[2],16);event.attributes.IV[3]=parseInt(event.attributes.IV[3],16);event.attributes.IV=new Uint32Array(event.attributes.IV);}}
this.trigger('data',event);return;}
match=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(line);if(match){event={type:'tag',tagType:'cue-out-cont'};if(match[1]){event.data=match[1];}else{event.data='';}
this.trigger('data',event);return;}
match=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(line);if(match){event={type:'tag',tagType:'cue-out'};if(match[1]){event.data=match[1];}else{event.data='';}
this.trigger('data',event);return;}
match=/^#EXT-X-CUE-IN:?(.*)?$/.exec(line);if(match){event={type:'tag',tagType:'cue-in'};if(match[1]){event.data=match[1];}else{event.data='';}
this.trigger('data',event);return;}
this.trigger('data',{type:'tag',data:line.slice(4)});}}]);return ParseStream;})(_stream2['default']);exports['default']=ParseStream;module.exports=exports['default'];},{"./stream":67}],66:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _stream=require('./stream');var _stream2=_interopRequireDefault(_stream);var _lineStream=require('./line-stream');var _lineStream2=_interopRequireDefault(_lineStream);var _parseStream=require('./parse-stream');var _parseStream2=_interopRequireDefault(_parseStream);var _lodashCompatObjectMerge=require('lodash-compat/object/merge');var _lodashCompatObjectMerge2=_interopRequireDefault(_lodashCompatObjectMerge);var Parser=(function(_Stream){_inherits(Parser,_Stream);function Parser(){_classCallCheck(this,Parser);_get(Object.getPrototypeOf(Parser.prototype),'constructor',this).call(this);this.lineStream=new _lineStream2['default']();this.parseStream=new _parseStream2['default']();this.lineStream.pipe(this.parseStream);var self=this;var uris=[];var currentUri={};var currentMap=undefined;var _key=undefined;var noop=function noop(){};var defaultMediaGroups={'AUDIO':{},'VIDEO':{},'CLOSED-CAPTIONS':{},'SUBTITLES':{}};var currentTimeline=0;this.manifest={allowCache:true,discontinuityStarts:[]};this.parseStream.on('data',function(entry){var mediaGroup=undefined;var rendition=undefined;({tag:function tag(){(({'allow-cache':function allowCache(){this.manifest.allowCache=entry.allowed;if(!('allowed'in entry)){this.trigger('info',{message:'defaulting allowCache to YES'});this.manifest.allowCache=true;}},byterange:function byterange(){var byterange={};if('length'in entry){currentUri.byterange=byterange;byterange.length=entry.length;if(!('offset'in entry)){this.trigger('info',{message:'defaulting offset to zero'});entry.offset=0;}}
if('offset'in entry){currentUri.byterange=byterange;byterange.offset=entry.offset;}},endlist:function endlist(){this.manifest.endList=true;},inf:function inf(){if(!('mediaSequence'in this.manifest)){this.manifest.mediaSequence=0;this.trigger('info',{message:'defaulting media sequence to zero'});}
if(!('discontinuitySequence'in this.manifest)){this.manifest.discontinuitySequence=0;this.trigger('info',{message:'defaulting discontinuity sequence to zero'});}
if(entry.duration>0){currentUri.duration=entry.duration;}
if(entry.duration===0){currentUri.duration=0.01;this.trigger('info',{message:'updating zero segment duration to a small value'});}
this.manifest.segments=uris;},key:function key(){if(!entry.attributes){this.trigger('warn',{message:'ignoring key declaration without attribute list'});return;}
if(entry.attributes.METHOD==='NONE'){_key=null;return;}
if(!entry.attributes.URI){this.trigger('warn',{message:'ignoring key declaration without URI'});return;}
if(!entry.attributes.METHOD){this.trigger('warn',{message:'defaulting key method to AES-128'});}
_key={method:entry.attributes.METHOD||'AES-128',uri:entry.attributes.URI};if(typeof entry.attributes.IV!=='undefined'){_key.iv=entry.attributes.IV;}},'media-sequence':function mediaSequence(){if(!isFinite(entry.number)){this.trigger('warn',{message:'ignoring invalid media sequence: '+entry.number});return;}
this.manifest.mediaSequence=entry.number;},'discontinuity-sequence':function discontinuitySequence(){if(!isFinite(entry.number)){this.trigger('warn',{message:'ignoring invalid discontinuity sequence: '+entry.number});return;}
this.manifest.discontinuitySequence=entry.number;currentTimeline=entry.number;},'playlist-type':function playlistType(){if(!/VOD|EVENT/.test(entry.playlistType)){this.trigger('warn',{message:'ignoring unknown playlist type: '+entry.playlist});return;}
this.manifest.playlistType=entry.playlistType;},map:function map(){currentMap={};if(entry.uri){currentMap.uri=entry.uri;}
if(entry.byterange){currentMap.byterange=entry.byterange;}},'stream-inf':function streamInf(){this.manifest.playlists=uris;this.manifest.mediaGroups=this.manifest.mediaGroups||defaultMediaGroups;if(!entry.attributes){this.trigger('warn',{message:'ignoring empty stream-inf attributes'});return;}
if(!currentUri.attributes){currentUri.attributes={};}
currentUri.attributes=(0,_lodashCompatObjectMerge2['default'])(currentUri.attributes,entry.attributes);},media:function media(){this.manifest.mediaGroups=this.manifest.mediaGroups||defaultMediaGroups;if(!(entry.attributes&&entry.attributes.TYPE&&entry.attributes['GROUP-ID']&&entry.attributes.NAME)){this.trigger('warn',{message:'ignoring incomplete or missing media group'});return;}
var mediaGroupType=this.manifest.mediaGroups[entry.attributes.TYPE];mediaGroupType[entry.attributes['GROUP-ID']]=mediaGroupType[entry.attributes['GROUP-ID']]||{};mediaGroup=mediaGroupType[entry.attributes['GROUP-ID']];rendition={'default':/yes/i.test(entry.attributes.DEFAULT)};if(rendition['default']){rendition.autoselect=true;}else{rendition.autoselect=/yes/i.test(entry.attributes.AUTOSELECT);}
if(entry.attributes.LANGUAGE){rendition.language=entry.attributes.LANGUAGE;}
if(entry.attributes.URI){rendition.uri=entry.attributes.URI;}
if(entry.attributes['INSTREAM-ID']){rendition.instreamId=entry.attributes['INSTREAM-ID'];}
mediaGroup[entry.attributes.NAME]=rendition;},discontinuity:function discontinuity(){currentTimeline+=1;currentUri.discontinuity=true;this.manifest.discontinuityStarts.push(uris.length);},'program-date-time':function programDateTime(){this.manifest.dateTimeString=entry.dateTimeString;this.manifest.dateTimeObject=entry.dateTimeObject;},targetduration:function targetduration(){if(!isFinite(entry.duration)||entry.duration<0){this.trigger('warn',{message:'ignoring invalid target duration: '+entry.duration});return;}
this.manifest.targetDuration=entry.duration;},totalduration:function totalduration(){if(!isFinite(entry.duration)||entry.duration<0){this.trigger('warn',{message:'ignoring invalid total duration: '+entry.duration});return;}
this.manifest.totalDuration=entry.duration;},'cue-out':function cueOut(){currentUri.cueOut=entry.data;},'cue-out-cont':function cueOutCont(){currentUri.cueOutCont=entry.data;},'cue-in':function cueIn(){currentUri.cueIn=entry.data;}})[entry.tagType]||noop).call(self);},uri:function uri(){currentUri.uri=entry.uri;uris.push(currentUri);if(this.manifest.targetDuration&&!('duration'in currentUri)){this.trigger('warn',{message:'defaulting segment duration to the target duration'});currentUri.duration=this.manifest.targetDuration;}
if(_key){currentUri.key=_key;}
currentUri.timeline=currentTimeline;if(currentMap){currentUri.map=currentMap;}
currentUri={};},comment:function comment(){}})[entry.type].call(self);});}
_createClass(Parser,[{key:'push',value:function push(chunk){this.lineStream.push(chunk);}},{key:'end',value:function end(){this.lineStream.push('\n');}}]);return Parser;})(_stream2['default']);exports['default']=Parser;module.exports=exports['default'];},{"./line-stream":64,"./parse-stream":65,"./stream":67,"lodash-compat/object/merge":60}],67:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{"dup":14}],68:[function(require,module,exports){'use strict';var Stream=require('../utils/stream.js');var AacStream;AacStream=function(){var
everything=new Uint8Array(),timeStamp=0;AacStream.prototype.init.call(this);this.setTimestamp=function(timestamp){timeStamp=timestamp;};this.parseId3TagSize=function(header,byteIndex){var
returnSize=(header[byteIndex+6]<<21)|(header[byteIndex+7]<<14)|(header[byteIndex+8]<<7)|(header[byteIndex+9]),flags=header[byteIndex+5],footerPresent=(flags&16)>>4;if(footerPresent){return returnSize+20;}
return returnSize+10;};this.parseAdtsSize=function(header,byteIndex){var
lowThree=(header[byteIndex+5]&0xE0)>>5,middle=header[byteIndex+4]<<3,highTwo=header[byteIndex+3]&0x3<<11;return(highTwo|middle)|lowThree;};this.push=function(bytes){var
frameSize=0,byteIndex=0,bytesLeft,chunk,packet,tempLength;if(everything.length){tempLength=everything.length;everything=new Uint8Array(bytes.byteLength+tempLength);everything.set(everything.subarray(0,tempLength));everything.set(bytes,tempLength);}else{everything=bytes;}
while(everything.length-byteIndex>=3){if((everything[byteIndex]==='I'.charCodeAt(0))&&(everything[byteIndex+1]==='D'.charCodeAt(0))&&(everything[byteIndex+2]==='3'.charCodeAt(0))){if(everything.length-byteIndex<10){break;}
frameSize=this.parseId3TagSize(everything,byteIndex);if(frameSize>everything.length){break;}
chunk={type:'timed-metadata',data:everything.subarray(byteIndex,byteIndex+frameSize)};this.trigger('data',chunk);byteIndex+=frameSize;continue;}else if((everything[byteIndex]&0xff===0xff)&&((everything[byteIndex+1]&0xf0)===0xf0)){if(everything.length-byteIndex<7){break;}
frameSize=this.parseAdtsSize(everything,byteIndex);if(frameSize>everything.length){break;}
packet={type:'audio',data:everything.subarray(byteIndex,byteIndex+frameSize),pts:timeStamp,dts:timeStamp};this.trigger('data',packet);byteIndex+=frameSize;continue;}
byteIndex++;}
bytesLeft=everything.length-byteIndex;if(bytesLeft>0){everything=everything.subarray(byteIndex);}else{everything=new Uint8Array();}};};AacStream.prototype=new Stream();module.exports=AacStream;},{"../utils/stream.js":85}],69:[function(require,module,exports){'use strict';var Stream=require('../utils/stream.js');var AdtsStream;var
ADTS_SAMPLING_FREQUENCIES=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];AdtsStream=function(){var buffer;AdtsStream.prototype.init.call(this);this.push=function(packet){var
i=0,frameNum=0,frameLength,protectionSkipBytes,frameEnd,oldBuffer,sampleCount,adtsFrameDuration;if(packet.type!=='audio'){return;}
if(buffer){oldBuffer=buffer;buffer=new Uint8Array(oldBuffer.byteLength+packet.data.byteLength);buffer.set(oldBuffer);buffer.set(packet.data,oldBuffer.byteLength);}else{buffer=packet.data;}
while(i+5<buffer.length){if(buffer[i]!==0xFF||(buffer[i+1]&0xF6)!==0xF0){i++;continue;}
protectionSkipBytes=(~buffer[i+1]&0x01)*2;frameLength=((buffer[i+3]&0x03)<<11)|(buffer[i+4]<<3)|((buffer[i+5]&0xe0)>>5);sampleCount=((buffer[i+6]&0x03)+1)*1024;adtsFrameDuration=(sampleCount*90000)/ADTS_SAMPLING_FREQUENCIES[(buffer[i+2]&0x3c)>>>2];frameEnd=i+frameLength;if(buffer.byteLength<frameEnd){return;}
this.trigger('data',{pts:packet.pts+(frameNum*adtsFrameDuration),dts:packet.dts+(frameNum*adtsFrameDuration),sampleCount:sampleCount,audioobjecttype:((buffer[i+2]>>>6)&0x03)+1,channelcount:((buffer[i+2]&1)<<2)|((buffer[i+3]&0xc0)>>>6),samplerate:ADTS_SAMPLING_FREQUENCIES[(buffer[i+2]&0x3c)>>>2],samplingfrequencyindex:(buffer[i+2]&0x3c)>>>2,samplesize:16,data:buffer.subarray(i+7+protectionSkipBytes,frameEnd)});if(buffer.byteLength===frameEnd){buffer=undefined;return;}
frameNum++;buffer=buffer.subarray(frameEnd);}};this.flush=function(){this.trigger('done');};};AdtsStream.prototype=new Stream();module.exports=AdtsStream;},{"../utils/stream.js":85}],70:[function(require,module,exports){'use strict';var Stream=require('../utils/stream.js');var ExpGolomb=require('../utils/exp-golomb.js');var H264Stream,NalByteStream;var PROFILES_WITH_OPTIONAL_SPS_DATA;NalByteStream=function(){var
syncPoint=0,i,buffer;NalByteStream.prototype.init.call(this);this.push=function(data){var swapBuffer;if(!buffer){buffer=data.data;}else{swapBuffer=new Uint8Array(buffer.byteLength+data.data.byteLength);swapBuffer.set(buffer);swapBuffer.set(data.data,buffer.byteLength);buffer=swapBuffer;}
for(;syncPoint<buffer.byteLength-3;syncPoint++){if(buffer[syncPoint+2]===1){i=syncPoint+5;break;}}
while(i<buffer.byteLength){switch(buffer[i]){case 0:if(buffer[i-1]!==0){i+=2;break;}else if(buffer[i-2]!==0){i++;break;}
if(syncPoint+3!==i-2){this.trigger('data',buffer.subarray(syncPoint+3,i-2));}
do{i++;}while(buffer[i]!==1&&i<buffer.length);syncPoint=i-2;i+=3;break;case 1:if(buffer[i-1]!==0||buffer[i-2]!==0){i+=3;break;}
this.trigger('data',buffer.subarray(syncPoint+3,i-2));syncPoint=i-2;i+=3;break;default:i+=3;break;}}
buffer=buffer.subarray(syncPoint);i-=syncPoint;syncPoint=0;};this.flush=function(){if(buffer&&buffer.byteLength>3){this.trigger('data',buffer.subarray(syncPoint+3));}
buffer=null;syncPoint=0;this.trigger('done');};};NalByteStream.prototype=new Stream();PROFILES_WITH_OPTIONAL_SPS_DATA={100:true,110:true,122:true,244:true,44:true,83:true,86:true,118:true,128:true,138:true,139:true,134:true};H264Stream=function(){var
nalByteStream=new NalByteStream(),self,trackId,currentPts,currentDts,discardEmulationPreventionBytes,readSequenceParameterSet,skipScalingList;H264Stream.prototype.init.call(this);self=this;this.push=function(packet){if(packet.type!=='video'){return;}
trackId=packet.trackId;currentPts=packet.pts;currentDts=packet.dts;nalByteStream.push(packet);};nalByteStream.on('data',function(data){var
event={trackId:trackId,pts:currentPts,dts:currentDts,data:data};switch(data[0]&0x1f){case 0x05:event.nalUnitType='slice_layer_without_partitioning_rbsp_idr';break;case 0x06:event.nalUnitType='sei_rbsp';event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1));break;case 0x07:event.nalUnitType='seq_parameter_set_rbsp';event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1));event.config=readSequenceParameterSet(event.escapedRBSP);break;case 0x08:event.nalUnitType='pic_parameter_set_rbsp';break;case 0x09:event.nalUnitType='access_unit_delimiter_rbsp';break;default:break;}
self.trigger('data',event);});nalByteStream.on('done',function(){self.trigger('done');});this.flush=function(){nalByteStream.flush();};skipScalingList=function(count,expGolombDecoder){var
lastScale=8,nextScale=8,j,deltaScale;for(j=0;j<count;j++){if(nextScale!==0){deltaScale=expGolombDecoder.readExpGolomb();nextScale=(lastScale+deltaScale+256)%256;}
lastScale=(nextScale===0)?lastScale:nextScale;}};discardEmulationPreventionBytes=function(data){var
length=data.byteLength,emulationPreventionBytesPositions=[],i=1,newLength,newData;while(i<length-2){if(data[i]===0&&data[i+1]===0&&data[i+2]===0x03){emulationPreventionBytesPositions.push(i+2);i+=2;}else{i++;}}
if(emulationPreventionBytesPositions.length===0){return data;}
newLength=length-emulationPreventionBytesPositions.length;newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++){if(sourceIndex===emulationPreventionBytesPositions[0]){sourceIndex++;emulationPreventionBytesPositions.shift();}
newData[i]=data[sourceIndex];}
return newData;};readSequenceParameterSet=function(data){var
frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,sarScale=1,expGolombDecoder,profileIdc,levelIdc,profileCompatibility,chromaFormatIdc,picOrderCntType,numRefFramesInPicOrderCntCycle,picWidthInMbsMinus1,picHeightInMapUnitsMinus1,frameMbsOnlyFlag,scalingListCount,sarRatio,aspectRatioIdc,i;expGolombDecoder=new ExpGolomb(data);profileIdc=expGolombDecoder.readUnsignedByte();profileCompatibility=expGolombDecoder.readUnsignedByte();levelIdc=expGolombDecoder.readUnsignedByte();expGolombDecoder.skipUnsignedExpGolomb();if(PROFILES_WITH_OPTIONAL_SPS_DATA[profileIdc]){chromaFormatIdc=expGolombDecoder.readUnsignedExpGolomb();if(chromaFormatIdc===3){expGolombDecoder.skipBits(1);}
expGolombDecoder.skipUnsignedExpGolomb();expGolombDecoder.skipUnsignedExpGolomb();expGolombDecoder.skipBits(1);if(expGolombDecoder.readBoolean()){scalingListCount=(chromaFormatIdc!==3)?8:12;for(i=0;i<scalingListCount;i++){if(expGolombDecoder.readBoolean()){if(i<6){skipScalingList(16,expGolombDecoder);}else{skipScalingList(64,expGolombDecoder);}}}}}
expGolombDecoder.skipUnsignedExpGolomb();picOrderCntType=expGolombDecoder.readUnsignedExpGolomb();if(picOrderCntType===0){expGolombDecoder.readUnsignedExpGolomb();}else if(picOrderCntType===1){expGolombDecoder.skipBits(1);expGolombDecoder.skipExpGolomb();expGolombDecoder.skipExpGolomb();numRefFramesInPicOrderCntCycle=expGolombDecoder.readUnsignedExpGolomb();for(i=0;i<numRefFramesInPicOrderCntCycle;i++){expGolombDecoder.skipExpGolomb();}}
expGolombDecoder.skipUnsignedExpGolomb();expGolombDecoder.skipBits(1);picWidthInMbsMinus1=expGolombDecoder.readUnsignedExpGolomb();picHeightInMapUnitsMinus1=expGolombDecoder.readUnsignedExpGolomb();frameMbsOnlyFlag=expGolombDecoder.readBits(1);if(frameMbsOnlyFlag===0){expGolombDecoder.skipBits(1);}
expGolombDecoder.skipBits(1);if(expGolombDecoder.readBoolean()){frameCropLeftOffset=expGolombDecoder.readUnsignedExpGolomb();frameCropRightOffset=expGolombDecoder.readUnsignedExpGolomb();frameCropTopOffset=expGolombDecoder.readUnsignedExpGolomb();frameCropBottomOffset=expGolombDecoder.readUnsignedExpGolomb();}
if(expGolombDecoder.readBoolean()){if(expGolombDecoder.readBoolean()){aspectRatioIdc=expGolombDecoder.readUnsignedByte();switch(aspectRatioIdc){case 1:sarRatio=[1,1];break;case 2:sarRatio=[12,11];break;case 3:sarRatio=[10,11];break;case 4:sarRatio=[16,11];break;case 5:sarRatio=[40,33];break;case 6:sarRatio=[24,11];break;case 7:sarRatio=[20,11];break;case 8:sarRatio=[32,11];break;case 9:sarRatio=[80,33];break;case 10:sarRatio=[18,11];break;case 11:sarRatio=[15,11];break;case 12:sarRatio=[64,33];break;case 13:sarRatio=[160,99];break;case 14:sarRatio=[4,3];break;case 15:sarRatio=[3,2];break;case 16:sarRatio=[2,1];break;case 255:{sarRatio=[expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte(),expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte()];break;}}
if(sarRatio){sarScale=sarRatio[0]/sarRatio[1];}}}
return{profileIdc:profileIdc,levelIdc:levelIdc,profileCompatibility:profileCompatibility,width:Math.ceil((((picWidthInMbsMinus1+1)*16)-frameCropLeftOffset*2-frameCropRightOffset*2)*sarScale),height:((2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16)-(frameCropTopOffset*2)-(frameCropBottomOffset*2)};};};H264Stream.prototype=new Stream();module.exports={H264Stream:H264Stream,NalByteStream:NalByteStream};},{"../utils/exp-golomb.js":84,"../utils/stream.js":85}],71:[function(require,module,exports){'use strict';var Stream=require('../utils/stream.js');var CoalesceStream=function(options){this.numberOfTracks=0;this.metadataStream=options.metadataStream;this.videoTags=[];this.audioTags=[];this.videoTrack=null;this.audioTrack=null;this.pendingCaptions=[];this.pendingMetadata=[];this.pendingTracks=0;this.processedTracks=0;CoalesceStream.prototype.init.call(this);this.push=function(output){if(output.text){return this.pendingCaptions.push(output);}
if(output.frames){return this.pendingMetadata.push(output);}
if(output.track.type==='video'){this.videoTrack=output.track;this.videoTags=output.tags;this.pendingTracks++;}
if(output.track.type==='audio'){this.audioTrack=output.track;this.audioTags=output.tags;this.pendingTracks++;}};};CoalesceStream.prototype=new Stream();CoalesceStream.prototype.flush=function(flushSource){var
id3,caption,i,timelineStartPts,event={tags:{},captions:[],metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(flushSource!=='VideoSegmentStream'&&flushSource!=='AudioSegmentStream'){return;}else if(this.pendingTracks===0){this.processedTracks++;if(this.processedTracks<this.numberOfTracks){return;}}}
this.processedTracks+=this.pendingTracks;this.pendingTracks=0;if(this.processedTracks<this.numberOfTracks){return;}
if(this.videoTrack){timelineStartPts=this.videoTrack.timelineStartInfo.pts;}else if(this.audioTrack){timelineStartPts=this.audioTrack.timelineStartInfo.pts;}
event.tags.videoTags=this.videoTags;event.tags.audioTags=this.audioTags;for(i=0;i<this.pendingCaptions.length;i++){caption=this.pendingCaptions[i];caption.startTime=caption.startPts-timelineStartPts;caption.startTime/=90e3;caption.endTime=caption.endPts-timelineStartPts;caption.endTime/=90e3;event.captions.push(caption);}
for(i=0;i<this.pendingMetadata.length;i++){id3=this.pendingMetadata[i];id3.cueTime=id3.pts-timelineStartPts;id3.cueTime/=90e3;event.metadata.push(id3);}
event.metadata.dispatchType=this.metadataStream.dispatchType;this.videoTrack=null;this.audioTrack=null;this.videoTags=[];this.audioTags=[];this.pendingCaptions.length=0;this.pendingMetadata.length=0;this.pendingTracks=0;this.processedTracks=0;this.trigger('data',event);this.trigger('done');};module.exports=CoalesceStream;},{"../utils/stream.js":85}],72:[function(require,module,exports){'use strict';var FlvTag;FlvTag=function(type,extraData){var
adHoc=0,bufferStartSize=16384,prepareWrite=function(flv,count){var
bytes,minLength=flv.position+count;if(minLength<flv.bytes.byteLength){return;}
bytes=new Uint8Array(minLength*2);bytes.set(flv.bytes.subarray(0,flv.position),0);flv.bytes=bytes;flv.view=new DataView(flv.bytes.buffer);},widthBytes=FlvTag.widthBytes||new Uint8Array('width'.length),heightBytes=FlvTag.heightBytes||new Uint8Array('height'.length),videocodecidBytes=FlvTag.videocodecidBytes||new Uint8Array('videocodecid'.length),i;if(!FlvTag.widthBytes){for(i=0;i<'width'.length;i++){widthBytes[i]='width'.charCodeAt(i);}
for(i=0;i<'height'.length;i++){heightBytes[i]='height'.charCodeAt(i);}
for(i=0;i<'videocodecid'.length;i++){videocodecidBytes[i]='videocodecid'.charCodeAt(i);}
FlvTag.widthBytes=widthBytes;FlvTag.heightBytes=heightBytes;FlvTag.videocodecidBytes=videocodecidBytes;}
this.keyFrame=false;switch(type){case FlvTag.VIDEO_TAG:this.length=16;bufferStartSize*=6;break;case FlvTag.AUDIO_TAG:this.length=13;this.keyFrame=true;break;case FlvTag.METADATA_TAG:this.length=29;this.keyFrame=true;break;default:throw new Error('Unknown FLV tag type');}
this.bytes=new Uint8Array(bufferStartSize);this.view=new DataView(this.bytes.buffer);this.bytes[0]=type;this.position=this.length;this.keyFrame=extraData;this.pts=0;this.dts=0;this.writeBytes=function(bytes,offset,length){var
start=offset||0,end;length=length||bytes.byteLength;end=start+length;prepareWrite(this,length);this.bytes.set(bytes.subarray(start,end),this.position);this.position+=length;this.length=Math.max(this.length,this.position);};this.writeByte=function(byte){prepareWrite(this,1);this.bytes[this.position]=byte;this.position++;this.length=Math.max(this.length,this.position);};this.writeShort=function(short){prepareWrite(this,2);this.view.setUint16(this.position,short);this.position+=2;this.length=Math.max(this.length,this.position);};this.negIndex=function(pos){return this.bytes[this.length-pos];};this.nalUnitSize=function(){if(adHoc===0){return 0;}
return this.length-(adHoc+4);};this.startNalUnit=function(){if(adHoc>0){throw new Error('Attempted to create new NAL wihout closing the old one');}
adHoc=this.length;this.length+=4;this.position=this.length;};this.endNalUnit=function(nalContainer){var
nalStart,nalLength;if(this.length===adHoc+4){this.length-=4;}else if(adHoc>0){nalStart=adHoc+4;nalLength=this.length-nalStart;this.position=adHoc;this.view.setUint32(this.position,nalLength);this.position=this.length;if(nalContainer){nalContainer.push(this.bytes.subarray(nalStart,nalStart+nalLength));}}
adHoc=0;};this.writeMetaDataDouble=function(key,val){var i;prepareWrite(this,2+key.length+9);this.view.setUint16(this.position,key.length);this.position+=2;if(key==='width'){this.bytes.set(widthBytes,this.position);this.position+=5;}else if(key==='height'){this.bytes.set(heightBytes,this.position);this.position+=6;}else if(key==='videocodecid'){this.bytes.set(videocodecidBytes,this.position);this.position+=12;}else{for(i=0;i<key.length;i++){this.bytes[this.position]=key.charCodeAt(i);this.position++;}}
this.position++;this.view.setFloat64(this.position,val);this.position+=8;this.length=Math.max(this.length,this.position);++adHoc;};this.writeMetaDataBoolean=function(key,val){var i;prepareWrite(this,2);this.view.setUint16(this.position,key.length);this.position+=2;for(i=0;i<key.length;i++){prepareWrite(this,1);this.bytes[this.position]=key.charCodeAt(i);this.position++;}
prepareWrite(this,2);this.view.setUint8(this.position,0x01);this.position++;this.view.setUint8(this.position,val?0x01:0x00);this.position++;this.length=Math.max(this.length,this.position);++adHoc;};this.finalize=function(){var
dtsDelta,len;switch(this.bytes[0]){case FlvTag.VIDEO_TAG:this.bytes[11]=((this.keyFrame||extraData)?0x10:0x20)|0x07;this.bytes[12]=extraData?0x00:0x01;dtsDelta=this.pts-this.dts;this.bytes[13]=(dtsDelta&0x00FF0000)>>>16;this.bytes[14]=(dtsDelta&0x0000FF00)>>>8;this.bytes[15]=(dtsDelta&0x000000FF)>>>0;break;case FlvTag.AUDIO_TAG:this.bytes[11]=0xAF;this.bytes[12]=extraData?0x00:0x01;break;case FlvTag.METADATA_TAG:this.position=11;this.view.setUint8(this.position,0x02);this.position++;this.view.setUint16(this.position,0x0A);this.position+=2;this.bytes.set([0x6f,0x6e,0x4d,0x65,0x74,0x61,0x44,0x61,0x74,0x61],this.position);this.position+=10;this.bytes[this.position]=0x08;this.position++;this.view.setUint32(this.position,adHoc);this.position=this.length;this.bytes.set([0,0,9],this.position);this.position+=3;this.length=this.position;break;}
len=this.length-11;this.bytes[1]=(len&0x00FF0000)>>>16;this.bytes[2]=(len&0x0000FF00)>>>8;this.bytes[3]=(len&0x000000FF)>>>0;this.bytes[4]=(this.dts&0x00FF0000)>>>16;this.bytes[5]=(this.dts&0x0000FF00)>>>8;this.bytes[6]=(this.dts&0x000000FF)>>>0;this.bytes[7]=(this.dts&0xFF000000)>>>24;this.bytes[8]=0;this.bytes[9]=0;this.bytes[10]=0;prepareWrite(this,4);this.view.setUint32(this.length,this.length);this.length+=4;this.position+=4;this.bytes=this.bytes.subarray(0,this.length);this.frameTime=FlvTag.frameTime(this.bytes);return this;};};FlvTag.AUDIO_TAG=0x08;FlvTag.VIDEO_TAG=0x09;FlvTag.METADATA_TAG=0x12;FlvTag.isAudioFrame=function(tag){return FlvTag.AUDIO_TAG===tag[0];};FlvTag.isVideoFrame=function(tag){return FlvTag.VIDEO_TAG===tag[0];};FlvTag.isMetaData=function(tag){return FlvTag.METADATA_TAG===tag[0];};FlvTag.isKeyFrame=function(tag){if(FlvTag.isVideoFrame(tag)){return tag[11]===0x17;}
if(FlvTag.isAudioFrame(tag)){return true;}
if(FlvTag.isMetaData(tag)){return true;}
return false;};FlvTag.frameTime=function(tag){var pts=tag[4]<<16;pts|=tag[5]<<8;pts|=tag[6]<<0;pts|=tag[7]<<24;return pts;};module.exports=FlvTag;},{}],73:[function(require,module,exports){module.exports={tag:require('./flv-tag'),Transmuxer:require('./transmuxer')};},{"./flv-tag":72,"./transmuxer":74}],74:[function(require,module,exports){'use strict';var Stream=require('../utils/stream.js');var FlvTag=require('./flv-tag.js');var m2ts=require('../m2ts/m2ts.js');var AdtsStream=require('../codecs/adts.js');var H264Stream=require('../codecs/h264').H264Stream;var CoalesceStream=require('./coalesce-stream.js');var
Transmuxer,VideoSegmentStream,AudioSegmentStream,collectTimelineInfo,metaDataTag,extraDataTag;collectTimelineInfo=function(track,data){if(typeof data.pts==='number'){if(track.timelineStartInfo.pts===undefined){track.timelineStartInfo.pts=data.pts;}else{track.timelineStartInfo.pts=Math.min(track.timelineStartInfo.pts,data.pts);}}
if(typeof data.dts==='number'){if(track.timelineStartInfo.dts===undefined){track.timelineStartInfo.dts=data.dts;}else{track.timelineStartInfo.dts=Math.min(track.timelineStartInfo.dts,data.dts);}}};metaDataTag=function(track,pts){var
tag=new FlvTag(FlvTag.METADATA_TAG);tag.dts=pts;tag.pts=pts;tag.writeMetaDataDouble('videocodecid',7);tag.writeMetaDataDouble('width',track.width);tag.writeMetaDataDouble('height',track.height);return tag;};extraDataTag=function(track,pts){var
i,tag=new FlvTag(FlvTag.VIDEO_TAG,true);tag.dts=pts;tag.pts=pts;tag.writeByte(0x01);tag.writeByte(track.profileIdc);tag.writeByte(track.profileCompatibility);tag.writeByte(track.levelIdc);tag.writeByte(0xFC|0x03);tag.writeByte(0xE0|0x01);tag.writeShort(track.sps[0].length);tag.writeBytes(track.sps[0]);tag.writeByte(track.pps.length);for(i=0;i<track.pps.length;++i){tag.writeShort(track.pps[i].length);tag.writeBytes(track.pps[i]);}
return tag;};AudioSegmentStream=function(track){var
adtsFrames=[],oldExtraData;AudioSegmentStream.prototype.init.call(this);this.push=function(data){collectTimelineInfo(track,data);if(track&&track.channelcount===undefined){track.audioobjecttype=data.audioobjecttype;track.channelcount=data.channelcount;track.samplerate=data.samplerate;track.samplingfrequencyindex=data.samplingfrequencyindex;track.samplesize=data.samplesize;track.extraData=(track.audioobjecttype<<11)|(track.samplingfrequencyindex<<7)|(track.channelcount<<3);}
data.pts=Math.round(data.pts/90);data.dts=Math.round(data.dts/90);adtsFrames.push(data);};this.flush=function(){var currentFrame,adtsFrame,lastMetaPts,tags=[];if(adtsFrames.length===0){this.trigger('done','AudioSegmentStream');return;}
lastMetaPts=-Infinity;while(adtsFrames.length){currentFrame=adtsFrames.shift();if(track.extraData!==oldExtraData||currentFrame.pts-lastMetaPts>=1000){adtsFrame=new FlvTag(FlvTag.METADATA_TAG);adtsFrame.pts=currentFrame.pts;adtsFrame.dts=currentFrame.dts;adtsFrame.writeMetaDataDouble('audiocodecid',10);adtsFrame.writeMetaDataBoolean('stereo',track.channelcount===2);adtsFrame.writeMetaDataDouble('audiosamplerate',track.samplerate);adtsFrame.writeMetaDataDouble('audiosamplesize',16);tags.push(adtsFrame);oldExtraData=track.extraData;adtsFrame=new FlvTag(FlvTag.AUDIO_TAG,true);adtsFrame.pts=currentFrame.pts;adtsFrame.dts=currentFrame.dts;adtsFrame.view.setUint16(adtsFrame.position,track.extraData);adtsFrame.position+=2;adtsFrame.length=Math.max(adtsFrame.length,adtsFrame.position);tags.push(adtsFrame);lastMetaPts=currentFrame.pts;}
adtsFrame=new FlvTag(FlvTag.AUDIO_TAG);adtsFrame.pts=currentFrame.pts;adtsFrame.dts=currentFrame.dts;adtsFrame.writeBytes(currentFrame.data);tags.push(adtsFrame);}
oldExtraData=null;this.trigger('data',{track:track,tags:tags});this.trigger('done','AudioSegmentStream');};};AudioSegmentStream.prototype=new Stream();VideoSegmentStream=function(track){var
nalUnits=[],config,h264Frame;VideoSegmentStream.prototype.init.call(this);this.finishFrame=function(tags,frame){if(!frame){return;}
if(config&&track&&track.newMetadata&&(frame.keyFrame||tags.length===0)){tags.push(metaDataTag(config,frame.dts));tags.push(extraDataTag(track,frame.dts));track.newMetadata=false;}
frame.endNalUnit();tags.push(frame);h264Frame=null;};this.push=function(data){collectTimelineInfo(track,data);data.pts=Math.round(data.pts/90);data.dts=Math.round(data.dts/90);nalUnits.push(data);};this.flush=function(){var
currentNal,tags=[];while(nalUnits.length){if(nalUnits[0].nalUnitType==='access_unit_delimiter_rbsp'){break;}
nalUnits.shift();}
if(nalUnits.length===0){this.trigger('done','VideoSegmentStream');return;}
while(nalUnits.length){currentNal=nalUnits.shift();if(currentNal.nalUnitType==='seq_parameter_set_rbsp'){track.newMetadata=true;config=currentNal.config;track.width=config.width;track.height=config.height;track.sps=[currentNal.data];track.profileIdc=config.profileIdc;track.levelIdc=config.levelIdc;track.profileCompatibility=config.profileCompatibility;h264Frame.endNalUnit();}else if(currentNal.nalUnitType==='pic_parameter_set_rbsp'){track.newMetadata=true;track.pps=[currentNal.data];h264Frame.endNalUnit();}else if(currentNal.nalUnitType==='access_unit_delimiter_rbsp'){if(h264Frame){this.finishFrame(tags,h264Frame);}
h264Frame=new FlvTag(FlvTag.VIDEO_TAG);h264Frame.pts=currentNal.pts;h264Frame.dts=currentNal.dts;}else{if(currentNal.nalUnitType==='slice_layer_without_partitioning_rbsp_idr'){h264Frame.keyFrame=true;}
h264Frame.endNalUnit();}
h264Frame.startNalUnit();h264Frame.writeBytes(currentNal.data);}
if(h264Frame){this.finishFrame(tags,h264Frame);}
this.trigger('data',{track:track,tags:tags});this.trigger('done','VideoSegmentStream');};};VideoSegmentStream.prototype=new Stream();Transmuxer=function(options){var
self=this,packetStream,parseStream,elementaryStream,videoTimestampRolloverStream,audioTimestampRolloverStream,timedMetadataTimestampRolloverStream,adtsStream,h264Stream,videoSegmentStream,audioSegmentStream,captionStream,coalesceStream;Transmuxer.prototype.init.call(this);options=options||{};this.metadataStream=new m2ts.MetadataStream();options.metadataStream=this.metadataStream;packetStream=new m2ts.TransportPacketStream();parseStream=new m2ts.TransportParseStream();elementaryStream=new m2ts.ElementaryStream();videoTimestampRolloverStream=new m2ts.TimestampRolloverStream('video');audioTimestampRolloverStream=new m2ts.TimestampRolloverStream('audio');timedMetadataTimestampRolloverStream=new m2ts.TimestampRolloverStream('timed-metadata');adtsStream=new AdtsStream();h264Stream=new H264Stream();coalesceStream=new CoalesceStream(options);packetStream.pipe(parseStream).pipe(elementaryStream);elementaryStream.pipe(videoTimestampRolloverStream).pipe(h264Stream);elementaryStream.pipe(audioTimestampRolloverStream).pipe(adtsStream);elementaryStream.pipe(timedMetadataTimestampRolloverStream).pipe(this.metadataStream).pipe(coalesceStream);captionStream=new m2ts.CaptionStream();h264Stream.pipe(captionStream).pipe(coalesceStream);elementaryStream.on('data',function(data){var i,videoTrack,audioTrack;if(data.type==='metadata'){i=data.tracks.length;while(i--){if(data.tracks[i].type==='video'){videoTrack=data.tracks[i];}else if(data.tracks[i].type==='audio'){audioTrack=data.tracks[i];}}
if(videoTrack&&!videoSegmentStream){coalesceStream.numberOfTracks++;videoSegmentStream=new VideoSegmentStream(videoTrack);h264Stream.pipe(videoSegmentStream).pipe(coalesceStream);}
if(audioTrack&&!audioSegmentStream){coalesceStream.numberOfTracks++;audioSegmentStream=new AudioSegmentStream(audioTrack);adtsStream.pipe(audioSegmentStream).pipe(coalesceStream);}}});this.push=function(data){packetStream.push(data);};this.flush=function(){packetStream.flush();};coalesceStream.on('data',function(event){self.trigger('data',event);});coalesceStream.on('done',function(){self.trigger('done');});this.getFlvHeader=function(duration,audio,video){var
headBytes=new Uint8Array(3+1+1+4),head=new DataView(headBytes.buffer),metadata,result,metadataLength;duration=duration||0;audio=audio===undefined?true:audio;video=video===undefined?true:video;head.setUint8(0,0x46);head.setUint8(1,0x4c);head.setUint8(2,0x56);head.setUint8(3,0x01);head.setUint8(4,(audio?0x04:0x00)|(video?0x01:0x00));head.setUint32(5,headBytes.byteLength);if(duration<=0){result=new Uint8Array(headBytes.byteLength+4);result.set(headBytes);result.set([0,0,0,0],headBytes.byteLength);return result;}
metadata=new FlvTag(FlvTag.METADATA_TAG);metadata.pts=metadata.dts=0;metadata.writeMetaDataDouble('duration',duration);metadataLength=metadata.finalize().length;result=new Uint8Array(headBytes.byteLength+metadataLength);result.set(headBytes);result.set(head.byteLength,metadataLength);return result;};};Transmuxer.prototype=new Stream();module.exports=Transmuxer;},{"../codecs/adts.js":69,"../codecs/h264":70,"../m2ts/m2ts.js":76,"../utils/stream.js":85,"./coalesce-stream.js":71,"./flv-tag.js":72}],75:[function(require,module,exports){'use strict';var USER_DATA_REGISTERED_ITU_T_T35=4,RBSP_TRAILING_BITS=128,Stream=require('../utils/stream');var parseSei=function(bytes){var
i=0,result={payloadType:-1,payloadSize:0},payloadType=0,payloadSize=0;while(i<bytes.byteLength){if(bytes[i]===RBSP_TRAILING_BITS){break;}
while(bytes[i]===0xFF){payloadType+=255;i++;}
payloadType+=bytes[i++];while(bytes[i]===0xFF){payloadSize+=255;i++;}
payloadSize+=bytes[i++];if(!result.payload&&payloadType===USER_DATA_REGISTERED_ITU_T_T35){result.payloadType=payloadType;result.payloadSize=payloadSize;result.payload=bytes.subarray(i,i+payloadSize);break;}
i+=payloadSize;payloadType=0;payloadSize=0;}
return result;};var parseUserData=function(sei){if(sei.payload[0]!==181){return null;}
if(((sei.payload[1]<<8)|sei.payload[2])!==49){return null;}
if(String.fromCharCode(sei.payload[3],sei.payload[4],sei.payload[5],sei.payload[6])!=='GA94'){return null;}
if(sei.payload[7]!==0x03){return null;}
return sei.payload.subarray(8,sei.payload.length-1);};var parseCaptionPackets=function(pts,userData){var results=[],i,count,offset,data;if(!(userData[0]&0x40)){return results;}
count=userData[0]&0x1f;for(i=0;i<count;i++){offset=i*3;data={type:userData[offset+2]&0x03,pts:pts};if(userData[offset+2]&0x04){data.ccData=(userData[offset+3]<<8)|userData[offset+4];results.push(data);}}
return results;};var CaptionStream=function(){CaptionStream.prototype.init.call(this);this.captionPackets_=[];this.field1_=new Cea608Stream();this.field1_.on('data',this.trigger.bind(this,'data'));this.field1_.on('done',this.trigger.bind(this,'done'));};CaptionStream.prototype=new Stream();CaptionStream.prototype.push=function(event){var sei,userData;if(event.nalUnitType!=='sei_rbsp'){return;}
sei=parseSei(event.escapedRBSP);if(sei.payloadType!==USER_DATA_REGISTERED_ITU_T_T35){return;}
userData=parseUserData(sei);if(!userData){return;}
this.captionPackets_=this.captionPackets_.concat(parseCaptionPackets(event.pts,userData));};CaptionStream.prototype.flush=function(){if(!this.captionPackets_.length){this.field1_.flush();return;}
this.captionPackets_.forEach(function(elem,idx){elem.presortIndex=idx;});this.captionPackets_.sort(function(a,b){if(a.pts===b.pts){return a.presortIndex-b.presortIndex;}
return a.pts-b.pts;});this.captionPackets_.forEach(this.field1_.push,this.field1_);this.captionPackets_.length=0;this.field1_.flush();return;};var BASIC_CHARACTER_TRANSLATION={0x2a:0xe1,0x5c:0xe9,0x5e:0xed,0x5f:0xf3,0x60:0xfa,0x7b:0xe7,0x7c:0xf7,0x7d:0xd1,0x7e:0xf1,0x7f:0x2588};var getCharFromCode=function(code){if(code===null){return '';}
code=BASIC_CHARACTER_TRANSLATION[code]||code;return String.fromCharCode(code);};var PADDING=0x0000,RESUME_CAPTION_LOADING=0x1420,END_OF_CAPTION=0x142f,ROLL_UP_2_ROWS=0x1425,ROLL_UP_3_ROWS=0x1426,ROLL_UP_4_ROWS=0x1427,CARRIAGE_RETURN=0x142d,BACKSPACE=0x1421,ERASE_DISPLAYED_MEMORY=0x142c,ERASE_NON_DISPLAYED_MEMORY=0x142e;var BOTTOM_ROW=14;var createDisplayBuffer=function(){var result=[],i=BOTTOM_ROW+1;while(i--){result.push('');}
return result;};var Cea608Stream=function(){Cea608Stream.prototype.init.call(this);this.mode_='popOn';this.topRow_=0;this.startPts_=0;this.displayed_=createDisplayBuffer();this.nonDisplayed_=createDisplayBuffer();this.lastControlCode_=null;this.push=function(packet){if(packet.type!==0){return;}
var data,swap,char0,char1;data=packet.ccData&0x7f7f;if(data===this.lastControlCode_){this.lastControlCode_=null;return;}
if((data&0xf000)===0x1000){this.lastControlCode_=data;}else{this.lastControlCode_=null;}
switch(data){case PADDING:break;case RESUME_CAPTION_LOADING:this.mode_='popOn';break;case END_OF_CAPTION:this.flushDisplayed(packet.pts);swap=this.displayed_;this.displayed_=this.nonDisplayed_;this.nonDisplayed_=swap;this.startPts_=packet.pts;break;case ROLL_UP_2_ROWS:this.topRow_=BOTTOM_ROW-1;this.mode_='rollUp';break;case ROLL_UP_3_ROWS:this.topRow_=BOTTOM_ROW-2;this.mode_='rollUp';break;case ROLL_UP_4_ROWS:this.topRow_=BOTTOM_ROW-3;this.mode_='rollUp';break;case CARRIAGE_RETURN:this.flushDisplayed(packet.pts);this.shiftRowsUp_();this.startPts_=packet.pts;break;case BACKSPACE:if(this.mode_==='popOn'){this.nonDisplayed_[BOTTOM_ROW]=this.nonDisplayed_[BOTTOM_ROW].slice(0,-1);}else{this.displayed_[BOTTOM_ROW]=this.displayed_[BOTTOM_ROW].slice(0,-1);}
break;case ERASE_DISPLAYED_MEMORY:this.flushDisplayed(packet.pts);this.displayed_=createDisplayBuffer();break;case ERASE_NON_DISPLAYED_MEMORY:this.nonDisplayed_=createDisplayBuffer();break;default:char0=data>>>8;char1=data&0xff;if(char0>=0x10&&char0<=0x17&&char1>=0x40&&char1<=0x7F&&(char0!==0x10||char1<0x60)){char0=0x20;char1=null;}
if((char0===0x11||char0===0x19)&&(char1>=0x30&&char1<=0x3F)){char0=0x266A;char1='';}
if((char0&0xf0)===0x10){return;}
if(char0===0x00){char0=null;}
if(char1===0x00){char1=null;}
this[this.mode_](packet.pts,char0,char1);break;}};};Cea608Stream.prototype=new Stream();Cea608Stream.prototype.flushDisplayed=function(pts){var content=this.displayed_.map(function(row){return row.trim();}).filter(function(row){return row.length;}).join('\n');if(content.length){this.trigger('data',{startPts:this.startPts_,endPts:pts,text:content});}};Cea608Stream.prototype.popOn=function(pts,char0,char1){var baseRow=this.nonDisplayed_[BOTTOM_ROW];baseRow+=getCharFromCode(char0);baseRow+=getCharFromCode(char1);this.nonDisplayed_[BOTTOM_ROW]=baseRow;};Cea608Stream.prototype.rollUp=function(pts,char0,char1){var baseRow=this.displayed_[BOTTOM_ROW];if(baseRow===''){this.flushDisplayed(pts);this.startPts_=pts;}
baseRow+=getCharFromCode(char0);baseRow+=getCharFromCode(char1);this.displayed_[BOTTOM_ROW]=baseRow;};Cea608Stream.prototype.shiftRowsUp_=function(){var i;for(i=0;i<this.topRow_;i++){this.displayed_[i]='';}
for(i=this.topRow_;i<BOTTOM_ROW;i++){this.displayed_[i]=this.displayed_[i+1];}
this.displayed_[BOTTOM_ROW]='';};module.exports={CaptionStream:CaptionStream,Cea608Stream:Cea608Stream};},{"../utils/stream":85}],76:[function(require,module,exports){'use strict';var Stream=require('../utils/stream.js'),CaptionStream=require('./caption-stream'),StreamTypes=require('./stream-types'),TimestampRolloverStream=require('./timestamp-rollover-stream').TimestampRolloverStream;var m2tsStreamTypes=require('./stream-types.js');var TransportPacketStream,TransportParseStream,ElementaryStream;var
MP2T_PACKET_LENGTH=188,SYNC_BYTE=0x47;TransportPacketStream=function(){var
buffer=new Uint8Array(MP2T_PACKET_LENGTH),bytesInBuffer=0;TransportPacketStream.prototype.init.call(this);this.push=function(bytes){var
startIndex=0,endIndex=MP2T_PACKET_LENGTH,everything;if(bytesInBuffer){everything=new Uint8Array(bytes.byteLength+bytesInBuffer);everything.set(buffer.subarray(0,bytesInBuffer));everything.set(bytes,bytesInBuffer);bytesInBuffer=0;}else{everything=bytes;}
while(endIndex<everything.byteLength){if(everything[startIndex]===SYNC_BYTE&&everything[endIndex]===SYNC_BYTE){this.trigger('data',everything.subarray(startIndex,endIndex));startIndex+=MP2T_PACKET_LENGTH;endIndex+=MP2T_PACKET_LENGTH;continue;}
startIndex++;endIndex++;}
if(startIndex<everything.byteLength){buffer.set(everything.subarray(startIndex),0);bytesInBuffer=everything.byteLength-startIndex;}};this.flush=function(){if(bytesInBuffer===MP2T_PACKET_LENGTH&&buffer[0]===SYNC_BYTE){this.trigger('data',buffer);bytesInBuffer=0;}
this.trigger('done');};};TransportPacketStream.prototype=new Stream();TransportParseStream=function(){var parsePsi,parsePat,parsePmt,self;TransportParseStream.prototype.init.call(this);self=this;this.packetsWaitingForPmt=[];this.programMapTable=undefined;parsePsi=function(payload,psi){var offset=0;if(psi.payloadUnitStartIndicator){offset+=payload[offset]+1;}
if(psi.type==='pat'){parsePat(payload.subarray(offset),psi);}else{parsePmt(payload.subarray(offset),psi);}};parsePat=function(payload,pat){pat.section_number=payload[7];pat.last_section_number=payload[8];self.pmtPid=(payload[10]&0x1F)<<8|payload[11];pat.pmtPid=self.pmtPid;};parsePmt=function(payload,pmt){var sectionLength,tableEnd,programInfoLength,offset;if(!(payload[5]&0x01)){return;}
self.programMapTable={};sectionLength=(payload[1]&0x0f)<<8|payload[2];tableEnd=3+sectionLength-4;programInfoLength=(payload[10]&0x0f)<<8|payload[11];offset=12+programInfoLength;while(offset<tableEnd){self.programMapTable[(payload[offset+1]&0x1F)<<8|payload[offset+2]]=payload[offset];offset+=((payload[offset+3]&0x0F)<<8|payload[offset+4])+5;}
pmt.programMapTable=self.programMapTable;while(self.packetsWaitingForPmt.length){self.processPes_.apply(self,self.packetsWaitingForPmt.shift());}};this.push=function(packet){var
result={},offset=4;result.payloadUnitStartIndicator=!!(packet[1]&0x40);result.pid=packet[1]&0x1f;result.pid<<=8;result.pid|=packet[2];if(((packet[3]&0x30)>>>4)>0x01){offset+=packet[offset]+1;}
if(result.pid===0){result.type='pat';parsePsi(packet.subarray(offset),result);this.trigger('data',result);}else if(result.pid===this.pmtPid){result.type='pmt';parsePsi(packet.subarray(offset),result);this.trigger('data',result);}else if(this.programMapTable===undefined){this.packetsWaitingForPmt.push([packet,offset,result]);}else{this.processPes_(packet,offset,result);}};this.processPes_=function(packet,offset,result){result.streamType=this.programMapTable[result.pid];result.type='pes';result.data=packet.subarray(offset);this.trigger('data',result);};};TransportParseStream.prototype=new Stream();TransportParseStream.STREAM_TYPES={h264:0x1b,adts:0x0f};ElementaryStream=function(){var
self=this,video={data:[],size:0},audio={data:[],size:0},timedMetadata={data:[],size:0},parsePes=function(payload,pes){var ptsDtsFlags;pes.dataAlignmentIndicator=(payload[6]&0x04)!==0;ptsDtsFlags=payload[7];if(ptsDtsFlags&0xC0){pes.pts=(payload[9]&0x0E)<<27|(payload[10]&0xFF)<<20|(payload[11]&0xFE)<<12|(payload[12]&0xFF)<<5|(payload[13]&0xFE)>>>3;pes.pts*=4;pes.pts+=(payload[13]&0x06)>>>1;pes.dts=pes.pts;if(ptsDtsFlags&0x40){pes.dts=(payload[14]&0x0E)<<27|(payload[15]&0xFF)<<20|(payload[16]&0xFE)<<12|(payload[17]&0xFF)<<5|(payload[18]&0xFE)>>>3;pes.dts*=4;pes.dts+=(payload[18]&0x06)>>>1;}}
pes.data=payload.subarray(9+payload[8]);},flushStream=function(stream,type){var
packetData=new Uint8Array(stream.size),event={type:type},i=0,fragment;if(!stream.data.length){return;}
event.trackId=stream.data[0].pid;while(stream.data.length){fragment=stream.data.shift();packetData.set(fragment.data,i);i+=fragment.data.byteLength;}
parsePes(packetData,event);stream.size=0;self.trigger('data',event);};ElementaryStream.prototype.init.call(this);this.push=function(data){({pat:function(){},pes:function(){var stream,streamType;switch(data.streamType){case StreamTypes.H264_STREAM_TYPE:case m2tsStreamTypes.H264_STREAM_TYPE:stream=video;streamType='video';break;case StreamTypes.ADTS_STREAM_TYPE:stream=audio;streamType='audio';break;case StreamTypes.METADATA_STREAM_TYPE:stream=timedMetadata;streamType='timed-metadata';break;default:return;}
if(data.payloadUnitStartIndicator){flushStream(stream,streamType);}
stream.data.push(data);stream.size+=data.data.byteLength;},pmt:function(){var
event={type:'metadata',tracks:[]},programMapTable=data.programMapTable,k,track;for(k in programMapTable){if(programMapTable.hasOwnProperty(k)){track={timelineStartInfo:{baseMediaDecodeTime:0}};track.id=+k;if(programMapTable[k]===m2tsStreamTypes.H264_STREAM_TYPE){track.codec='avc';track.type='video';}else if(programMapTable[k]===m2tsStreamTypes.ADTS_STREAM_TYPE){track.codec='adts';track.type='audio';}
event.tracks.push(track);}}
self.trigger('data',event);}})[data.type]();};this.flush=function(){flushStream(video,'video');flushStream(audio,'audio');flushStream(timedMetadata,'timed-metadata');this.trigger('done');};};ElementaryStream.prototype=new Stream();var m2ts={PAT_PID:0x0000,MP2T_PACKET_LENGTH:MP2T_PACKET_LENGTH,TransportPacketStream:TransportPacketStream,TransportParseStream:TransportParseStream,ElementaryStream:ElementaryStream,TimestampRolloverStream:TimestampRolloverStream,CaptionStream:CaptionStream.CaptionStream,Cea608Stream:CaptionStream.Cea608Stream,MetadataStream:require('./metadata-stream')};for(var type in StreamTypes){if(StreamTypes.hasOwnProperty(type)){m2ts[type]=StreamTypes[type];}}
module.exports=m2ts;},{"../utils/stream.js":85,"./caption-stream":75,"./metadata-stream":77,"./stream-types":78,"./stream-types.js":78,"./timestamp-rollover-stream":79}],77:[function(require,module,exports){'use strict';var
Stream=require('../utils/stream'),StreamTypes=require('./stream-types'),percentEncode=function(bytes,start,end){var i,result='';for(i=start;i<end;i++){result+='%'+('00'+bytes[i].toString(16)).slice(-2);}
return result;},parseUtf8=function(bytes,start,end){return decodeURIComponent(percentEncode(bytes,start,end));},parseIso88591=function(bytes,start,end){return unescape(percentEncode(bytes,start,end));},parseSyncSafeInteger=function(data){return(data[0]<<21)|(data[1]<<14)|(data[2]<<7)|(data[3]);},tagParsers={TXXX:function(tag){var i;if(tag.data[0]!==3){return;}
for(i=1;i<tag.data.length;i++){if(tag.data[i]===0){tag.description=parseUtf8(tag.data,1,i);tag.value=parseUtf8(tag.data,i+1,tag.data.length-1);break;}}
tag.data=tag.value;},WXXX:function(tag){var i;if(tag.data[0]!==3){return;}
for(i=1;i<tag.data.length;i++){if(tag.data[i]===0){tag.description=parseUtf8(tag.data,1,i);tag.url=parseUtf8(tag.data,i+1,tag.data.length);break;}}},PRIV:function(tag){var i;for(i=0;i<tag.data.length;i++){if(tag.data[i]===0){tag.owner=parseIso88591(tag.data,0,i);break;}}
tag.privateData=tag.data.subarray(i+1);tag.data=tag.privateData;}},MetadataStream;MetadataStream=function(options){var
settings={debug:!!(options&&options.debug),descriptor:options&&options.descriptor},tagSize=0,buffer=[],bufferSize=0,i;MetadataStream.prototype.init.call(this);this.dispatchType=StreamTypes.METADATA_STREAM_TYPE.toString(16);if(settings.descriptor){for(i=0;i<settings.descriptor.length;i++){this.dispatchType+=('00'+settings.descriptor[i].toString(16)).slice(-2);}}
this.push=function(chunk){var tag,frameStart,frameSize,frame,i,frameHeader;if(chunk.type!=='timed-metadata'){return;}
if(chunk.dataAlignmentIndicator){bufferSize=0;buffer.length=0;}
if(buffer.length===0&&(chunk.data.length<10||chunk.data[0]!=='I'.charCodeAt(0)||chunk.data[1]!=='D'.charCodeAt(0)||chunk.data[2]!=='3'.charCodeAt(0))){if(settings.debug){console.log('Skipping unrecognized metadata packet');}
return;}
buffer.push(chunk);bufferSize+=chunk.data.byteLength;if(buffer.length===1){tagSize=parseSyncSafeInteger(chunk.data.subarray(6,10));tagSize+=10;}
if(bufferSize<tagSize){return;}
tag={data:new Uint8Array(tagSize),frames:[],pts:buffer[0].pts,dts:buffer[0].dts};for(i=0;i<tagSize;){tag.data.set(buffer[0].data.subarray(0,tagSize-i),i);i+=buffer[0].data.byteLength;bufferSize-=buffer[0].data.byteLength;buffer.shift();}
frameStart=10;if(tag.data[5]&0x40){frameStart+=4;frameStart+=parseSyncSafeInteger(tag.data.subarray(10,14));tagSize-=parseSyncSafeInteger(tag.data.subarray(16,20));}
do{frameSize=parseSyncSafeInteger(tag.data.subarray(frameStart+4,frameStart+8));if(frameSize<1){return console.log('Malformed ID3 frame encountered. Skipping metadata parsing.');}
frameHeader=String.fromCharCode(tag.data[frameStart],tag.data[frameStart+1],tag.data[frameStart+2],tag.data[frameStart+3]);frame={id:frameHeader,data:tag.data.subarray(frameStart+10,frameStart+frameSize+10)};frame.key=frame.id;if(tagParsers[frame.id]){tagParsers[frame.id](frame);if(frame.owner==='com.apple.streaming.transportStreamTimestamp'){var
d=frame.data,size=((d[3]&0x01)<<30)|(d[4]<<22)|(d[5]<<14)|(d[6]<<6)|(d[7]>>>2);size*=4;size+=d[7]&0x03;frame.timeStamp=size;if(tag.pts===undefined&&tag.dts===undefined){tag.pts=frame.timeStamp;tag.dts=frame.timeStamp;}
this.trigger('timestamp',frame);}}
tag.frames.push(frame);frameStart+=10;frameStart+=frameSize;}while(frameStart<tagSize);this.trigger('data',tag);};};MetadataStream.prototype=new Stream();module.exports=MetadataStream;},{"../utils/stream":85,"./stream-types":78}],78:[function(require,module,exports){'use strict';module.exports={H264_STREAM_TYPE:0x1B,ADTS_STREAM_TYPE:0x0F,METADATA_STREAM_TYPE:0x15};},{}],79:[function(require,module,exports){'use strict';var Stream=require('../utils/stream');var MAX_TS=8589934592;var RO_THRESH=4294967296;var handleRollover=function(value,reference){var direction=1;if(value>reference){direction=-1;}
while(Math.abs(reference-value)>RO_THRESH){value+=(direction*MAX_TS);}
return value;};var TimestampRolloverStream=function(type){var lastDTS,referenceDTS;TimestampRolloverStream.prototype.init.call(this);this.type_=type;this.push=function(data){if(data.type!==this.type_){return;}
if(referenceDTS===undefined){referenceDTS=data.dts;}
data.dts=handleRollover(data.dts,referenceDTS);data.pts=handleRollover(data.pts,referenceDTS);lastDTS=data.dts;this.trigger('data',data);};this.flush=function(){referenceDTS=lastDTS;this.trigger('done');};};TimestampRolloverStream.prototype=new Stream();module.exports={TimestampRolloverStream:TimestampRolloverStream,handleRollover:handleRollover};},{"../utils/stream":85}],80:[function(require,module,exports){module.exports={generator:require('./mp4-generator'),Transmuxer:require('./transmuxer').Transmuxer,AudioSegmentStream:require('./transmuxer').AudioSegmentStream,VideoSegmentStream:require('./transmuxer').VideoSegmentStream};},{"./mp4-generator":81,"./transmuxer":83}],81:[function(require,module,exports){'use strict';var UINT32_MAX=Math.pow(2,32)-1;var box,dinf,esds,ftyp,mdat,mfhd,minf,moof,moov,mvex,mvhd,trak,tkhd,mdia,mdhd,hdlr,sdtp,stbl,stsd,traf,trex,trun,types,MAJOR_BRAND,MINOR_VERSION,AVC1_BRAND,VIDEO_HDLR,AUDIO_HDLR,HDLR_TYPES,VMHD,SMHD,DREF,STCO,STSC,STSZ,STTS;(function(){var i;types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};if(typeof Uint8Array==='undefined'){return;}
for(i in types){if(types.hasOwnProperty(i)){types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)];}}
MAJOR_BRAND=new Uint8Array(['i'.charCodeAt(0),'s'.charCodeAt(0),'o'.charCodeAt(0),'m'.charCodeAt(0)]);AVC1_BRAND=new Uint8Array(['a'.charCodeAt(0),'v'.charCodeAt(0),'c'.charCodeAt(0),'1'.charCodeAt(0)]);MINOR_VERSION=new Uint8Array([0,0,0,1]);VIDEO_HDLR=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x76,0x69,0x64,0x65,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x56,0x69,0x64,0x65,0x6f,0x48,0x61,0x6e,0x64,0x6c,0x65,0x72,0x00]);AUDIO_HDLR=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x73,0x6f,0x75,0x6e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x53,0x6f,0x75,0x6e,0x64,0x48,0x61,0x6e,0x64,0x6c,0x65,0x72,0x00]);HDLR_TYPES={video:VIDEO_HDLR,audio:AUDIO_HDLR};DREF=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x0c,0x75,0x72,0x6c,0x20,0x00,0x00,0x00,0x01]);SMHD=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]);STCO=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]);STSC=STCO;STSZ=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]);STTS=STCO;VMHD=new Uint8Array([0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]);}());box=function(type){var
payload=[],size=0,i,result,view;for(i=1;i<arguments.length;i++){payload.push(arguments[i]);}
i=payload.length;while(i--){size+=payload[i].byteLength;}
result=new Uint8Array(size+8);view=new DataView(result.buffer,result.byteOffset,result.byteLength);view.setUint32(0,result.byteLength);result.set(type,4);for(i=0,size=8;i<payload.length;i++){result.set(payload[i],size);size+=payload[i].byteLength;}
return result;};dinf=function(){return box(types.dinf,box(types.dref,DREF));};esds=function(track){return box(types.esds,new Uint8Array([0x00,0x00,0x00,0x00,0x03,0x19,0x00,0x00,0x00,0x04,0x11,0x40,0x15,0x00,0x06,0x00,0x00,0x00,0xda,0xc0,0x00,0x00,0xda,0xc0,0x05,0x02,(track.audioobjecttype<<3)|(track.samplingfrequencyindex>>>1),(track.samplingfrequencyindex<<7)|(track.channelcount<<3),0x06,0x01,0x02]));};ftyp=function(){return box(types.ftyp,MAJOR_BRAND,MINOR_VERSION,MAJOR_BRAND,AVC1_BRAND);};hdlr=function(type){return box(types.hdlr,HDLR_TYPES[type]);};mdat=function(data){return box(types.mdat,data);};mdhd=function(track){var result=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x03,0x00,0x01,0x5f,0x90,(track.duration>>>24)&0xFF,(track.duration>>>16)&0xFF,(track.duration>>>8)&0xFF,track.duration&0xFF,0x55,0xc4,0x00,0x00]);if(track.samplerate){result[12]=(track.samplerate>>>24)&0xFF;result[13]=(track.samplerate>>>16)&0xFF;result[14]=(track.samplerate>>>8)&0xFF;result[15]=(track.samplerate)&0xFF;}
return box(types.mdhd,result);};mdia=function(track){return box(types.mdia,mdhd(track),hdlr(track.type),minf(track));};mfhd=function(sequenceNumber){return box(types.mfhd,new Uint8Array([0x00,0x00,0x00,0x00,(sequenceNumber&0xFF000000)>>24,(sequenceNumber&0xFF0000)>>16,(sequenceNumber&0xFF00)>>8,sequenceNumber&0xFF]));};minf=function(track){return box(types.minf,track.type==='video'?box(types.vmhd,VMHD):box(types.smhd,SMHD),dinf(),stbl(track));};moof=function(sequenceNumber,tracks){var
trackFragments=[],i=tracks.length;while(i--){trackFragments[i]=traf(tracks[i]);}
return box.apply(null,[types.moof,mfhd(sequenceNumber)].concat(trackFragments));};moov=function(tracks){var
i=tracks.length,boxes=[];while(i--){boxes[i]=trak(tracks[i]);}
return box.apply(null,[types.moov,mvhd(0xffffffff)].concat(boxes).concat(mvex(tracks)));};mvex=function(tracks){var
i=tracks.length,boxes=[];while(i--){boxes[i]=trex(tracks[i]);}
return box.apply(null,[types.mvex].concat(boxes));};mvhd=function(duration){var
bytes=new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x01,0x5f,0x90,(duration&0xFF000000)>>24,(duration&0xFF0000)>>16,(duration&0xFF00)>>8,duration&0xFF,0x00,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff]);return box(types.mvhd,bytes);};sdtp=function(track){var
samples=track.samples||[],bytes=new Uint8Array(4+samples.length),flags,i;for(i=0;i<samples.length;i++){flags=samples[i].flags;bytes[i+4]=(flags.dependsOn<<4)|(flags.isDependedOn<<2)|(flags.hasRedundancy);}
return box(types.sdtp,bytes);};stbl=function(track){return box(types.stbl,stsd(track),box(types.stts,STTS),box(types.stsc,STSC),box(types.stsz,STSZ),box(types.stco,STCO));};(function(){var videoSample,audioSample;stsd=function(track){return box(types.stsd,new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01]),track.type==='video'?videoSample(track):audioSample(track));};videoSample=function(track){var
sps=track.sps||[],pps=track.pps||[],sequenceParameterSets=[],pictureParameterSets=[],i;for(i=0;i<sps.length;i++){sequenceParameterSets.push((sps[i].byteLength&0xFF00)>>>8);sequenceParameterSets.push((sps[i].byteLength&0xFF));sequenceParameterSets=sequenceParameterSets.concat(Array.prototype.slice.call(sps[i]));}
for(i=0;i<pps.length;i++){pictureParameterSets.push((pps[i].byteLength&0xFF00)>>>8);pictureParameterSets.push((pps[i].byteLength&0xFF));pictureParameterSets=pictureParameterSets.concat(Array.prototype.slice.call(pps[i]));}
return box(types.avc1,new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,(track.width&0xff00)>>8,track.width&0xff,(track.height&0xff00)>>8,track.height&0xff,0x00,0x48,0x00,0x00,0x00,0x48,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x13,0x76,0x69,0x64,0x65,0x6f,0x6a,0x73,0x2d,0x63,0x6f,0x6e,0x74,0x72,0x69,0x62,0x2d,0x68,0x6c,0x73,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x11,0x11]),box(types.avcC,new Uint8Array([0x01,track.profileIdc,track.profileCompatibility,track.levelIdc,0xff].concat([sps.length]).concat(sequenceParameterSets).concat([pps.length]).concat(pictureParameterSets))),box(types.btrt,new Uint8Array([0x00,0x1c,0x9c,0x80,0x00,0x2d,0xc6,0xc0,0x00,0x2d,0xc6,0xc0])));};audioSample=function(track){return box(types.mp4a,new Uint8Array([0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,(track.channelcount&0xff00)>>8,(track.channelcount&0xff),(track.samplesize&0xff00)>>8,(track.samplesize&0xff),0x00,0x00,0x00,0x00,(track.samplerate&0xff00)>>8,(track.samplerate&0xff),0x00,0x00]),esds(track));};}());tkhd=function(track){var result=new Uint8Array([0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,(track.id&0xFF000000)>>24,(track.id&0xFF0000)>>16,(track.id&0xFF00)>>8,track.id&0xFF,0x00,0x00,0x00,0x00,(track.duration&0xFF000000)>>24,(track.duration&0xFF0000)>>16,(track.duration&0xFF00)>>8,track.duration&0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,(track.width&0xFF00)>>8,track.width&0xFF,0x00,0x00,(track.height&0xFF00)>>8,track.height&0xFF,0x00,0x00]);return box(types.tkhd,result);};traf=function(track){var trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable,dataOffset,upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime;trackFragmentHeader=box(types.tfhd,new Uint8Array([0x00,0x00,0x00,0x3a,(track.id&0xFF000000)>>24,(track.id&0xFF0000)>>16,(track.id&0xFF00)>>8,(track.id&0xFF),0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]));upperWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime/(UINT32_MAX+1));lowerWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime%(UINT32_MAX+1));trackFragmentDecodeTime=box(types.tfdt,new Uint8Array([0x01,0x00,0x00,0x00,(upperWordBaseMediaDecodeTime>>>24)&0xFF,(upperWordBaseMediaDecodeTime>>>16)&0xFF,(upperWordBaseMediaDecodeTime>>>8)&0xFF,upperWordBaseMediaDecodeTime&0xFF,(lowerWordBaseMediaDecodeTime>>>24)&0xFF,(lowerWordBaseMediaDecodeTime>>>16)&0xFF,(lowerWordBaseMediaDecodeTime>>>8)&0xFF,lowerWordBaseMediaDecodeTime&0xFF]));dataOffset=(32+
20+
8+
16+
8+
8);if(track.type==='audio'){trackFragmentRun=trun(track,dataOffset);return box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun);}
sampleDependencyTable=sdtp(track);trackFragmentRun=trun(track,sampleDependencyTable.length+dataOffset);return box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable);};trak=function(track){track.duration=track.duration||0xffffffff;return box(types.trak,tkhd(track),mdia(track));};trex=function(track){var result=new Uint8Array([0x00,0x00,0x00,0x00,(track.id&0xFF000000)>>24,(track.id&0xFF0000)>>16,(track.id&0xFF00)>>8,(track.id&0xFF),0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01]);if(track.type!=='video'){result[result.length-1]=0x00;}
return box(types.trex,result);};(function(){var audioTrun,videoTrun,trunHeader;trunHeader=function(samples,offset){var durationPresent=0,sizePresent=0,flagsPresent=0,compositionTimeOffset=0;if(samples.length){if(samples[0].duration!==undefined){durationPresent=0x1;}
if(samples[0].size!==undefined){sizePresent=0x2;}
if(samples[0].flags!==undefined){flagsPresent=0x4;}
if(samples[0].compositionTimeOffset!==undefined){compositionTimeOffset=0x8;}}
return[0x00,0x00,durationPresent|sizePresent|flagsPresent|compositionTimeOffset,0x01,(samples.length&0xFF000000)>>>24,(samples.length&0xFF0000)>>>16,(samples.length&0xFF00)>>>8,samples.length&0xFF,(offset&0xFF000000)>>>24,(offset&0xFF0000)>>>16,(offset&0xFF00)>>>8,offset&0xFF];};videoTrun=function(track,offset){var bytes,samples,sample,i;samples=track.samples||[];offset+=8+12+(16*samples.length);bytes=trunHeader(samples,offset);for(i=0;i<samples.length;i++){sample=samples[i];bytes=bytes.concat([(sample.duration&0xFF000000)>>>24,(sample.duration&0xFF0000)>>>16,(sample.duration&0xFF00)>>>8,sample.duration&0xFF,(sample.size&0xFF000000)>>>24,(sample.size&0xFF0000)>>>16,(sample.size&0xFF00)>>>8,sample.size&0xFF,(sample.flags.isLeading<<2)|sample.flags.dependsOn,(sample.flags.isDependedOn<<6)|(sample.flags.hasRedundancy<<4)|(sample.flags.paddingValue<<1)|sample.flags.isNonSyncSample,sample.flags.degradationPriority&0xF0<<8,sample.flags.degradationPriority&0x0F,(sample.compositionTimeOffset&0xFF000000)>>>24,(sample.compositionTimeOffset&0xFF0000)>>>16,(sample.compositionTimeOffset&0xFF00)>>>8,sample.compositionTimeOffset&0xFF]);}
return box(types.trun,new Uint8Array(bytes));};audioTrun=function(track,offset){var bytes,samples,sample,i;samples=track.samples||[];offset+=8+12+(8*samples.length);bytes=trunHeader(samples,offset);for(i=0;i<samples.length;i++){sample=samples[i];bytes=bytes.concat([(sample.duration&0xFF000000)>>>24,(sample.duration&0xFF0000)>>>16,(sample.duration&0xFF00)>>>8,sample.duration&0xFF,(sample.size&0xFF000000)>>>24,(sample.size&0xFF0000)>>>16,(sample.size&0xFF00)>>>8,sample.size&0xFF]);}
return box(types.trun,new Uint8Array(bytes));};trun=function(track,offset){if(track.type==='audio'){return audioTrun(track,offset);}
return videoTrun(track,offset);};}());module.exports={ftyp:ftyp,mdat:mdat,moof:moof,moov:moov,initSegment:function(tracks){var
fileType=ftyp(),movie=moov(tracks),result;result=new Uint8Array(fileType.byteLength+movie.byteLength);result.set(fileType);result.set(movie,fileType.byteLength);return result;}};},{}],82:[function(require,module,exports){'use strict';var findBox,parseType,timescale,startTime;findBox=function(data,path){var results=[],i,size,type,end,subresults;if(!path.length){return null;}
for(i=0;i<data.byteLength;){size=data[i]<<24;size|=data[i+1]<<16;size|=data[i+2]<<8;size|=data[i+3];type=parseType(data.subarray(i+4,i+8));end=size>1?i+size:data.byteLength;if(type===path[0]){if(path.length===1){results.push(data.subarray(i+8,end));}else{subresults=findBox(data.subarray(i+8,end),path.slice(1));if(subresults.length){results=results.concat(subresults);}}}
i=end;}
return results;};parseType=function(buffer){var result='';result+=String.fromCharCode(buffer[0]);result+=String.fromCharCode(buffer[1]);result+=String.fromCharCode(buffer[2]);result+=String.fromCharCode(buffer[3]);return result;};timescale=function(init){var
result={},traks=findBox(init,['moov','trak']);return traks.reduce(function(result,trak){var tkhd,version,index,id,mdhd;tkhd=findBox(trak,['tkhd'])[0];if(!tkhd){return null;}
version=tkhd[0];index=version===0?12:20;id=tkhd[index]<<24|tkhd[index+1]<<16|tkhd[index+2]<<8|tkhd[index+3];mdhd=findBox(trak,['mdia','mdhd'])[0];if(!mdhd){return null;}
version=mdhd[0];index=version===0?12:20;result[id]=mdhd[index]<<24|mdhd[index+1]<<16|mdhd[index+2]<<8|mdhd[index+3];return result;},result);};startTime=function(timescale,fragment){var trafs,baseTimes,result;trafs=findBox(fragment,['moof','traf']);baseTimes=[].concat.apply([],trafs.map(function(traf){return findBox(traf,['tfhd']).map(function(tfhd){var id,scale,baseTime;id=tfhd[4]<<24|tfhd[5]<<16|tfhd[6]<<8|tfhd[7];scale=timescale[id]||90e3;baseTime=findBox(traf,['tfdt']).map(function(tfdt){var version,result;version=tfdt[0];result=tfdt[4]<<24|tfdt[5]<<16|tfdt[6]<<8|tfdt[7];if(version===1){result*=Math.pow(2,32);result+=tfdt[8]<<24|tfdt[9]<<16|tfdt[10]<<8|tfdt[11];}
return result;})[0];baseTime=baseTime||Infinity;return baseTime/scale;});}));result=Math.min.apply(null,baseTimes);return isFinite(result)?result:0;};module.exports={parseType:parseType,timescale:timescale,startTime:startTime};},{}],83:[function(require,module,exports){'use strict';var Stream=require('../utils/stream.js');var mp4=require('./mp4-generator.js');var m2ts=require('../m2ts/m2ts.js');var AdtsStream=require('../codecs/adts.js');var H264Stream=require('../codecs/h264').H264Stream;var AacStream=require('../aac');var AUDIO_PROPERTIES=['audioobjecttype','channelcount','samplerate','samplingfrequencyindex','samplesize'];var VIDEO_PROPERTIES=['width','height','profileIdc','levelIdc','profileCompatibility'];var VideoSegmentStream,AudioSegmentStream,Transmuxer,CoalesceStream;var
createDefaultSample,isLikelyAacData,collectDtsInfo,clearDtsInfo,calculateTrackBaseMediaDecodeTime,arrayEquals,sumFrameByteLengths;createDefaultSample=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}};};isLikelyAacData=function(data){if((data[0]==='I'.charCodeAt(0))&&(data[1]==='D'.charCodeAt(0))&&(data[2]==='3'.charCodeAt(0))){return true;}
return false;};arrayEquals=function(a,b){var
i;if(a.length!==b.length){return false;}
for(i=0;i<a.length;i++){if(a[i]!==b[i]){return false;}}
return true;};sumFrameByteLengths=function(array){var
i,currentObj,sum=0;for(i=0;i<array.length;i++){currentObj=array[i];sum+=currentObj.data.byteLength;}
return sum;};AudioSegmentStream=function(track){var
adtsFrames=[],sequenceNumber=0,earliestAllowedDts=0;AudioSegmentStream.prototype.init.call(this);this.push=function(data){collectDtsInfo(track,data);if(track){AUDIO_PROPERTIES.forEach(function(prop){track[prop]=data[prop];});}
adtsFrames.push(data);};this.setEarliestDts=function(earliestDts){earliestAllowedDts=earliestDts-track.timelineStartInfo.baseMediaDecodeTime;};this.flush=function(){var
frames,moof,mdat,boxes;if(adtsFrames.length===0){this.trigger('done','AudioSegmentStream');return;}
frames=this.trimAdtsFramesByEarliestDts_(adtsFrames);track.samples=this.generateSampleTable_(frames);mdat=mp4.mdat(this.concatenateFrameData_(frames));adtsFrames=[];calculateTrackBaseMediaDecodeTime(track);moof=mp4.moof(sequenceNumber,[track]);boxes=new Uint8Array(moof.byteLength+mdat.byteLength);sequenceNumber++;boxes.set(moof);boxes.set(mdat,moof.byteLength);clearDtsInfo(track);this.trigger('data',{track:track,boxes:boxes});this.trigger('done','AudioSegmentStream');};this.trimAdtsFramesByEarliestDts_=function(adtsFrames){if(track.minSegmentDts>=earliestAllowedDts){return adtsFrames;}
track.minSegmentDts=Infinity;return adtsFrames.filter(function(currentFrame){if(currentFrame.dts>=earliestAllowedDts){track.minSegmentDts=Math.min(track.minSegmentDts,currentFrame.dts);track.minSegmentPts=track.minSegmentDts;return true;}
return false;});};this.generateSampleTable_=function(frames){var
i,currentFrame,samples=[];for(i=0;i<frames.length;i++){currentFrame=frames[i];samples.push({size:currentFrame.data.byteLength,duration:1024});}
return samples;};this.concatenateFrameData_=function(frames){var
i,currentFrame,dataOffset=0,data=new Uint8Array(sumFrameByteLengths(frames));for(i=0;i<frames.length;i++){currentFrame=frames[i];data.set(currentFrame.data,dataOffset);dataOffset+=currentFrame.data.byteLength;}
return data;};};AudioSegmentStream.prototype=new Stream();VideoSegmentStream=function(track){var
sequenceNumber=0,nalUnits=[],config,pps;VideoSegmentStream.prototype.init.call(this);delete track.minPTS;this.gopCache_=[];this.push=function(nalUnit){collectDtsInfo(track,nalUnit);if(nalUnit.nalUnitType==='seq_parameter_set_rbsp'&&!config){config=nalUnit.config;track.sps=[nalUnit.data];VIDEO_PROPERTIES.forEach(function(prop){track[prop]=config[prop];},this);}
if(nalUnit.nalUnitType==='pic_parameter_set_rbsp'&&!pps){pps=nalUnit.data;track.pps=[nalUnit.data];}
nalUnits.push(nalUnit);};this.flush=function(){var
frames,gopForFusion,gops,moof,mdat,boxes;while(nalUnits.length){if(nalUnits[0].nalUnitType==='access_unit_delimiter_rbsp'){break;}
nalUnits.shift();}
if(nalUnits.length===0){this.resetStream_();this.trigger('done','VideoSegmentStream');return;}
frames=this.groupNalsIntoFrames_(nalUnits);gops=this.groupFramesIntoGops_(frames);if(!gops[0][0].keyFrame){gopForFusion=this.getGopForFusion_(nalUnits[0],track);if(gopForFusion){gops.unshift(gopForFusion);gops.byteLength+=gopForFusion.byteLength;gops.nalCount+=gopForFusion.nalCount;gops.pts=gopForFusion.pts;gops.dts=gopForFusion.dts;gops.duration+=gopForFusion.duration;}else{gops=this.extendFirstKeyFrame_(gops);}}
collectDtsInfo(track,gops);track.samples=this.generateSampleTable_(gops);mdat=mp4.mdat(this.concatenateNalData_(gops));this.gopCache_.unshift({gop:gops.pop(),pps:track.pps,sps:track.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);nalUnits=[];calculateTrackBaseMediaDecodeTime(track);this.trigger('timelineStartInfo',track.timelineStartInfo);moof=mp4.moof(sequenceNumber,[track]);boxes=new Uint8Array(moof.byteLength+mdat.byteLength);sequenceNumber++;boxes.set(moof);boxes.set(mdat,moof.byteLength);this.trigger('data',{track:track,boxes:boxes});this.resetStream_();this.trigger('done','VideoSegmentStream');};this.resetStream_=function(){clearDtsInfo(track);config=undefined;pps=undefined;};this.getGopForFusion_=function(nalUnit){var
halfSecond=45000,allowableOverlap=10000,nearestDistance=Infinity,dtsDistance,nearestGopObj,currentGop,currentGopObj,i;for(i=0;i<this.gopCache_.length;i++){currentGopObj=this.gopCache_[i];currentGop=currentGopObj.gop;if(!(track.pps&&arrayEquals(track.pps[0],currentGopObj.pps[0]))||!(track.sps&&arrayEquals(track.sps[0],currentGopObj.sps[0]))){continue;}
if(currentGop.dts<track.timelineStartInfo.dts){continue;}
dtsDistance=(nalUnit.dts-currentGop.dts)-currentGop.duration;if(dtsDistance>=-allowableOverlap&&dtsDistance<=halfSecond){if(!nearestGopObj||nearestDistance>dtsDistance){nearestGopObj=currentGopObj;nearestDistance=dtsDistance;}}}
if(nearestGopObj){return nearestGopObj.gop;}
return null;};this.extendFirstKeyFrame_=function(gops){var currentGop;if(!gops[0][0].keyFrame){currentGop=gops.shift();gops.byteLength-=currentGop.byteLength;gops.nalCount-=currentGop.nalCount;gops[0][0].dts=currentGop.dts;gops[0][0].pts=currentGop.pts;gops[0][0].duration+=currentGop.duration;}
return gops;};this.groupNalsIntoFrames_=function(nalUnits){var
i,currentNal,currentFrame=[],frames=[];currentFrame.byteLength=0;for(i=0;i<nalUnits.length;i++){currentNal=nalUnits[i];if(currentNal.nalUnitType==='access_unit_delimiter_rbsp'){if(currentFrame.length){currentFrame.duration=currentNal.dts-currentFrame.dts;frames.push(currentFrame);}
currentFrame=[currentNal];currentFrame.byteLength=currentNal.data.byteLength;currentFrame.pts=currentNal.pts;currentFrame.dts=currentNal.dts;}else{if(currentNal.nalUnitType==='slice_layer_without_partitioning_rbsp_idr'){currentFrame.keyFrame=true;}
currentFrame.duration=currentNal.dts-currentFrame.dts;currentFrame.byteLength+=currentNal.data.byteLength;currentFrame.push(currentNal);}}
if(frames.length&&(!currentFrame.duration||currentFrame.duration<=0)){currentFrame.duration=frames[frames.length-1].duration;}
frames.push(currentFrame);return frames;};this.groupFramesIntoGops_=function(frames){var
i,currentFrame,currentGop=[],gops=[];currentGop.byteLength=0;currentGop.nalCount=0;currentGop.duration=0;currentGop.pts=frames[0].pts;currentGop.dts=frames[0].dts;gops.byteLength=0;gops.nalCount=0;gops.duration=0;gops.pts=frames[0].pts;gops.dts=frames[0].dts;for(i=0;i<frames.length;i++){currentFrame=frames[i];if(currentFrame.keyFrame){if(currentGop.length){gops.push(currentGop);gops.byteLength+=currentGop.byteLength;gops.nalCount+=currentGop.nalCount;gops.duration+=currentGop.duration;}
currentGop=[currentFrame];currentGop.nalCount=currentFrame.length;currentGop.byteLength=currentFrame.byteLength;currentGop.pts=currentFrame.pts;currentGop.dts=currentFrame.dts;currentGop.duration=currentFrame.duration;}else{currentGop.duration+=currentFrame.duration;currentGop.nalCount+=currentFrame.length;currentGop.byteLength+=currentFrame.byteLength;currentGop.push(currentFrame);}}
if(gops.length&&currentGop.duration<=0){currentGop.duration=gops[gops.length-1].duration;}
gops.byteLength+=currentGop.byteLength;gops.nalCount+=currentGop.nalCount;gops.duration+=currentGop.duration;gops.push(currentGop);return gops;};this.generateSampleTable_=function(gops,baseDataOffset){var
h,i,sample,currentGop,currentFrame,dataOffset=baseDataOffset||0,samples=[];for(h=0;h<gops.length;h++){currentGop=gops[h];for(i=0;i<currentGop.length;i++){currentFrame=currentGop[i];sample=createDefaultSample();sample.dataOffset=dataOffset;sample.compositionTimeOffset=currentFrame.pts-currentFrame.dts;sample.duration=currentFrame.duration;sample.size=4*currentFrame.length;sample.size+=currentFrame.byteLength;if(currentFrame.keyFrame){sample.flags.dependsOn=2;}
dataOffset+=sample.size;samples.push(sample);}}
return samples;};this.concatenateNalData_=function(gops){var
h,i,j,currentGop,currentFrame,currentNal,dataOffset=0,nalsByteLength=gops.byteLength,numberOfNals=gops.nalCount,totalByteLength=nalsByteLength+4*numberOfNals,data=new Uint8Array(totalByteLength),view=new DataView(data.buffer);for(h=0;h<gops.length;h++){currentGop=gops[h];for(i=0;i<currentGop.length;i++){currentFrame=currentGop[i];for(j=0;j<currentFrame.length;j++){currentNal=currentFrame[j];view.setUint32(dataOffset,currentNal.data.byteLength);dataOffset+=4;data.set(currentNal.data,dataOffset);dataOffset+=currentNal.data.byteLength;}}}
return data;};};VideoSegmentStream.prototype=new Stream();collectDtsInfo=function(track,data){if(typeof data.pts==='number'){if(track.timelineStartInfo.pts===undefined){track.timelineStartInfo.pts=data.pts;}
if(track.minSegmentPts===undefined){track.minSegmentPts=data.pts;}else{track.minSegmentPts=Math.min(track.minSegmentPts,data.pts);}
if(track.maxSegmentPts===undefined){track.maxSegmentPts=data.pts;}else{track.maxSegmentPts=Math.max(track.maxSegmentPts,data.pts);}}
if(typeof data.dts==='number'){if(track.timelineStartInfo.dts===undefined){track.timelineStartInfo.dts=data.dts;}
if(track.minSegmentDts===undefined){track.minSegmentDts=data.dts;}else{track.minSegmentDts=Math.min(track.minSegmentDts,data.dts);}
if(track.maxSegmentDts===undefined){track.maxSegmentDts=data.dts;}else{track.maxSegmentDts=Math.max(track.maxSegmentDts,data.dts);}}};clearDtsInfo=function(track){delete track.minSegmentDts;delete track.maxSegmentDts;delete track.minSegmentPts;delete track.maxSegmentPts;};calculateTrackBaseMediaDecodeTime=function(track){var
oneSecondInTS=90000,scale,timeSinceStartOfTimeline=track.minSegmentDts-track.timelineStartInfo.dts;track.baseMediaDecodeTime=track.timelineStartInfo.baseMediaDecodeTime;track.baseMediaDecodeTime+=timeSinceStartOfTimeline;track.baseMediaDecodeTime=Math.max(0,track.baseMediaDecodeTime);if(track.type==='audio'){scale=track.samplerate/oneSecondInTS;track.baseMediaDecodeTime*=scale;track.baseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime);}};CoalesceStream=function(options,metadataStream){this.numberOfTracks=0;this.metadataStream=metadataStream;if(typeof options.remux!=='undefined'){this.remuxTracks=!!options.remux;}else{this.remuxTracks=true;}
this.pendingTracks=[];this.videoTrack=null;this.pendingBoxes=[];this.pendingCaptions=[];this.pendingMetadata=[];this.pendingBytes=0;this.emittedTracks=0;CoalesceStream.prototype.init.call(this);this.push=function(output){if(output.text){return this.pendingCaptions.push(output);}
if(output.frames){return this.pendingMetadata.push(output);}
this.pendingTracks.push(output.track);this.pendingBoxes.push(output.boxes);this.pendingBytes+=output.boxes.byteLength;if(output.track.type==='video'){this.videoTrack=output.track;}
if(output.track.type==='audio'){this.audioTrack=output.track;}};};CoalesceStream.prototype=new Stream();CoalesceStream.prototype.flush=function(flushSource){var
offset=0,event={captions:[],metadata:[],info:{}},caption,id3,initSegment,timelineStartPts=0,i;if(this.pendingTracks.length<this.numberOfTracks){if(flushSource!=='VideoSegmentStream'&&flushSource!=='AudioSegmentStream'){return;}else if(this.remuxTracks){return;}else if(this.pendingTracks.length===0){this.emittedTracks++;if(this.emittedTracks>=this.numberOfTracks){this.trigger('done');this.emittedTracks=0;}
return;}}
if(this.videoTrack){timelineStartPts=this.videoTrack.timelineStartInfo.pts;VIDEO_PROPERTIES.forEach(function(prop){event.info[prop]=this.videoTrack[prop];},this);}else if(this.audioTrack){timelineStartPts=this.audioTrack.timelineStartInfo.pts;AUDIO_PROPERTIES.forEach(function(prop){event.info[prop]=this.audioTrack[prop];},this);}
if(this.pendingTracks.length===1){event.type=this.pendingTracks[0].type;}else{event.type='combined';}
this.emittedTracks+=this.pendingTracks.length;initSegment=mp4.initSegment(this.pendingTracks);event.initSegment=new Uint8Array(initSegment.byteLength);event.initSegment.set(initSegment);event.data=new Uint8Array(this.pendingBytes);for(i=0;i<this.pendingBoxes.length;i++){event.data.set(this.pendingBoxes[i],offset);offset+=this.pendingBoxes[i].byteLength;}
for(i=0;i<this.pendingCaptions.length;i++){caption=this.pendingCaptions[i];caption.startTime=(caption.startPts-timelineStartPts);caption.startTime/=90e3;caption.endTime=(caption.endPts-timelineStartPts);caption.endTime/=90e3;event.captions.push(caption);}
for(i=0;i<this.pendingMetadata.length;i++){id3=this.pendingMetadata[i];id3.cueTime=(id3.pts-timelineStartPts);id3.cueTime/=90e3;event.metadata.push(id3);}
event.metadata.dispatchType=this.metadataStream.dispatchType;this.pendingTracks.length=0;this.videoTrack=null;this.pendingBoxes.length=0;this.pendingCaptions.length=0;this.pendingBytes=0;this.pendingMetadata.length=0;this.trigger('data',event);if(this.emittedTracks>=this.numberOfTracks){this.trigger('done');this.emittedTracks=0;}};Transmuxer=function(options){var
self=this,hasFlushed=true,videoTrack,audioTrack;Transmuxer.prototype.init.call(this);options=options||{};this.baseMediaDecodeTime=options.baseMediaDecodeTime||0;this.transmuxPipeline_={};this.setupAacPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline;pipeline.type='aac';pipeline.metadataStream=new m2ts.MetadataStream();pipeline.aacStream=new AacStream();pipeline.audioTimestampRolloverStream=new m2ts.TimestampRolloverStream('audio');pipeline.timedMetadataTimestampRolloverStream=new m2ts.TimestampRolloverStream('timed-metadata');pipeline.adtsStream=new AdtsStream();pipeline.coalesceStream=new CoalesceStream(options,pipeline.metadataStream);pipeline.headOfPipeline=pipeline.aacStream;pipeline.aacStream.pipe(pipeline.audioTimestampRolloverStream).pipe(pipeline.adtsStream);pipeline.aacStream.pipe(pipeline.timedMetadataTimestampRolloverStream).pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream);pipeline.metadataStream.on('timestamp',function(frame){pipeline.aacStream.setTimestamp(frame.timeStamp);});pipeline.aacStream.on('data',function(data){if(data.type==='timed-metadata'&&!pipeline.audioSegmentStream){audioTrack=audioTrack||{timelineStartInfo:{baseMediaDecodeTime:self.baseMediaDecodeTime},codec:'adts',type:'audio'};pipeline.coalesceStream.numberOfTracks++;pipeline.audioSegmentStream=new AudioSegmentStream(audioTrack);pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream);}});pipeline.coalesceStream.on('data',this.trigger.bind(this,'data'));pipeline.coalesceStream.on('done',this.trigger.bind(this,'done'));};this.setupTsPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline;pipeline.type='ts';pipeline.metadataStream=new m2ts.MetadataStream();pipeline.packetStream=new m2ts.TransportPacketStream();pipeline.parseStream=new m2ts.TransportParseStream();pipeline.elementaryStream=new m2ts.ElementaryStream();pipeline.videoTimestampRolloverStream=new m2ts.TimestampRolloverStream('video');pipeline.audioTimestampRolloverStream=new m2ts.TimestampRolloverStream('audio');pipeline.timedMetadataTimestampRolloverStream=new m2ts.TimestampRolloverStream('timed-metadata');pipeline.adtsStream=new AdtsStream();pipeline.h264Stream=new H264Stream();pipeline.captionStream=new m2ts.CaptionStream();pipeline.coalesceStream=new CoalesceStream(options,pipeline.metadataStream);pipeline.headOfPipeline=pipeline.packetStream;pipeline.packetStream.pipe(pipeline.parseStream).pipe(pipeline.elementaryStream);pipeline.elementaryStream.pipe(pipeline.videoTimestampRolloverStream).pipe(pipeline.h264Stream);pipeline.elementaryStream.pipe(pipeline.audioTimestampRolloverStream).pipe(pipeline.adtsStream);pipeline.elementaryStream.pipe(pipeline.timedMetadataTimestampRolloverStream).pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream);pipeline.h264Stream.pipe(pipeline.captionStream).pipe(pipeline.coalesceStream);pipeline.elementaryStream.on('data',function(data){var i;if(data.type==='metadata'){i=data.tracks.length;while(i--){if(!videoTrack&&data.tracks[i].type==='video'){videoTrack=data.tracks[i];videoTrack.timelineStartInfo.baseMediaDecodeTime=self.baseMediaDecodeTime;}else if(!audioTrack&&data.tracks[i].type==='audio'){audioTrack=data.tracks[i];audioTrack.timelineStartInfo.baseMediaDecodeTime=self.baseMediaDecodeTime;}}
if(videoTrack&&!pipeline.videoSegmentStream){pipeline.coalesceStream.numberOfTracks++;pipeline.videoSegmentStream=new VideoSegmentStream(videoTrack);pipeline.videoSegmentStream.on('timelineStartInfo',function(timelineStartInfo){if(audioTrack){audioTrack.timelineStartInfo=timelineStartInfo;pipeline.audioSegmentStream.setEarliestDts(timelineStartInfo.dts);}});pipeline.h264Stream.pipe(pipeline.videoSegmentStream).pipe(pipeline.coalesceStream);}
if(audioTrack&&!pipeline.audioSegmentStream){pipeline.coalesceStream.numberOfTracks++;pipeline.audioSegmentStream=new AudioSegmentStream(audioTrack);pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream);}}});pipeline.coalesceStream.on('data',this.trigger.bind(this,'data'));pipeline.coalesceStream.on('done',this.trigger.bind(this,'done'));};this.setBaseMediaDecodeTime=function(baseMediaDecodeTime){var pipeline=this.transmuxPipeline_;this.baseMediaDecodeTime=baseMediaDecodeTime;if(audioTrack){audioTrack.timelineStartInfo.dts=undefined;audioTrack.timelineStartInfo.pts=undefined;clearDtsInfo(audioTrack);audioTrack.timelineStartInfo.baseMediaDecodeTime=baseMediaDecodeTime;}
if(videoTrack){if(pipeline.videoSegmentStream){pipeline.videoSegmentStream.gopCache_=[];}
videoTrack.timelineStartInfo.dts=undefined;videoTrack.timelineStartInfo.pts=undefined;clearDtsInfo(videoTrack);videoTrack.timelineStartInfo.baseMediaDecodeTime=baseMediaDecodeTime;}};this.push=function(data){if(hasFlushed){var isAac=isLikelyAacData(data);if(isAac&&this.transmuxPipeline_.type!=='aac'){this.setupAacPipeline();}else if(!isAac&&this.transmuxPipeline_.type!=='ts'){this.setupTsPipeline();}
hasFlushed=false;}
this.transmuxPipeline_.headOfPipeline.push(data);};this.flush=function(){hasFlushed=true;this.transmuxPipeline_.headOfPipeline.flush();};};Transmuxer.prototype=new Stream();module.exports={Transmuxer:Transmuxer,VideoSegmentStream:VideoSegmentStream,AudioSegmentStream:AudioSegmentStream,AUDIO_PROPERTIES:AUDIO_PROPERTIES,VIDEO_PROPERTIES:VIDEO_PROPERTIES};},{"../aac":68,"../codecs/adts.js":69,"../codecs/h264":70,"../m2ts/m2ts.js":76,"../utils/stream.js":85,"./mp4-generator.js":81}],84:[function(require,module,exports){'use strict';var ExpGolomb;ExpGolomb=function(workingData){var
workingBytesAvailable=workingData.byteLength,workingWord=0,workingBitsAvailable=0;this.length=function(){return(8*workingBytesAvailable);};this.bitsAvailable=function(){return(8*workingBytesAvailable)+workingBitsAvailable;};this.loadWord=function(){var
position=workingData.byteLength-workingBytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,workingBytesAvailable);if(availableBytes===0){throw new Error('no bytes available');}
workingBytes.set(workingData.subarray(position,position+availableBytes));workingWord=new DataView(workingBytes.buffer).getUint32(0);workingBitsAvailable=availableBytes*8;workingBytesAvailable-=availableBytes;};this.skipBits=function(count){var skipBytes;if(workingBitsAvailable>count){workingWord<<=count;workingBitsAvailable-=count;}else{count-=workingBitsAvailable;skipBytes=Math.floor(count/8);count-=(skipBytes*8);workingBytesAvailable-=skipBytes;this.loadWord();workingWord<<=count;workingBitsAvailable-=count;}};this.readBits=function(size){var
bits=Math.min(workingBitsAvailable,size),valu=workingWord>>>(32-bits);workingBitsAvailable-=bits;if(workingBitsAvailable>0){workingWord<<=bits;}else if(workingBytesAvailable>0){this.loadWord();}
bits=size-bits;if(bits>0){return valu<<bits|this.readBits(bits);}
return valu;};this.skipLeadingZeros=function(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<workingBitsAvailable;++leadingZeroCount){if((workingWord&(0x80000000>>>leadingZeroCount))!==0){workingWord<<=leadingZeroCount;workingBitsAvailable-=leadingZeroCount;return leadingZeroCount;}}
this.loadWord();return leadingZeroCount+this.skipLeadingZeros();};this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros());};this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros());};this.readUnsignedExpGolomb=function(){var clz=this.skipLeadingZeros();return this.readBits(clz+1)-1;};this.readExpGolomb=function(){var valu=this.readUnsignedExpGolomb();if(0x01&valu){return(1+valu)>>>1;}
return-1*(valu>>>1);};this.readBoolean=function(){return this.readBits(1)===1;};this.readUnsignedByte=function(){return this.readBits(8);};this.loadWord();};module.exports=ExpGolomb;},{}],85:[function(require,module,exports){'use strict';var Stream=function(){this.init=function(){var listeners={};this.on=function(type,listener){if(!listeners[type]){listeners[type]=[];}
listeners[type]=listeners[type].concat(listener);};this.off=function(type,listener){var index;if(!listeners[type]){return false;}
index=listeners[type].indexOf(listener);listeners[type]=listeners[type].slice();listeners[type].splice(index,1);return index>-1;};this.trigger=function(type){var callbacks,i,length,args;callbacks=listeners[type];if(!callbacks){return;}
if(arguments.length===2){length=callbacks.length;for(i=0;i<length;++i){callbacks[i].call(this,arguments[1]);}}else{args=[];i=arguments.length;for(i=1;i<arguments.length;++i){args.push(arguments[i]);}
length=callbacks.length;for(i=0;i<length;++i){callbacks[i].apply(this,args);}}};this.dispose=function(){listeners={};};};};Stream.prototype.pipe=function(destination){this.on('data',function(data){destination.push(data);});this.on('done',function(flushSource){destination.flush(flushSource);});return destination;};Stream.prototype.push=function(data){this.trigger('data',data);};Stream.prototype.flush=function(flushSource){this.trigger('done',flushSource);};module.exports=Stream;},{}],86:[function(require,module,exports){(function(root){var URLToolkit={buildAbsoluteURL:function(baseURL,relativeURL){relativeURL=relativeURL.trim();if(/^[a-z]+:/i.test(relativeURL)){return relativeURL;}
var relativeURLQuery=null;var relativeURLHash=null;var relativeURLHashSplit=/^([^#]*)(.*)$/.exec(relativeURL);if(relativeURLHashSplit){relativeURLHash=relativeURLHashSplit[2];relativeURL=relativeURLHashSplit[1];}
var relativeURLQuerySplit=/^([^\?]*)(.*)$/.exec(relativeURL);if(relativeURLQuerySplit){relativeURLQuery=relativeURLQuerySplit[2];relativeURL=relativeURLQuerySplit[1];}
var baseURLHashSplit=/^([^#]*)(.*)$/.exec(baseURL);if(baseURLHashSplit){baseURL=baseURLHashSplit[1];}
var baseURLQuerySplit=/^([^\?]*)(.*)$/.exec(baseURL);if(baseURLQuerySplit){baseURL=baseURLQuerySplit[1];}
var baseURLDomainSplit=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(baseURL);if(!baseURLDomainSplit){throw new Error('Error trying to parse base URL.');}
var baseURLProtocol=baseURLDomainSplit[2]||'';var baseURLProtocolDomain=baseURLDomainSplit[1]||'';var baseURLPath=baseURLDomainSplit[4];var builtURL=null;if(/^\/\//.test(relativeURL)){builtURL=baseURLProtocol+'//'+URLToolkit.buildAbsolutePath('',relativeURL.substring(2));}
else if(/^\//.test(relativeURL)){builtURL=baseURLProtocolDomain+'/'+URLToolkit.buildAbsolutePath('',relativeURL.substring(1));}
else{builtURL=URLToolkit.buildAbsolutePath(baseURLProtocolDomain+baseURLPath,relativeURL);}
if(relativeURLQuery){builtURL+=relativeURLQuery;}
if(relativeURLHash){builtURL+=relativeURLHash;}
return builtURL;},buildAbsolutePath:function(basePath,relativePath){var sRelPath=relativePath;var nUpLn,sDir='',sPath=basePath.replace(/[^\/]*$/,sRelPath.replace(/(\/|^)(?:\.?\/+)+/g,'$1'));for(var nEnd,nStart=0;nEnd=sPath.indexOf('/../',nStart),nEnd>-1;nStart=nEnd+nUpLn){nUpLn=/^\/(?:\.\.\/)*/.exec(sPath.slice(nEnd))[0].length;sDir=(sDir+sPath.substring(nStart,nEnd)).replace(new RegExp('(?:\\\/+[^\\\/]*){0,'+((nUpLn-1)/3)+'}$'),'/');}
return sDir+sPath.substr(nStart);}};if(typeof exports==='object'&&typeof module==='object')
module.exports=URLToolkit;else if(typeof define==='function'&&define.amd)
define([],function(){return URLToolkit;});else if(typeof exports==='object')
exports["URLToolkit"]=URLToolkit;else
root["URLToolkit"]=URLToolkit;})(this);},{}],87:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var deprecateOldCue=function deprecateOldCue(cue){Object.defineProperties(cue.frame,{id:{get:function get(){_videoJs2['default'].log.warn('cue.frame.id is deprecated. Use cue.value.key instead.');return cue.value.key;}},value:{get:function get(){_videoJs2['default'].log.warn('cue.frame.value is deprecated. Use cue.value.data instead.');return cue.value.data;}},privateData:{get:function get(){_videoJs2['default'].log.warn('cue.frame.privateData is deprecated. Use cue.value.data instead.');return cue.value.data;}}});};var durationOfVideo=function durationOfVideo(duration){var dur=undefined;if(isNaN(duration)||Math.abs(duration)===Infinity){dur=Number.MAX_VALUE;}else{dur=duration;}
return dur;};var addTextTrackData=function addTextTrackData(sourceHandler,captionArray,metadataArray){var Cue=_globalWindow2['default'].WebKitDataCue||_globalWindow2['default'].VTTCue;if(captionArray){captionArray.forEach(function(caption){this.inbandTextTrack_.addCue(new Cue(caption.startTime+this.timestampOffset,caption.endTime+this.timestampOffset,caption.text));},sourceHandler);}
if(metadataArray){var videoDuration=durationOfVideo(sourceHandler.mediaSource_.duration);metadataArray.forEach(function(metadata){var time=metadata.cueTime+this.timestampOffset;metadata.frames.forEach(function(frame){var cue=new Cue(time,time,frame.value||frame.url||frame.data||'');cue.frame=frame;cue.value=frame;deprecateOldCue(cue);this.metadataTrack_.addCue(cue);},this);},sourceHandler);if(sourceHandler.metadataTrack_&&sourceHandler.metadataTrack_.cues&&sourceHandler.metadataTrack_.cues.length){var cues=sourceHandler.metadataTrack_.cues;var cuesArray=[];for(var j=0;j<cues.length;j++){cuesArray.push(cues[j]);}
cuesArray.sort(function(first,second){return first.startTime-second.startTime;});for(var i=0;i<cuesArray.length-1;i++){if(cuesArray[i].endTime!==cuesArray[i+1].startTime){cuesArray[i].endTime=cuesArray[i+1].startTime;}}
cuesArray[cuesArray.length-1].endTime=videoDuration;}}};exports['default']={addTextTrackData:addTextTrackData,durationOfVideo:durationOfVideo};module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"global/window":26}],88:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var isAudioCodec=function isAudioCodec(codec){return(/mp4a\.\d+.\d+/i.test(codec));};var isVideoCodec=function isVideoCodec(codec){return(/avc1\.[\da-f]+/i.test(codec));};var parseContentType=function parseContentType(type){var object={type:'',parameters:{}};var parameters=type.trim().split(';');object.type=parameters.shift().trim();parameters.forEach(function(parameter){var pair=parameter.trim().split('=');if(pair.length>1){var _name=pair[0].replace(/"/g,'').trim();var value=pair[1].replace(/"/g,'').trim();object.parameters[_name]=value;}});return object;};exports['default']={isAudioCodec:isAudioCodec,parseContentType:parseContentType,isVideoCodec:isVideoCodec};module.exports=exports['default'];},{}],89:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var createTextTracksIfNecessary=function createTextTracksIfNecessary(sourceBuffer,mediaSource,segment){if(segment.captions&&segment.captions.length&&!sourceBuffer.inbandTextTrack_){sourceBuffer.inbandTextTrack_=mediaSource.player_.addTextTrack('captions','cc1');}
if(segment.metadata&&segment.metadata.length&&!sourceBuffer.metadataTrack_){sourceBuffer.metadataTrack_=mediaSource.player_.addTextTrack('metadata','Timed Metadata');sourceBuffer.metadataTrack_.inBandMetadataTrackDispatchType=segment.metadata.dispatchType;}};exports['default']=createTextTracksIfNecessary;module.exports=exports['default'];},{}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var flashConstants={TIME_BETWEEN_CHUNKS:4,BYTES_PER_CHUNK:4096};exports["default"]=flashConstants;module.exports=exports["default"];},{}],91:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _globalDocument=require('global/document');var _globalDocument2=_interopRequireDefault(_globalDocument);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _flashSourceBuffer=require('./flash-source-buffer');var _flashSourceBuffer2=_interopRequireDefault(_flashSourceBuffer);var _flashConstants=require('./flash-constants');var _flashConstants2=_interopRequireDefault(_flashConstants);var _codecUtils=require('./codec-utils');var FlashMediaSource=(function(_videojs$EventTarget){_inherits(FlashMediaSource,_videojs$EventTarget);function FlashMediaSource(){var _this=this;_classCallCheck(this,FlashMediaSource);_get(Object.getPrototypeOf(FlashMediaSource.prototype),'constructor',this).call(this);this.sourceBuffers=[];this.readyState='closed';this.on(['sourceopen','webkitsourceopen'],function(event){_this.swfObj=_globalDocument2['default'].getElementById(event.swfId);_this.player_=(0,_videoJs2['default'])(_this.swfObj.parentNode);_this.tech_=_this.swfObj.tech;_this.readyState='open';_this.tech_.on('seeking',function(){var i=_this.sourceBuffers.length;while(i--){_this.sourceBuffers[i].abort();}});if(_this.swfObj){_this.swfObj.vjs_load();}});}
_createClass(FlashMediaSource,[{key:'addSeekableRange_',value:function addSeekableRange_(){}},{key:'addSourceBuffer',value:function addSourceBuffer(type){var parsedType=(0,_codecUtils.parseContentType)(type);var sourceBuffer=undefined;if(parsedType.type==='video/mp2t'){sourceBuffer=new _flashSourceBuffer2['default'](this);}else{throw new Error('NotSupportedError (Video.js)');}
this.sourceBuffers.push(sourceBuffer);return sourceBuffer;}},{key:'endOfStream',value:function endOfStream(error){if(error==='network'){this.tech_.error(2);}else if(error==='decode'){this.tech_.error(3);}
if(this.readyState!=='ended'){this.readyState='ended';this.swfObj.vjs_endOfStream();}}}]);return FlashMediaSource;})(_videoJs2['default'].EventTarget);exports['default']=FlashMediaSource;try{Object.defineProperty(FlashMediaSource.prototype,'duration',{get:function get(){if(!this.swfObj){return NaN;}
return this.swfObj.vjs_getProperty('duration');},set:function set(value){var i=undefined;var oldDuration=this.swfObj.vjs_getProperty('duration');this.swfObj.vjs_setProperty('duration',value);if(value<oldDuration){for(i=0;i<this.sourceBuffers.length;i++){this.sourceBuffers[i].remove(value,oldDuration);}}
return value;}});}catch(e){FlashMediaSource.prototype.duration=NaN;}
for(var property in _flashConstants2['default']){FlashMediaSource[property]=_flashConstants2['default'][property];}
module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./codec-utils":88,"./flash-constants":90,"./flash-source-buffer":92,"global/document":25}],92:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _muxJsLibFlv=require('mux.js/lib/flv');var _muxJsLibFlv2=_interopRequireDefault(_muxJsLibFlv);var _removeCuesFromTrack=require('./remove-cues-from-track');var _removeCuesFromTrack2=_interopRequireDefault(_removeCuesFromTrack);var _createTextTracksIfNecessary=require('./create-text-tracks-if-necessary');var _createTextTracksIfNecessary2=_interopRequireDefault(_createTextTracksIfNecessary);var _addTextTrackData=require('./add-text-track-data');var _flashConstants=require('./flash-constants');var _flashConstants2=_interopRequireDefault(_flashConstants);var scheduleTick=function scheduleTick(func){_globalWindow2['default'].setTimeout(func,_flashConstants2['default'].TIME_BETWEEN_CHUNKS);};var toDecimalPlaces=function toDecimalPlaces(num,places){if(typeof places!=='number'||places<0){places=0;}
var scale=Math.pow(10,places);return Math.round(num*scale)/scale;};var FlashSourceBuffer=(function(_videojs$EventTarget){_inherits(FlashSourceBuffer,_videojs$EventTarget);function FlashSourceBuffer(mediaSource){var _this=this;_classCallCheck(this,FlashSourceBuffer);_get(Object.getPrototypeOf(FlashSourceBuffer.prototype),'constructor',this).call(this);var encodedHeader=undefined;this.chunkSize_=_flashConstants2['default'].BYTES_PER_CHUNK;this.buffer_=[];this.bufferSize_=0;this.basePtsOffset_=NaN;this.mediaSource_=mediaSource;this.updating=false;this.timestampOffset_=0;this.segmentParser_=new _muxJsLibFlv2['default'].Transmuxer();this.segmentParser_.on('data',this.receiveBuffer_.bind(this));encodedHeader=_globalWindow2['default'].btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(this.segmentParser_.getFlvHeader())));this.mediaSource_.swfObj.vjs_appendBuffer(encodedHeader);this.one('updateend',function(){_this.mediaSource_.tech_.trigger('loadedmetadata');});Object.defineProperty(this,'timestampOffset',{get:function get(){return this.timestampOffset_;},set:function set(val){if(typeof val==='number'&&val>=0){this.timestampOffset_=val;this.segmentParser_=new _muxJsLibFlv2['default'].Transmuxer();this.segmentParser_.on('data',this.receiveBuffer_.bind(this));this.mediaSource_.swfObj.vjs_discontinuity();this.basePtsOffset_=NaN;}}});Object.defineProperty(this,'buffered',{get:function get(){if(!this.mediaSource_||!this.mediaSource_.swfObj||!('vjs_getProperty'in this.mediaSource_.swfObj)){return _videoJs2['default'].createTimeRange();}
var buffered=this.mediaSource_.swfObj.vjs_getProperty('buffered');if(buffered&&buffered.length){buffered[0][0]=toDecimalPlaces(buffered[0][0],3);buffered[0][1]=toDecimalPlaces(buffered[0][1],3);}
return _videoJs2['default'].createTimeRanges(buffered);}});this.mediaSource_.player_.on('seeked',function(){(0,_removeCuesFromTrack2['default'])(0,Infinity,_this.metadataTrack_);(0,_removeCuesFromTrack2['default'])(0,Infinity,_this.inbandTextTrack_);});}
_createClass(FlashSourceBuffer,[{key:'appendBuffer',value:function appendBuffer(bytes){var _this2=this;var error=undefined;var chunk=512*1024;var i=0;if(this.updating){error=new Error('SourceBuffer.append() cannot be called '+'while an update is in progress');error.name='InvalidStateError';error.code=11;throw error;}
this.updating=true;this.mediaSource_.readyState='open';this.trigger({type:'update'});var chunkInData=function chunkInData(){_this2.segmentParser_.push(bytes.subarray(i,i+chunk));i+=chunk;if(i<bytes.byteLength){scheduleTick(chunkInData);}else{scheduleTick(_this2.segmentParser_.flush.bind(_this2.segmentParser_));}};chunkInData();}},{key:'abort',value:function abort(){this.buffer_=[];this.bufferSize_=0;this.mediaSource_.swfObj.vjs_abort();if(this.updating){this.updating=false;this.trigger({type:'updateend'});}}},{key:'remove',value:function remove(start,end){(0,_removeCuesFromTrack2['default'])(start,end,this.metadataTrack_);(0,_removeCuesFromTrack2['default'])(start,end,this.inbandTextTrack_);this.trigger({type:'update'});this.trigger({type:'updateend'});}},{key:'receiveBuffer_',value:function receiveBuffer_(segment){var _this3=this;(0,_createTextTracksIfNecessary2['default'])(this,this.mediaSource_,segment);(0,_addTextTrackData.addTextTrackData)(this,segment.captions,segment.metadata);scheduleTick(function(){var flvBytes=_this3.convertTagsToData_(segment);if(_this3.buffer_.length===0){scheduleTick(_this3.processBuffer_.bind(_this3));}
if(flvBytes){_this3.buffer_.push(flvBytes);_this3.bufferSize_+=flvBytes.byteLength;}});}},{key:'processBuffer_',value:function processBuffer_(){var chunkSize=_flashConstants2['default'].BYTES_PER_CHUNK;if(!this.buffer_.length){if(this.updating!==false){this.updating=false;this.trigger({type:'updateend'});}
return;}
var chunk=this.buffer_[0].subarray(0,chunkSize);if(chunk.byteLength<chunkSize||this.buffer_[0].byteLength===chunkSize){this.buffer_.shift();}else{this.buffer_[0]=this.buffer_[0].subarray(chunkSize);}
this.bufferSize_-=chunk.byteLength;var binary='';var length=chunk.byteLength;for(var i=0;i<length;i++){binary+=String.fromCharCode(chunk[i]);}
var b64str=_globalWindow2['default'].btoa(binary);this.mediaSource_.swfObj.CallFunction('<invoke name="vjs_appendBuffer"'+'returntype="javascript"><arguments><string>'+b64str+'</string></arguments></invoke>');if(this.bufferSize_!==0){scheduleTick(this.processBuffer_.bind(this));}else{this.updating=false;this.trigger({type:'updateend'});}}},{key:'convertTagsToData_',value:function convertTagsToData_(segmentData){var segmentByteLength=0;var tech=this.mediaSource_.tech_;var targetPts=0;var i=undefined;var j=undefined;var segment=undefined;var filteredTags=[];var tags=this.getOrderedTags_(segmentData);if(isNaN(this.basePtsOffset_)&&tags.length){this.basePtsOffset_=tags[0].pts;}
if(tech.seeking()){targetPts=Math.max(targetPts,tech.currentTime()-this.timestampOffset);}
targetPts*=1e3;targetPts+=this.basePtsOffset_;for(i=0;i<tags.length;i++){if(tags[i].pts>=targetPts){filteredTags.push(tags[i]);}}
if(filteredTags.length===0){return;}
for(i=0;i<filteredTags.length;i++){segmentByteLength+=filteredTags[i].bytes.byteLength;}
segment=new Uint8Array(segmentByteLength);for(i=0,j=0;i<filteredTags.length;i++){segment.set(filteredTags[i].bytes,j);j+=filteredTags[i].bytes.byteLength;}
return segment;}},{key:'getOrderedTags_',value:function getOrderedTags_(segmentData){var videoTags=segmentData.tags.videoTags;var audioTags=segmentData.tags.audioTags;var tag=undefined;var tags=[];while(videoTags.length||audioTags.length){if(!videoTags.length){tag=audioTags.shift();}else if(!audioTags.length){tag=videoTags.shift();}else if(audioTags[0].dts<videoTags[0].dts){tag=audioTags.shift();}else{tag=videoTags.shift();}
tags.push(tag.finalize());}
return tags;}}]);return FlashSourceBuffer;})(_videoJs2['default'].EventTarget);exports['default']=FlashSourceBuffer;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":87,"./create-text-tracks-if-necessary":89,"./flash-constants":90,"./remove-cues-from-track":94,"global/window":26,"mux.js/lib/flv":73}],93:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var _globalDocument=require('global/document');var _globalDocument2=_interopRequireDefault(_globalDocument);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _virtualSourceBuffer=require('./virtual-source-buffer');var _virtualSourceBuffer2=_interopRequireDefault(_virtualSourceBuffer);var _addTextTrackData=require('./add-text-track-data');var _codecUtils=require('./codec-utils');var translateLegacyCodecs=function translateLegacyCodecs(codecs){return codecs.map(function(codec){return codec.replace(/avc1\.(\d+)\.(\d+)/i,function(orig,profile,avcLevel){var profileHex=('00'+Number(profile).toString(16)).slice(-2);var avcLevelHex=('00'+Number(avcLevel).toString(16)).slice(-2);return 'avc1.'+profileHex+'00'+avcLevelHex;});});};var HtmlMediaSource=(function(_videojs$EventTarget){_inherits(HtmlMediaSource,_videojs$EventTarget);function HtmlMediaSource(){var _this=this;_classCallCheck(this,HtmlMediaSource);_get(Object.getPrototypeOf(HtmlMediaSource.prototype),'constructor',this).call(this);var property=undefined;this.nativeMediaSource_=new _globalWindow2['default'].MediaSource();for(property in this.nativeMediaSource_){if(!(property in HtmlMediaSource.prototype)&&typeof this.nativeMediaSource_[property]==='function'){this[property]=this.nativeMediaSource_[property].bind(this.nativeMediaSource_);}}
this.duration_=NaN;Object.defineProperty(this,'duration',{get:function get(){if(this.duration_===Infinity){return this.duration_;}
return this.nativeMediaSource_.duration;},set:function set(duration){this.duration_=duration;if(duration!==Infinity){this.nativeMediaSource_.duration=duration;return;}}});Object.defineProperty(this,'seekable',{get:function get(){if(this.duration_===Infinity){return _videoJs2['default'].createTimeRanges([[0,this.nativeMediaSource_.duration]]);}
return this.nativeMediaSource_.seekable;}});Object.defineProperty(this,'readyState',{get:function get(){return this.nativeMediaSource_.readyState;}});Object.defineProperty(this,'activeSourceBuffers',{get:function get(){return this.activeSourceBuffers_;}});this.sourceBuffers=[];this.activeSourceBuffers_=[];this.updateActiveSourceBuffers_=function(){_this.activeSourceBuffers_.length=0;var combined=false;var audioOnly=true;for(var i=0;i<_this.player_.audioTracks().length;i++){var track=_this.player_.audioTracks()[i];if(track.enabled&&track.kind!=='main'){combined=true;audioOnly=false;break;}}
_this.sourceBuffers.forEach(function(sourceBuffer){sourceBuffer.appendAudioInitSegment_=true;if(sourceBuffer.videoCodec_&&sourceBuffer.audioCodec_){sourceBuffer.audioDisabled_=combined;}else if(sourceBuffer.videoCodec_&&!sourceBuffer.audioCodec_){sourceBuffer.audioDisabled_=true;audioOnly=false;}else if(!sourceBuffer.videoCodec_&&sourceBuffer.audioCodec_){sourceBuffer.audioDisabled_=audioOnly;if(audioOnly){return;}}
_this.activeSourceBuffers_.push(sourceBuffer);});};this.onPlayerMediachange_=function(){_this.sourceBuffers.forEach(function(sourceBuffer){sourceBuffer.appendAudioInitSegment_=true;});};['sourceopen','sourceclose','sourceended'].forEach(function(eventName){this.nativeMediaSource_.addEventListener(eventName,this.trigger.bind(this));},this);this.on('sourceopen',function(event){var video=_globalDocument2['default'].querySelector('[src="'+_this.url_+'"]');if(!video){return;}
_this.player_=(0,_videoJs2['default'])(video.parentNode);if(_this.player_.audioTracks&&_this.player_.audioTracks()){_this.player_.audioTracks().on('change',_this.updateActiveSourceBuffers_);_this.player_.audioTracks().on('addtrack',_this.updateActiveSourceBuffers_);_this.player_.audioTracks().on('removetrack',_this.updateActiveSourceBuffers_);}
_this.player_.on('mediachange',_this.onPlayerMediachange_);});this.on('sourceended',function(event){var duration=(0,_addTextTrackData.durationOfVideo)(_this.duration);for(var i=0;i<_this.sourceBuffers.length;i++){var sourcebuffer=_this.sourceBuffers[i];var cues=sourcebuffer.metadataTrack_&&sourcebuffer.metadataTrack_.cues;if(cues&&cues.length){cues[cues.length-1].endTime=duration;}}});this.on('sourceclose',function(event){this.sourceBuffers.forEach(function(sourceBuffer){if(sourceBuffer.transmuxer_){sourceBuffer.transmuxer_.terminate();}});this.sourceBuffers.length=0;if(!this.player_){return;}
if(this.player_.audioTracks&&this.player_.audioTracks()){this.player_.audioTracks().off('change',this.updateActiveSourceBuffers_);this.player_.audioTracks().off('addtrack',this.updateActiveSourceBuffers_);this.player_.audioTracks().off('removetrack',this.updateActiveSourceBuffers_);}
this.player_.off('mediachange',this.onPlayerMediachange_);});}
_createClass(HtmlMediaSource,[{key:'addSeekableRange_',value:function addSeekableRange_(start,end){var error=undefined;if(this.duration!==Infinity){error=new Error('MediaSource.addSeekableRange() can only be invoked '+'when the duration is Infinity');error.name='InvalidStateError';error.code=11;throw error;}
if(end>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration)){this.nativeMediaSource_.duration=end;}}},{key:'addSourceBuffer',value:function addSourceBuffer(type){var buffer=undefined;var parsedType=(0,_codecUtils.parseContentType)(type);if(/^(video|audio)\/mp2t$/i.test(parsedType.type)){var codecs=[];if(parsedType.parameters&&parsedType.parameters.codecs){codecs=parsedType.parameters.codecs.split(',');codecs=translateLegacyCodecs(codecs);codecs=codecs.filter(function(codec){return(0,_codecUtils.isAudioCodec)(codec)||(0,_codecUtils.isVideoCodec)(codec);});}
if(codecs.length===0){codecs=['avc1.4d400d','mp4a.40.2'];}
buffer=new _virtualSourceBuffer2['default'](this,codecs);if(this.sourceBuffers.length!==0){this.sourceBuffers[0].createRealSourceBuffers_();buffer.createRealSourceBuffers_();this.sourceBuffers[0].audioDisabled_=true;}}else{buffer=this.nativeMediaSource_.addSourceBuffer(type);}
this.sourceBuffers.push(buffer);return buffer;}}]);return HtmlMediaSource;})(_videoJs2['default'].EventTarget);exports['default']=HtmlMediaSource;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":87,"./codec-utils":88,"./virtual-source-buffer":97,"global/document":25,"global/window":26}],94:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var removeCuesFromTrack=function removeCuesFromTrack(start,end,track){var i=undefined;var cue=undefined;if(!track){return;}
i=track.cues.length;while(i--){cue=track.cues[i];if(cue.startTime<=end&&cue.endTime>=start){track.removeCue(cue);}}};exports["default"]=removeCuesFromTrack;module.exports=exports["default"];},{}],95:[function(require,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var _muxJsLibMp4=require('mux.js/lib/mp4');var _muxJsLibMp42=_interopRequireDefault(_muxJsLibMp4);var wireTransmuxerEvents=function wireTransmuxerEvents(transmuxer){transmuxer.on('data',function(segment){var initArray=segment.initSegment;segment.initSegment={data:initArray.buffer,byteOffset:initArray.byteOffset,byteLength:initArray.byteLength};var typedArray=segment.data;segment.data=typedArray.buffer;_globalWindow2['default'].postMessage({action:'data',segment:segment,byteOffset:typedArray.byteOffset,byteLength:typedArray.byteLength},[segment.data]);});if(transmuxer.captionStream){transmuxer.captionStream.on('data',function(caption){_globalWindow2['default'].postMessage({action:'caption',data:caption});});}
transmuxer.on('done',function(data){_globalWindow2['default'].postMessage({action:'done'});});};var MessageHandlers=(function(){function MessageHandlers(options){_classCallCheck(this,MessageHandlers);this.options=options||{};this.init();}
_createClass(MessageHandlers,[{key:'init',value:function init(){if(this.transmuxer){this.transmuxer.dispose();}
this.transmuxer=new _muxJsLibMp42['default'].Transmuxer(this.options);wireTransmuxerEvents(this.transmuxer);}},{key:'push',value:function push(data){var segment=new Uint8Array(data.data,data.byteOffset,data.byteLength);this.transmuxer.push(segment);}},{key:'reset',value:function reset(){this.init();}},{key:'setTimestampOffset',value:function setTimestampOffset(data){var timestampOffset=data.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(timestampOffset*90000));}},{key:'flush',value:function flush(data){this.transmuxer.flush();}}]);return MessageHandlers;})();var Worker=function Worker(self){self.onmessage=function(event){if(event.data.action==='init'&&event.data.options){this.messageHandlers=new MessageHandlers(event.data.options);return;}
if(!this.messageHandlers){this.messageHandlers=new MessageHandlers();}
if(event.data&&event.data.action&&event.data.action!=='init'){if(this.messageHandlers[event.data.action]){this.messageHandlers[event.data.action](event.data);}}};};exports['default']=function(self){return new Worker(self);};module.exports=exports['default'];},{"global/window":26,"mux.js/lib/mp4":80}],96:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var _flashMediaSource=require('./flash-media-source');var _flashMediaSource2=_interopRequireDefault(_flashMediaSource);var _htmlMediaSource=require('./html-media-source');var _htmlMediaSource2=_interopRequireDefault(_htmlMediaSource);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var urlCount=0;var defaults={mode:'auto'};_videoJs2['default'].mediaSources={};var open=function open(msObjectURL,swfId){var mediaSource=_videoJs2['default'].mediaSources[msObjectURL];if(mediaSource){mediaSource.trigger({type:'sourceopen',swfId:swfId});}else{throw new Error('Media Source not found (Video.js)');}};var supportsNativeMediaSources=function supportsNativeMediaSources(){return!!_globalWindow2['default'].MediaSource&&!!_globalWindow2['default'].MediaSource.isTypeSupported&&_globalWindow2['default'].MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"');};var MediaSource=function MediaSource(options){var settings=_videoJs2['default'].mergeOptions(defaults,options);this.MediaSource={open:open,supportsNativeMediaSources:supportsNativeMediaSources};if(settings.mode==='html5'||settings.mode==='auto'&&supportsNativeMediaSources()){return new _htmlMediaSource2['default']();}
return new _flashMediaSource2['default']();};exports.MediaSource=MediaSource;MediaSource.open=open;MediaSource.supportsNativeMediaSources=supportsNativeMediaSources;var URL={createObjectURL:function createObjectURL(object){var objectUrlPrefix='blob:vjs-media-source/';var url=undefined;if(object instanceof _htmlMediaSource2['default']){url=_globalWindow2['default'].URL.createObjectURL(object.nativeMediaSource_);object.url_=url;return url;}
if(!(object instanceof _flashMediaSource2['default'])){url=_globalWindow2['default'].URL.createObjectURL(object);object.url_=url;return url;}
url=objectUrlPrefix+urlCount;urlCount++;_videoJs2['default'].mediaSources[url]=object;return url;}};exports.URL=URL;_videoJs2['default'].MediaSource=MediaSource;_videoJs2['default'].URL=URL;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./flash-media-source":91,"./html-media-source":93,"global/window":26}],97:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _createTextTracksIfNecessary=require('./create-text-tracks-if-necessary');var _createTextTracksIfNecessary2=_interopRequireDefault(_createTextTracksIfNecessary);var _removeCuesFromTrack=require('./remove-cues-from-track');var _removeCuesFromTrack2=_interopRequireDefault(_removeCuesFromTrack);var _addTextTrackData=require('./add-text-track-data');var _webworkify=require('webworkify');var _webworkify2=_interopRequireDefault(_webworkify);var _transmuxerWorker=require('./transmuxer-worker');var _transmuxerWorker2=_interopRequireDefault(_transmuxerWorker);var _codecUtils=require('./codec-utils');var VirtualSourceBuffer=(function(_videojs$EventTarget){_inherits(VirtualSourceBuffer,_videojs$EventTarget);function VirtualSourceBuffer(mediaSource,codecs){var _this=this;_classCallCheck(this,VirtualSourceBuffer);_get(Object.getPrototypeOf(VirtualSourceBuffer.prototype),'constructor',this).call(this,_videoJs2['default'].EventTarget);this.timestampOffset_=0;this.pendingBuffers_=[];this.bufferUpdating_=false;this.mediaSource_=mediaSource;this.codecs_=codecs;this.audioCodec_=null;this.videoCodec_=null;this.audioDisabled_=false;this.appendAudioInitSegment_=true;var options={remux:false};this.codecs_.forEach(function(codec){if((0,_codecUtils.isAudioCodec)(codec)){_this.audioCodec_=codec;}else if((0,_codecUtils.isVideoCodec)(codec)){_this.videoCodec_=codec;}});this.transmuxer_=(0,_webworkify2['default'])(_transmuxerWorker2['default']);this.transmuxer_.postMessage({action:'init',options:options});this.transmuxer_.onmessage=function(event){if(event.data.action==='data'){return _this.data_(event);}
if(event.data.action==='done'){return _this.done_(event);}};Object.defineProperty(this,'timestampOffset',{get:function get(){return this.timestampOffset_;},set:function set(val){if(typeof val==='number'&&val>=0){this.timestampOffset_=val;this.appendAudioInitSegment_=true;this.transmuxer_.postMessage({action:'setTimestampOffset',timestampOffset:val});}}});Object.defineProperty(this,'appendWindowStart',{get:function get(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart;},set:function set(start){if(this.videoBuffer_){this.videoBuffer_.appendWindowStart=start;}
if(this.audioBuffer_){this.audioBuffer_.appendWindowStart=start;}}});Object.defineProperty(this,'updating',{get:function get(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating);}});Object.defineProperty(this,'buffered',{get:function get(){var start=null;var end=null;var arity=0;var extents=[];var ranges=[];if(!this.videoBuffer_&&!this.audioBuffer_){return _videoJs2['default'].createTimeRange();}
if(!this.videoBuffer_){return this.audioBuffer_.buffered;}
if(!this.audioBuffer_){return this.videoBuffer_.buffered;}
if(this.audioDisabled_){return this.videoBuffer_.buffered;}
if(this.videoBuffer_.buffered.length===0&&this.audioBuffer_.buffered.length===0){return _videoJs2['default'].createTimeRange();}
var videoBuffered=this.videoBuffer_.buffered;var audioBuffered=this.audioBuffer_.buffered;var count=videoBuffered.length;while(count--){extents.push({time:videoBuffered.start(count),type:'start'});extents.push({time:videoBuffered.end(count),type:'end'});}
count=audioBuffered.length;while(count--){extents.push({time:audioBuffered.start(count),type:'start'});extents.push({time:audioBuffered.end(count),type:'end'});}
extents.sort(function(a,b){return a.time-b.time;});for(count=0;count<extents.length;count++){if(extents[count].type==='start'){arity++;if(arity===2){start=extents[count].time;}}else if(extents[count].type==='end'){arity--;if(arity===1){end=extents[count].time;}}
if(start!==null&&end!==null){ranges.push([start,end]);start=null;end=null;}}
return _videoJs2['default'].createTimeRanges(ranges);}});}
_createClass(VirtualSourceBuffer,[{key:'data_',value:function data_(event){var segment=event.data.segment;segment.data=new Uint8Array(segment.data,event.data.byteOffset,event.data.byteLength);segment.initSegment=new Uint8Array(segment.initSegment.data,segment.initSegment.byteOffset,segment.initSegment.byteLength);(0,_createTextTracksIfNecessary2['default'])(this,this.mediaSource_,segment);this.pendingBuffers_.push(segment);return;}},{key:'done_',value:function done_(event){this.processPendingSegments_();return;}},{key:'createRealSourceBuffers_',value:function createRealSourceBuffers_(){var _this2=this;var types=['audio','video'];types.forEach(function(type){if(!_this2[type+'Codec_']){return;}
if(_this2[type+'Buffer_']){return;}
var buffer=null;if(_this2.mediaSource_[type+'Buffer_']){buffer=_this2.mediaSource_[type+'Buffer_'];}else{buffer=_this2.mediaSource_.nativeMediaSource_.addSourceBuffer(type+'/mp4;codecs="'+_this2[type+'Codec_']+'"');_this2.mediaSource_[type+'Buffer_']=buffer;}
_this2[type+'Buffer_']=buffer;['update','updatestart','updateend'].forEach(function(event){buffer.addEventListener(event,function(){if(type==='audio'&&_this2.audioDisabled_){return;}
var shouldTrigger=types.every(function(t){if(t==='audio'&&_this2.audioDisabled_){return true;}
if(type!==t&&_this2[t+'Buffer_']&&_this2[t+'Buffer_'].updating){return false;}
return true;});if(shouldTrigger){return _this2.trigger(event);}});});});}},{key:'appendBuffer',value:function appendBuffer(segment){this.bufferUpdating_=true;this.transmuxer_.postMessage({action:'push',data:segment.buffer,byteOffset:segment.byteOffset,byteLength:segment.byteLength},[segment.buffer]);this.transmuxer_.postMessage({action:'flush'});}},{key:'remove',value:function remove(start,end){if(this.videoBuffer_){this.videoBuffer_.remove(start,end);}
if(this.audioBuffer_){this.audioBuffer_.remove(start,end);}
(0,_removeCuesFromTrack2['default'])(start,end,this.metadataTrack_);(0,_removeCuesFromTrack2['default'])(start,end,this.inbandTextTrack_);}},{key:'processPendingSegments_',value:function processPendingSegments_(){var sortedSegments={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};sortedSegments=this.pendingBuffers_.reduce(function(segmentObj,segment){var type=segment.type;var data=segment.data;var initSegment=segment.initSegment;segmentObj[type].segments.push(data);segmentObj[type].bytes+=data.byteLength;segmentObj[type].initSegment=initSegment;if(segment.captions){segmentObj.captions=segmentObj.captions.concat(segment.captions);}
if(segment.info){segmentObj[type].info=segment.info;}
if(segment.metadata){segmentObj.metadata=segmentObj.metadata.concat(segment.metadata);}
return segmentObj;},sortedSegments);if(!this.videoBuffer_&&!this.audioBuffer_){if(sortedSegments.video.bytes===0){this.videoCodec_=null;}
if(sortedSegments.audio.bytes===0){this.audioCodec_=null;}
this.createRealSourceBuffers_();}
if(sortedSegments.audio.info){this.mediaSource_.trigger({type:'audioinfo',info:sortedSegments.audio.info});}
if(sortedSegments.video.info){this.mediaSource_.trigger({type:'videoinfo',info:sortedSegments.video.info});}
if(this.appendAudioInitSegment_){if(!this.audioDisabled_&&this.audioBuffer_){sortedSegments.audio.segments.unshift(sortedSegments.audio.initSegment);sortedSegments.audio.bytes+=sortedSegments.audio.initSegment.byteLength;}
this.appendAudioInitSegment_=false;}
if(this.videoBuffer_){sortedSegments.video.segments.unshift(sortedSegments.video.initSegment);sortedSegments.video.bytes+=sortedSegments.video.initSegment.byteLength;this.concatAndAppendSegments_(sortedSegments.video,this.videoBuffer_);(0,_addTextTrackData.addTextTrackData)(this,sortedSegments.captions,sortedSegments.metadata);}
if(!this.audioDisabled_&&this.audioBuffer_){this.concatAndAppendSegments_(sortedSegments.audio,this.audioBuffer_);}
this.pendingBuffers_.length=0;this.bufferUpdating_=false;}},{key:'concatAndAppendSegments_',value:function concatAndAppendSegments_(segmentObj,destinationBuffer){var offset=0;var tempBuffer=undefined;if(segmentObj.bytes){tempBuffer=new Uint8Array(segmentObj.bytes);segmentObj.segments.forEach(function(segment){tempBuffer.set(segment,offset);offset+=segment.byteLength;});try{destinationBuffer.appendBuffer(tempBuffer);}catch(error){if(this.mediaSource_.player_){this.mediaSource_.player_.error({code:-3,type:'APPEND_BUFFER_ERR'});}}}}},{key:'abort',value:function abort(){if(this.videoBuffer_){this.videoBuffer_.abort();}
if(this.audioBuffer_){this.audioBuffer_.abort();}
if(this.transmuxer_){this.transmuxer_.postMessage({action:'reset'});}
this.pendingBuffers_.length=0;this.bufferUpdating_=false;}}]);return VirtualSourceBuffer;})(_videoJs2['default'].EventTarget);exports['default']=VirtualSourceBuffer;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":87,"./codec-utils":88,"./create-text-tracks-if-necessary":89,"./remove-cues-from-track":94,"./transmuxer-worker":95,"webworkify":98}],98:[function(require,module,exports){var bundleFn=arguments[3];var sources=arguments[4];var cache=arguments[5];var stringify=JSON.stringify;module.exports=function(fn){var keys=[];var wkey;var cacheKeys=Object.keys(cache);for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];if(cache[key].exports===fn){wkey=key;break;}}
if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key;}
sources[wkey]=[Function(['require','module','exports'],'('+fn+')(self)'),wcache];}
var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var scache={};scache[wkey]=wkey;sources[skey]=[Function(['require'],'require('+stringify(wkey)+')(self)'),scache];var src='('+bundleFn+')({'
+Object.keys(sources).map(function(key){return stringify(key)+':['
+sources[key][0]
+','+stringify(sources[key][1])+']';}).join(',')
+'},{},['+stringify(skey)+'])';var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(URL.createObjectURL(new Blob([src],{type:'text/javascript'})));};},{}],99:[function(require,module,exports){(function(global){'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _globalDocument=require('global/document');var _globalDocument2=_interopRequireDefault(_globalDocument);var _playlistLoader=require('./playlist-loader');var _playlistLoader2=_interopRequireDefault(_playlistLoader);var _playlist=require('./playlist');var _playlist2=_interopRequireDefault(_playlist);var _xhr=require('./xhr');var _xhr2=_interopRequireDefault(_xhr);var _aesDecrypter=require('aes-decrypter');var _binUtils=require('./bin-utils');var _binUtils2=_interopRequireDefault(_binUtils);var _videojsContribMediaSources=require('videojs-contrib-media-sources');var _m3u8Parser=require('m3u8-parser');var _m3u8Parser2=_interopRequireDefault(_m3u8Parser);var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _masterPlaylistController=require('./master-playlist-controller');var _config=require('./config');var _config2=_interopRequireDefault(_config);var _renditionMixin=require('./rendition-mixin');var _renditionMixin2=_interopRequireDefault(_renditionMixin);var _globalWindow=require('global/window');var _globalWindow2=_interopRequireDefault(_globalWindow);var _playbackWatcher=require('./playback-watcher');var _playbackWatcher2=_interopRequireDefault(_playbackWatcher);var _reloadSourceOnError=require('./reload-source-on-error');var _reloadSourceOnError2=_interopRequireDefault(_reloadSourceOnError);var Hls={PlaylistLoader:_playlistLoader2['default'],Playlist:_playlist2['default'],Decrypter:_aesDecrypter.Decrypter,AsyncStream:_aesDecrypter.AsyncStream,decrypt:_aesDecrypter.decrypt,utils:_binUtils2['default'],xhr:(0,_xhr2['default'])()};Object.defineProperty(Hls,'GOAL_BUFFER_LENGTH',{get:function get(){_videoJs2['default'].log.warn('using Hls.GOAL_BUFFER_LENGTH is UNSAFE be sure '+'you know what you are doing');return _config2['default'].GOAL_BUFFER_LENGTH;},set:function set(v){_videoJs2['default'].log.warn('using Hls.GOAL_BUFFER_LENGTH is UNSAFE be sure '+'you know what you are doing');if(typeof v!=='number'||v<=0){_videoJs2['default'].log.warn('value passed to Hls.GOAL_BUFFER_LENGTH '+'must be a number and greater than 0');return;}
_config2['default'].GOAL_BUFFER_LENGTH=v;}});var BANDWIDTH_VARIANCE=1.2;var safeGetComputedStyle=function safeGetComputedStyle(el,property){var result=undefined;if(!el){return '';}
result=_globalWindow2['default'].getComputedStyle(el);if(!result){return '';}
return result[property];};Hls.STANDARD_PLAYLIST_SELECTOR=function(){var effectiveBitrate=undefined;var sortedPlaylists=this.playlists.master.playlists.slice();var bandwidthPlaylists=[];var now=+new Date();var i=undefined;var variant=undefined;var bandwidthBestVariant=undefined;var resolutionPlusOne=undefined;var resolutionPlusOneAttribute=undefined;var resolutionBestVariant=undefined;var width=undefined;var height=undefined;sortedPlaylists.sort(Hls.comparePlaylistBandwidth);sortedPlaylists=sortedPlaylists.filter(function(localVariant){if(typeof localVariant.excludeUntil!=='undefined'){return now>=localVariant.excludeUntil;}
return true;});i=sortedPlaylists.length;while(i--){variant=sortedPlaylists[i];if(!variant.attributes||!variant.attributes.BANDWIDTH){continue;}
effectiveBitrate=variant.attributes.BANDWIDTH*BANDWIDTH_VARIANCE;if(effectiveBitrate<this.systemBandwidth){bandwidthPlaylists.push(variant);if(!bandwidthBestVariant){bandwidthBestVariant=variant;}}}
i=bandwidthPlaylists.length;bandwidthPlaylists.sort(Hls.comparePlaylistResolution);variant=null;width=parseInt(safeGetComputedStyle(this.tech_.el(),'width'),10);height=parseInt(safeGetComputedStyle(this.tech_.el(),'height'),10);while(i--){variant=bandwidthPlaylists[i];if(!variant.attributes||!variant.attributes.RESOLUTION||!variant.attributes.RESOLUTION.width||!variant.attributes.RESOLUTION.height){continue;}
var variantResolution=variant.attributes.RESOLUTION;if(variantResolution.width===width&&variantResolution.height===height){resolutionPlusOne=null;resolutionBestVariant=variant;break;}else if(variantResolution.width<width&&variantResolution.height<height){break;}else if(!resolutionPlusOne||variantResolution.width<resolutionPlusOneAttribute.width&&variantResolution.height<resolutionPlusOneAttribute.height){resolutionPlusOne=variant;resolutionPlusOneAttribute=resolutionPlusOne.attributes.RESOLUTION;}}
return resolutionPlusOne||resolutionBestVariant||bandwidthBestVariant||sortedPlaylists[0];};Hls.canPlaySource=function(){return _videoJs2['default'].log.warn('HLS is no longer a tech. Please remove it from '+'your player\'s techOrder.');};Hls.supportsNativeHls=(function(){var video=_globalDocument2['default'].createElement('video');if(!_videoJs2['default'].getComponent('Html5').isSupported()){return false;}
var canPlay=['application/vnd.apple.mpegurl','audio/mpegurl','audio/x-mpegurl','application/x-mpegurl','video/x-mpegurl','video/mpegurl','application/mpegurl'];return canPlay.some(function(canItPlay){return(/maybe|probably/i.test(video.canPlayType(canItPlay)));});})();Hls.isSupported=function(){return _videoJs2['default'].log.warn('HLS is no longer a tech. Please remove it from '+'your player\'s techOrder.');};var USER_AGENT=_globalWindow2['default'].navigator&&_globalWindow2['default'].navigator.userAgent||'';Hls.supportsAudioInfoChange_=function(){if(_videoJs2['default'].browser.IS_FIREFOX){var firefoxVersionMap=/Firefox\/([\d.]+)/i.exec(USER_AGENT);var version=parseInt(firefoxVersionMap[1],10);return version>=49;}
return true;};var Component=_videoJs2['default'].getComponent('Component');var HlsHandler=(function(_Component){_inherits(HlsHandler,_Component);function HlsHandler(source,tech,options){var _this=this;_classCallCheck(this,HlsHandler);_get(Object.getPrototypeOf(HlsHandler.prototype),'constructor',this).call(this,tech);if(tech.options_&&tech.options_.playerId){var _player=(0,_videoJs2['default'])(tech.options_.playerId);if(!_player.hasOwnProperty('hls')){Object.defineProperty(_player,'hls',{get:function get(){_videoJs2['default'].log.warn('player.hls is deprecated. Use player.tech_.hls instead.');return _this;}});}}
this.tech_=tech;this.source_=source;this.stats={};this.options_=_videoJs2['default'].mergeOptions(_videoJs2['default'].options.hls||{},options.hls);this.setOptions_();this.on(_globalDocument2['default'],['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange'],function(event){var fullscreenElement=_globalDocument2['default'].fullscreenElement||_globalDocument2['default'].webkitFullscreenElement||_globalDocument2['default'].mozFullScreenElement||_globalDocument2['default'].msFullscreenElement;if(fullscreenElement&&fullscreenElement.contains(_this.tech_.el())){_this.masterPlaylistController_.fastQualityChange_();}});this.on(this.tech_,'seeking',function(){this.setCurrentTime(this.tech_.currentTime());});this.on(this.tech_,'error',function(){if(this.masterPlaylistController_){this.masterPlaylistController_.pauseLoading();}});this.audioTrackChange_=function(){_this.masterPlaylistController_.setupAudio();};this.on(this.tech_,'play',this.play);}
_createClass(HlsHandler,[{key:'setOptions_',value:function setOptions_(){var _this2=this;this.options_.withCredentials=this.options_.withCredentials||false;if(typeof this.options_.bandwidth!=='number'){this.options_.bandwidth=4194304;}
['withCredentials','bandwidth'].forEach(function(option){if(typeof _this2.source_[option]!=='undefined'){_this2.options_[option]=_this2.source_[option];}});this.bandwidth=this.options_.bandwidth;}},{key:'src',value:function src(_src){var _this3=this;if(!_src){return;}
this.setOptions_();this.options_.url=this.source_.src;this.options_.tech=this.tech_;this.options_.externHls=Hls;this.masterPlaylistController_=new _masterPlaylistController.MasterPlaylistController(this.options_);this.playbackWatcher_=new _playbackWatcher2['default'](_videoJs2['default'].mergeOptions(this.options_,{seekable:function seekable(){return _this3.seekable();}}));this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):Hls.STANDARD_PLAYLIST_SELECTOR.bind(this);this.playlists=this.masterPlaylistController_.masterPlaylistLoader_;this.mediaSource=this.masterPlaylistController_.mediaSource;Object.defineProperties(this,{selectPlaylist:{get:function get(){return this.masterPlaylistController_.selectPlaylist;},set:function set(selectPlaylist){this.masterPlaylistController_.selectPlaylist=selectPlaylist.bind(this);}},throughput:{get:function get(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate;},set:function set(throughput){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=throughput;this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1;}},bandwidth:{get:function get(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth;},set:function set(bandwidth){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=bandwidth;this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0};}},systemBandwidth:{get:function get(){var invBandwidth=1/(this.bandwidth||1);var invThroughput=undefined;if(this.throughput>0){invThroughput=1/this.throughput;}else{invThroughput=0;}
var systemBitrate=Math.floor(1/(invBandwidth+invThroughput));return systemBitrate;},set:function set(){_videoJs2['default'].log.error('The "systemBandwidth" property is read-only');}}});Object.defineProperties(this.stats,{bandwidth:{get:function get(){return _this3.bandwidth||0;},enumerable:true},mediaRequests:{get:function get(){return _this3.masterPlaylistController_.mediaRequests_()||0;},enumerable:true},mediaTransferDuration:{get:function get(){return _this3.masterPlaylistController_.mediaTransferDuration_()||0;},enumerable:true},mediaBytesTransferred:{get:function get(){return _this3.masterPlaylistController_.mediaBytesTransferred_()||0;},enumerable:true}});this.tech_.one('canplay',this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_));this.masterPlaylistController_.on('sourceopen',function(){_this3.tech_.audioTracks().addEventListener('change',_this3.audioTrackChange_);});this.masterPlaylistController_.on('selectedinitialmedia',function(){(0,_renditionMixin2['default'])(_this3);});this.masterPlaylistController_.on('audioupdate',function(){_this3.tech_.clearTracks('audio');_this3.masterPlaylistController_.activeAudioGroup().forEach(function(audioTrack){_this3.tech_.audioTracks().addTrack(audioTrack);});});this.on(this.masterPlaylistController_,'progress',function(){this.tech_.trigger('progress');});if(!this.tech_.el()){return;}
this.tech_.src(_videoJs2['default'].URL.createObjectURL(this.masterPlaylistController_.mediaSource));}},{key:'activeAudioGroup_',value:function activeAudioGroup_(){return this.masterPlaylistController_.activeAudioGroup();}},{key:'play',value:function play(){this.masterPlaylistController_.play();}},{key:'setCurrentTime',value:function setCurrentTime(currentTime){this.masterPlaylistController_.setCurrentTime(currentTime);}},{key:'duration',value:function duration(){return this.masterPlaylistController_.duration();}},{key:'seekable',value:function seekable(){return this.masterPlaylistController_.seekable();}},{key:'dispose',value:function dispose(){if(this.playbackWatcher_){this.playbackWatcher_.dispose();}
if(this.masterPlaylistController_){this.masterPlaylistController_.dispose();}
this.tech_.audioTracks().removeEventListener('change',this.audioTrackChange_);_get(Object.getPrototypeOf(HlsHandler.prototype),'dispose',this).call(this);}}]);return HlsHandler;})(Component);var HlsSourceHandler=function HlsSourceHandler(mode){return{canHandleSource:function canHandleSource(srcObj){if(_videoJs2['default'].options.hls&&_videoJs2['default'].options.hls.mode&&_videoJs2['default'].options.hls.mode!==mode){return false;}
return HlsSourceHandler.canPlayType(srcObj.type);},handleSource:function handleSource(source,tech,options){if(mode==='flash'){tech.setTimeout(function(){tech.trigger('loadstart');},1);}
var settings=_videoJs2['default'].mergeOptions(options,{hls:{mode:mode}});tech.hls=new HlsHandler(source,tech,settings);tech.hls.xhr=(0,_xhr2['default'])();if(_videoJs2['default'].Hls.xhr.beforeRequest){tech.hls.xhr.beforeRequest=_videoJs2['default'].Hls.xhr.beforeRequest;}
tech.hls.src(source.src);return tech.hls;},canPlayType:function canPlayType(type){if(HlsSourceHandler.canPlayType(type)){return 'maybe';}
return '';}};};Hls.comparePlaylistBandwidth=function(left,right){var leftBandwidth=undefined;var rightBandwidth=undefined;if(left.attributes&&left.attributes.BANDWIDTH){leftBandwidth=left.attributes.BANDWIDTH;}
leftBandwidth=leftBandwidth||_globalWindow2['default'].Number.MAX_VALUE;if(right.attributes&&right.attributes.BANDWIDTH){rightBandwidth=right.attributes.BANDWIDTH;}
rightBandwidth=rightBandwidth||_globalWindow2['default'].Number.MAX_VALUE;return leftBandwidth-rightBandwidth;};Hls.comparePlaylistResolution=function(left,right){var leftWidth=undefined;var rightWidth=undefined;if(left.attributes&&left.attributes.RESOLUTION&&left.attributes.RESOLUTION.width){leftWidth=left.attributes.RESOLUTION.width;}
leftWidth=leftWidth||_globalWindow2['default'].Number.MAX_VALUE;if(right.attributes&&right.attributes.RESOLUTION&&right.attributes.RESOLUTION.width){rightWidth=right.attributes.RESOLUTION.width;}
rightWidth=rightWidth||_globalWindow2['default'].Number.MAX_VALUE;if(leftWidth===rightWidth&&left.attributes.BANDWIDTH&&right.attributes.BANDWIDTH){return left.attributes.BANDWIDTH-right.attributes.BANDWIDTH;}
return leftWidth-rightWidth;};HlsSourceHandler.canPlayType=function(type){var mpegurlRE=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i;if(!_videoJs2['default'].options.hls.overrideNative&&Hls.supportsNativeHls){return false;}
return mpegurlRE.test(type);};if(typeof _videoJs2['default'].MediaSource==='undefined'||typeof _videoJs2['default'].URL==='undefined'){_videoJs2['default'].MediaSource=_videojsContribMediaSources.MediaSource;_videoJs2['default'].URL=_videojsContribMediaSources.URL;}
if(_videojsContribMediaSources.MediaSource.supportsNativeMediaSources()){_videoJs2['default'].getComponent('Html5').registerSourceHandler(HlsSourceHandler('html5'),0);}
if(_globalWindow2['default'].Uint8Array){_videoJs2['default'].getComponent('Flash').registerSourceHandler(HlsSourceHandler('flash'));}
_videoJs2['default'].HlsHandler=HlsHandler;_videoJs2['default'].HlsSourceHandler=HlsSourceHandler;_videoJs2['default'].Hls=Hls;_videoJs2['default'].m3u8=_m3u8Parser2['default'];_videoJs2['default'].registerComponent('Hls',Hls);_videoJs2['default'].options.hls=_videoJs2['default'].options.hls||{};_videoJs2['default'].plugin('reloadSourceOnError',_reloadSourceOnError2['default']);module.exports={Hls:Hls,HlsHandler:HlsHandler,HlsSourceHandler:HlsSourceHandler};}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bin-utils":2,"./config":3,"./master-playlist-controller":4,"./playback-watcher":5,"./playlist":7,"./playlist-loader":6,"./reload-source-on-error":9,"./rendition-mixin":10,"./xhr":15,"aes-decrypter":19,"global/document":25,"global/window":26,"m3u8-parser":63,"videojs-contrib-media-sources":96}]},{},[99])(99)});